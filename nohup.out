[[36m2024-09-25 10:18:56,822[0m][[35mHYDRA[0m] Launching 2 jobs locally[0m
[[36m2024-09-25 10:18:56,822[0m][[35mHYDRA[0m] 	#0 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 10:18:57,031[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 10:18:57,035[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 5                                                           
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 60                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-25 10:18:57,102[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 10:18:58,094[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 10:18:58,342[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 10:18:58,343[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 10:18:58,348[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 10:18:58,350[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 10:18:58,350[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 10:18:58,351[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 10:18:58,352[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 10:18:59,228[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 10:18:59,314[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 10:18:59,336[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 388f3c8e9bf64289aec9b807[0m
[[36m2024-09-25 10:18:59,337[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 10:18:59,337[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1242feb430>[0m
[[36m2024-09-25 10:18:59,404[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=60` or `min_steps=None` has not been met. Training will continue...
Epoch 59/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       22.00it/s v_num: b807     
                                      0:00:00                   val/ei_step:    
                                                                0.960           
                                                                val/ei_term1_st…
                                                                0.468           
                                                                val/ei_term2_st…
                                                                1.452 val/MAE:  
                                                                0.212           
                                                                val/ei_epoch:   
                                                                0.889           
                                                                val/ei_term1_ep…
                                                                0.323           
                                                                val/ei_term2_ep…
                                                                1.455 val/loss: 
                                                                0.246 train/MAE:
                                                                0.011           
                                                                train/loss:     
                                                                0.012           
[[36m2024-09-25 11:04:51,610[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 11:04:51,614[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '388f3c8e9bf64289aec9b807'. Data corruption may occur if there is active process writing to Run '388f3c8e9bf64289aec9b807'.[0m
[[36m2024-09-25 11:04:51,625[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 388f3c8e9bf64289aec9b807[0m
[[36m2024-09-25 11:04:51,626[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 11:04:51,627[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f12430b75b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/0/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/0/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06250544637441635    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -23.115829467773438    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07472994923591614    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.80it/s 
[[36m2024-09-25 11:04:52,999[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/0/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 11:04:53,004[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/0[0m
[[36m2024-09-25 11:04:53,005[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 11:04:53,010[0m][[35mHYDRA[0m] 	#1 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 11:04:53,231[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 11:04:53,233[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 5                                                           
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 60                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-25 11:04:53,291[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 11:04:53,305[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 11:04:53,318[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 11:04:53,319[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 11:04:53,321[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 11:04:53,322[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 11:04:53,323[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 11:04:53,323[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 11:04:53,323[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 11:04:53,325[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 11:04:53,337[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 11:04:53,345[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8961c2ea37fa48af9d9cd81a[0m
[[36m2024-09-25 11:04:53,346[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 11:04:53,346[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f12402631c0>[0m
[[36m2024-09-25 11:04:53,388[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=60` or `min_steps=None` has not been met. Training will continue...
Epoch 59/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       23.25it/s v_num: d81a     
                                      0:00:00                   val/ei_step:    
                                                                1.041           
                                                                val/ei_term1_st…
                                                                0.632           
                                                                val/ei_term2_st…
                                                                1.449 val/MAE:  
                                                                0.200           
                                                                val/ei_epoch:   
                                                                0.989           
                                                                val/ei_term1_ep…
                                                                0.529           
                                                                val/ei_term2_ep…
                                                                1.449 val/loss: 
                                                                0.229 train/MAE:
                                                                0.012           
                                                                train/loss:     
                                                                0.012           
[[36m2024-09-25 11:50:06,078[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 11:50:06,081[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8961c2ea37fa48af9d9cd81a'. Data corruption may occur if there is active process writing to Run '8961c2ea37fa48af9d9cd81a'.[0m
[[36m2024-09-25 11:50:06,095[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8961c2ea37fa48af9d9cd81a[0m
[[36m2024-09-25 11:50:06,097[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 11:50:06,097[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f11f113bdc0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/1/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/1/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.062453001737594604    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -27.886247634887695    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07136936485767365    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.75it/s 
[[36m2024-09-25 11:50:07,490[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/1/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 11:50:07,494[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_10-18-56/1[0m
[[36m2024-09-25 11:50:07,496[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 14:59:51,531[0m][[35mHYDRA[0m] Launching 3 jobs locally[0m
[[36m2024-09-25 14:59:51,531[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 14:59:51,738[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 14:59:51,742[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 5                                                           
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 60                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-09-25 14:59:51,809[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 14:59:52,903[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 14:59:53,041[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 14:59:53,041[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 14:59:53,047[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 14:59:53,048[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 14:59:53,049[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 14:59:53,050[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 14:59:53,050[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 14:59:53,927[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 14:59:54,014[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 14:59:54,036[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 09dfd1948e644baab4cb0013[0m
[[36m2024-09-25 14:59:54,037[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 14:59:54,037[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f2f73054100>[0m
[[36m2024-09-25 14:59:54,105[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=60` or `min_steps=None` has not been met. Training will continue...
[[36m2024-09-25 15:14:03,105[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-25 15:14:03,105[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:14:03,110[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-25 15:14:03,110[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:14:03,315[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:14:03,319[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-25 15:14:03,320[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:14:03,324[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-09-25 15:14:03,387[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-09-25 15:14:03,393[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:14:04,558[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:14:04,561[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:14:04,675[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:14:04,676[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:14:04,679[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:14:04,680[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:14:04,681[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:14:04,681[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:14:04,682[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:14:04,693[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:14:04,693[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:14:04,698[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:14:04,699[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:14:04,700[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:14:04,701[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:14:04,701[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:14:05,578[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-09-25 15:14:05,587[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:14:05,668[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:14:05,677[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:14:05,690[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for af3724aa952348ac943f238c[0m
[[36m2024-09-25 15:14:05,691[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:14:05,691[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c085ac820>[0m
[[36m2024-09-25 15:14:05,697[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 7a777a4cb10c4ed9b0cb1bed[0m
[[36m2024-09-25 15:14:05,698[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:14:05,699[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a7b2ac070>[0m
[[36m2024-09-25 15:14:05,764[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-09-25 15:14:05,783[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:03 •       39.87it/s v_num: 1bed     
                                      0:00:00                   val/ei_step:    
                                                                1.112           
                                                                val/ei_term1_st…
                                                                0.763           
                                                                val/ei_term2_st…
                                                                1.461 val/MAE:  
                                                                0.115           
                                                                val/ei_epoch:   
                                                                0.935           
                                                                val/ei_term1_ep…
                                                                0.407           
                                                                val/ei_term2_ep…
                                                                1.462 val/loss: 
                                                                0.145 train/MAE:
                                                                0.018           
                                                                train/loss:     
                                                                0.020           
[[36m2024-09-25 15:20:38,995[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:20:39,000[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '7a777a4cb10c4ed9b0cb1bed'. Data corruption may occur if there is active process writing to Run '7a777a4cb10c4ed9b0cb1bed'.[0m
[[36m2024-09-25 15:20:39,013[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 7a777a4cb10c4ed9b0cb1bed[0m
[[36m2024-09-25 15:20:39,014[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:20:39,015[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a8d9369b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.05968419462442398    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -27.231578826904297    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.06889612227678299    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.78it/s 
[[36m2024-09-25 15:20:40,399[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 15:20:40,403[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0[0m
[[36m2024-09-25 15:20:40,405[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:20:40,409[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:20:40,639[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:20:40,641[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-25 15:20:40,703[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:20:40,717[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:20:40,731[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:20:40,732[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:20:40,734[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:20:40,735[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:20:40,736[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:20:40,737[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:20:40,737[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:20:40,739[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:20:40,751[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:20:40,759[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 6598f8beba4744bdb05194a5[0m
[[36m2024-09-25 15:20:40,760[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:20:40,760[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a8d85ecb0>[0m
[[36m2024-09-25 15:20:40,805[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:07 •       18.75it/s v_num: 238c     
                                      0:00:00                   val/ei_step:    
                                                                1.021           
                                                                val/ei_term1_st…
                                                                0.663           
                                                                val/ei_term2_st…
                                                                1.379 val/MAE:  
                                                                0.136           
                                                                val/ei_epoch:   
                                                                0.952           
                                                                val/ei_term1_ep…
                                                                0.526           
                                                                val/ei_term2_ep…
                                                                1.379 val/loss: 
                                                                0.161 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.019           
[[36m2024-09-25 15:25:26,568[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:25:26,573[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'af3724aa952348ac943f238c'. Data corruption may occur if there is active process writing to Run 'af3724aa952348ac943f238c'.[0m
[[36m2024-09-25 15:25:26,587[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for af3724aa952348ac943f238c[0m
[[36m2024-09-25 15:25:26,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:25:26,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c085acbb0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0/checkpoints/epoch_000-v1.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0/checkpoints/epoch_000-v1.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06149819493293762    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -25.312009811401367    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07203800231218338    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:01 • 0:00:00 15.93it/s 
[[36m2024-09-25 15:25:28,089[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0/checkpoints/epoch_000-v1.ckpt[0m
[[36m2024-09-25 15:25:28,094[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/0[0m
[[36m2024-09-25 15:25:28,095[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:25:28,099[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:25:28,334[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:25:28,336[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-25 15:25:28,400[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:25:28,415[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:25:28,430[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:25:28,430[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:25:28,433[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:25:28,434[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:25:28,435[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:25:28,435[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:25:28,436[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:25:28,438[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:25:28,450[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:25:28,459[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f1d882d95eed44b3b2e51c87[0m
[[36m2024-09-25 15:25:28,460[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:25:28,460[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c17102cb0>[0m
[[36m2024-09-25 15:25:28,503[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       23.18it/s v_num: 94a5     
                                      0:00:00                   val/ei_step:    
                                                                0.876           
                                                                val/ei_term1_st…
                                                                0.295           
                                                                val/ei_term2_st…
                                                                1.456 val/MAE:  
                                                                0.149           
                                                                val/ei_epoch:   
                                                                0.764           
                                                                val/ei_term1_ep…
                                                                0.071           
                                                                val/ei_term2_ep…
                                                                1.456 val/loss: 
                                                                0.187 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.019           
[[36m2024-09-25 15:27:33,100[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:27:33,103[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '6598f8beba4744bdb05194a5'. Data corruption may occur if there is active process writing to Run '6598f8beba4744bdb05194a5'.[0m
[[36m2024-09-25 15:27:33,112[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 6598f8beba4744bdb05194a5[0m
[[36m2024-09-25 15:27:33,113[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:27:33,113[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a50034c70>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06340669095516205    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -23.115829467773438    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07547394186258316    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.78it/s 
[[36m2024-09-25 15:27:34,495[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 15:27:34,499[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1[0m
[[36m2024-09-25 15:27:34,500[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:27:34,504[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:27:34,725[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:27:34,727[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-25 15:27:34,787[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:27:34,801[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:27:34,813[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:27:34,813[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:27:34,816[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:27:34,817[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:27:34,817[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:27:34,818[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:27:34,818[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:27:34,820[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:27:34,832[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:27:34,839[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 458ff25fcd8c4bf988b7368f[0m
[[36m2024-09-25 15:27:34,840[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:27:34,840[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a885bcb50>[0m
[[36m2024-09-25 15:27:34,882[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:03 •       39.90it/s v_num: 368f     
                                      0:00:00                   val/ei_step:    
                                                                0.969           
                                                                val/ei_term1_st…
                                                                0.474           
                                                                val/ei_term2_st…
                                                                1.463 val/MAE:  
                                                                0.131           
                                                                val/ei_epoch:   
                                                                0.826           
                                                                val/ei_term1_ep…
                                                                0.192           
                                                                val/ei_term2_ep…
                                                                1.459 val/loss: 
                                                                0.167 train/MAE:
                                                                0.019           
                                                                train/loss:     
                                                                0.021           
[[36m2024-09-25 15:34:23,632[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:34:23,635[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '458ff25fcd8c4bf988b7368f'. Data corruption may occur if there is active process writing to Run '458ff25fcd8c4bf988b7368f'.[0m
[[36m2024-09-25 15:34:23,648[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 458ff25fcd8c4bf988b7368f[0m
[[36m2024-09-25 15:34:23,649[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:34:23,649[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a8a745ba0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06326772272586823    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -27.886247634887695    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07202459126710892    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.70it/s 
[[36m2024-09-25 15:34:25,024[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 15:34:25,028[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2[0m
[[36m2024-09-25 15:34:25,030[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:34:25,034[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:34:25,263[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:34:25,265[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-25 15:34:25,328[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:34:25,342[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:34:25,355[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:34:25,355[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:34:25,358[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:34:25,359[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:34:25,360[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:34:25,360[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:34:25,361[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:34:25,362[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:34:25,375[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:34:25,383[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 7a17d348c58e4f23902867b6[0m
[[36m2024-09-25 15:34:25,384[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:34:25,384[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a501b1c90>[0m
[[36m2024-09-25 15:34:25,425[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:07 •       19.11it/s v_num: 1c87     
                                      0:00:00                   val/ei_step:    
                                                                0.883           
                                                                val/ei_term1_st…
                                                                0.402           
                                                                val/ei_term2_st…
                                                                1.364 val/MAE:  
                                                                0.132           
                                                                val/ei_epoch:   
                                                                0.737           
                                                                val/ei_term1_ep…
                                                                0.108           
                                                                val/ei_term2_ep…
                                                                1.366 val/loss: 
                                                                0.168 train/MAE:
                                                                0.018           
                                                                train/loss:     
                                                                0.020           
[[36m2024-09-25 15:36:51,456[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:36:51,460[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'f1d882d95eed44b3b2e51c87'. Data corruption may occur if there is active process writing to Run 'f1d882d95eed44b3b2e51c87'.[0m
[[36m2024-09-25 15:36:51,472[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f1d882d95eed44b3b2e51c87[0m
[[36m2024-09-25 15:36:51,474[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:36:51,474[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c1359e0b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints/epoch_000-v1.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints/epoch_000-v1.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06389135867357254    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -21.414339065551758    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07795201241970062    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.06it/s 
[[36m2024-09-25 15:36:52,855[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1/checkpoints/epoch_000-v1.ckpt[0m
[[36m2024-09-25 15:36:52,859[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/1[0m
[[36m2024-09-25 15:36:52,860[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:36:52,864[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:36:53,083[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:36:53,085[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-25 15:36:53,145[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:36:53,159[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:36:53,172[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:36:53,172[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:36:53,175[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:36:53,176[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:36:53,177[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:36:53,177[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:36:53,178[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:36:53,179[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:36:53,191[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:36:53,199[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 793ff6a11b344cbc956866cf[0m
[[36m2024-09-25 15:36:53,200[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:36:53,200[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c4b1646d0>[0m
[[36m2024-09-25 15:36:53,242[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 11/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       22.70it/s v_num: 67b6     
                                      0:00:00                   val/ei_step:    
                                                                0.985           
                                                                val/ei_term1_st…
                                                                0.444           
                                                                val/ei_term2_st…
                                                                1.525 val/MAE:  
                                                                0.120           
                                                                val/ei_epoch:   
                                                                0.860           
                                                                val/ei_term1_ep…
                                                                0.198           
                                                                val/ei_term2_ep…
                                                                1.522 val/loss: 
                                                                0.154 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.020           
[[36m2024-09-25 15:41:47,870[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:41:47,873[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '7a17d348c58e4f23902867b6'. Data corruption may occur if there is active process writing to Run '7a17d348c58e4f23902867b6'.[0m
[[36m2024-09-25 15:41:47,884[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 7a17d348c58e4f23902867b6[0m
[[36m2024-09-25 15:41:47,885[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:41:47,885[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a501b3760>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints/epoch_001.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints/epoch_001.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06849778443574905    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -21.03872299194336     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.08116066455841064    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.50it/s 
[[36m2024-09-25 15:41:49,261[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints/epoch_001.ckpt[0m
[[36m2024-09-25 15:41:49,266[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3[0m
[[36m2024-09-25 15:41:49,267[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:41:49,271[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:41:49,501[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:41:49,502[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-25 15:41:49,562[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:41:49,577[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:41:49,590[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:41:49,591[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:41:49,593[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:41:49,594[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:41:49,595[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:41:49,596[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:41:49,596[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:41:49,598[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:41:49,610[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:41:49,618[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a696d623eb804ed28c8c3783[0m
[[36m2024-09-25 15:41:49,619[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:41:49,619[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0a8d84abf0>[0m
[[36m2024-09-25 15:41:49,663[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       22.64it/s v_num: 3783     
                                      0:00:00                   val/ei_step:    
                                                                1.032           
                                                                val/ei_term1_st…
                                                                0.645           
                                                                val/ei_term2_st…
                                                                1.420 val/MAE:  
                                                                0.126           
                                                                val/ei_epoch:   
                                                                0.907           
                                                                val/ei_term1_ep…
                                                                0.393           
                                                                val/ei_term2_ep…
                                                                1.421 val/loss: 
                                                                0.156 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.019           
[[36m2024-09-25 15:48:39,477[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:48:39,481[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a696d623eb804ed28c8c3783'. Data corruption may occur if there is active process writing to Run 'a696d623eb804ed28c8c3783'.[0m
[[36m2024-09-25 15:48:39,496[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a696d623eb804ed28c8c3783[0m
[[36m2024-09-25 15:48:39,497[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:48:39,497[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0abe73ef80>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06208449602127075    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -25.756608963012695    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07250337302684784    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.74it/s 
[[36m2024-09-25 15:48:40,899[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 15:48:40,903[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4[0m
[[36m2024-09-25 15:48:40,905[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 12/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       21.80it/s v_num: 66cf     
                                      0:00:00                   val/ei_step:    
                                                                0.902           
                                                                val/ei_term1_st…
                                                                0.427           
                                                                val/ei_term2_st…
                                                                1.377 val/MAE:  
                                                                0.128           
                                                                val/ei_epoch:   
                                                                0.864           
                                                                val/ei_term1_ep…
                                                                0.352           
                                                                val/ei_term2_ep…
                                                                1.377 val/loss: 
                                                                0.158 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.019           
[[36m2024-09-25 15:50:25,153[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 15:50:25,157[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '793ff6a11b344cbc956866cf'. Data corruption may occur if there is active process writing to Run '793ff6a11b344cbc956866cf'.[0m
[[36m2024-09-25 15:50:25,170[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 793ff6a11b344cbc956866cf[0m
[[36m2024-09-25 15:50:25,171[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:50:25,171[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c135a75e0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints/epoch_002.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints/epoch_002.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06097957119345665    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -25.538074493408203    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.0712491124868393     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.51it/s 
[[36m2024-09-25 15:50:26,556[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2/checkpoints/epoch_002.ckpt[0m
[[36m2024-09-25 15:50:26,560[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/2[0m
[[36m2024-09-25 15:50:26,561[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 15:50:26,565[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 15:50:26,784[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 15:50:26,786[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-25 15:50:26,844[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 15:50:26,857[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 15:50:26,870[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 15:50:26,870[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 15:50:26,873[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 15:50:26,874[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 15:50:26,874[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 15:50:26,875[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 15:50:26,875[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 15:50:26,877[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 15:50:26,888[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 15:50:26,896[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d13cc25e0e7349bdbf9f89fe[0m
[[36m2024-09-25 15:50:26,897[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 15:50:26,897[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c16e7eb30>[0m
[[36m2024-09-25 15:50:26,937[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       20.43it/s v_num: 89fe     
                                      0:00:00                   val/ei_step:    
                                                                1.110           
                                                                val/ei_term1_st…
                                                                0.861           
                                                                val/ei_term2_st…
                                                                1.359 val/MAE:  
                                                                0.098           
                                                                val/ei_epoch:   
                                                                0.914           
                                                                val/ei_term1_ep…
                                                                0.470           
                                                                val/ei_term2_ep…
                                                                1.359 val/loss: 
                                                                0.126 train/MAE:
                                                                0.020           
                                                                train/loss:     
                                                                0.023           
[[36m2024-09-25 16:01:37,104[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 16:01:37,107[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'd13cc25e0e7349bdbf9f89fe'. Data corruption may occur if there is active process writing to Run 'd13cc25e0e7349bdbf9f89fe'.[0m
[[36m2024-09-25 16:01:37,120[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d13cc25e0e7349bdbf9f89fe[0m
[[36m2024-09-25 16:01:37,121[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 16:01:37,121[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c16e7e140>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints/epoch_000.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints/epoch_000.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.06733784824609756    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -23.407800674438477    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.07906395196914673    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.40it/s 
[[36m2024-09-25 16:01:38,497[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3/checkpoints/epoch_000.ckpt[0m
[[36m2024-09-25 16:01:38,502[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/3[0m
[[36m2024-09-25 16:01:38,503[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-25 16:01:38,507[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-25 16:01:38,728[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-25 16:01:38,730[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.05                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-25 16:01:38,788[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-25 16:01:38,802[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-25 16:01:38,815[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-25 16:01:38,815[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-25 16:01:38,818[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-25 16:01:38,819[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-25 16:01:38,819[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-25 16:01:38,820[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-25 16:01:38,820[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-25 16:01:38,822[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-25 16:01:38,833[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-25 16:01:38,841[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8a0157f07d5145559dbe957f[0m
[[36m2024-09-25 16:01:38,842[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 16:01:38,842[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c1712f100>[0m
[[36m2024-09-25 16:01:38,886[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 12/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       21.30it/s v_num: 957f     
                                      0:00:00                   val/ei_step:    
                                                                1.131           
                                                                val/ei_term1_st…
                                                                0.865           
                                                                val/ei_term2_st…
                                                                1.397 val/MAE:  
                                                                0.119           
                                                                val/ei_epoch:   
                                                                1.005           
                                                                val/ei_term1_ep…
                                                                0.612           
                                                                val/ei_term2_ep…
                                                                1.397 val/loss: 
                                                                0.145 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.019           
[[36m2024-09-25 16:15:07,247[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-25 16:15:07,250[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8a0157f07d5145559dbe957f'. Data corruption may occur if there is active process writing to Run '8a0157f07d5145559dbe957f'.[0m
[[36m2024-09-25 16:15:07,265[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8a0157f07d5145559dbe957f[0m
[[36m2024-09-25 16:15:07,266[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-25 16:15:07,266[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c13617bb0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints/epoch_002.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints/epoch_002.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.0593058280646801     │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -25.842710494995117    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.06955449283123016    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.44it/s 
[[36m2024-09-25 16:15:08,652[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4/checkpoints/epoch_002.ckpt[0m
[[36m2024-09-25 16:15:08,657[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-25_15-14-02/4[0m
[[36m2024-09-25 16:15:08,658[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-26 22:24:32,427[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-26 22:24:32,427[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 22:24:32,448[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-26 22:24:32,449[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 22:24:32,637[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 22:24:32,641[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-26 22:24:32,660[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 22:24:32,664[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-09-26 22:24:32,708[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-09-26 22:24:32,732[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-26 22:24:33,884[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 22:24:33,893[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 22:24:34,004[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 22:24:34,004[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 22:24:34,008[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 22:24:34,009[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 22:24:34,010[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 22:24:34,010[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 22:24:34,010[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 22:24:34,020[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 22:24:34,021[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 22:24:34,025[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 22:24:34,026[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 22:24:34,027[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 22:24:34,027[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 22:24:34,028[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 22:24:34,901[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-09-26 22:24:34,914[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 22:24:34,989[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 22:24:35,003[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-26 22:24:35,014[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 06c3807ec41f48778a0fa0ec[0m
[[36m2024-09-26 22:24:35,015[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 22:24:35,015[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f6835f08040>[0m
[[36m2024-09-26 22:24:35,026[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2710bbb0e2704bfe8fb2eea7[0m
[[36m2024-09-26 22:24:35,026[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 22:24:35,027[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f532db40880>[0m
[[36m2024-09-26 22:24:35,080[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2024-09-26 22:24:35,091[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 39/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:05 •       23.84it/s v_num: a0ec     
                                      0:00:00                   val/ei_step:    
                                                                2.692           
                                                                val/ei_term1_st…
                                                                3.964           
                                                                val/ei_term2_st…
                                                                1.420 val/MAE:  
                                                                0.013           
                                                                val/ei_epoch:   
                                                                2.681           
                                                                val/ei_term1_ep…
                                                                3.942           
                                                                val/ei_term2_ep…
                                                                1.420 val/loss: 
                                                                0.015 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.015           
[[36m2024-09-26 22:49:31,968[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-26 22:49:31,973[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '06c3807ec41f48778a0fa0ec'. Data corruption may occur if there is active process writing to Run '06c3807ec41f48778a0fa0ec'.[0m
[[36m2024-09-26 22:49:31,987[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 06c3807ec41f48778a0fa0ec[0m
[[36m2024-09-26 22:49:31,988[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 22:49:31,988[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f6848593e20>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0/checkpoints/epoch_029.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0/checkpoints/epoch_029.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012670271098613739    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -59.69465255737305     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.013813734985888004    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.47it/s 
[[36m2024-09-26 22:49:33,361[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0/checkpoints/epoch_029.ckpt[0m
[[36m2024-09-26 22:49:33,366[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0[0m
[[36m2024-09-26 22:49:33,367[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-26 22:49:33,372[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 22:49:33,599[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 22:49:33,601[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-26 22:49:33,662[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-26 22:49:33,676[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 22:49:33,690[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 22:49:33,690[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 22:49:33,693[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 22:49:33,694[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 22:49:33,695[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 22:49:33,695[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 22:49:33,696[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 22:49:33,697[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 22:49:33,710[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-26 22:49:33,717[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a9ad765be54944ee9a2c467d[0m
[[36m2024-09-26 22:49:33,718[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 22:49:33,719[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f681c0c12a0>[0m
[[36m2024-09-26 22:49:33,762[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 33/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:07 •       19.99it/s v_num: eea7     
                                      0:00:00                   val/ei_step:    
                                                                2.724           
                                                                val/ei_term1_st…
                                                                4.071           
                                                                val/ei_term2_st…
                                                                1.377 val/MAE:  
                                                                0.014           
                                                                val/ei_epoch:   
                                                                2.740           
                                                                val/ei_term1_ep…
                                                                4.103           
                                                                val/ei_term2_ep…
                                                                1.378 val/loss: 
                                                                0.015 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.015           
[[36m2024-09-26 23:00:02,457[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-26 23:00:02,461[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '2710bbb0e2704bfe8fb2eea7'. Data corruption may occur if there is active process writing to Run '2710bbb0e2704bfe8fb2eea7'.[0m
[[36m2024-09-26 23:00:02,475[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2710bbb0e2704bfe8fb2eea7[0m
[[36m2024-09-26 23:00:02,476[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:00:02,476[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f533f8a9b40>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0/checkpoints/epoch_023.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0/checkpoints/epoch_023.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01303966622799635    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -62.54762649536133     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.013917294330894947    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.80it/s 
[[36m2024-09-26 23:00:03,855[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0/checkpoints/epoch_023.ckpt[0m
[[36m2024-09-26 23:00:03,860[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/0[0m
[[36m2024-09-26 23:00:03,861[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-26 23:00:03,865[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 23:00:04,091[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 23:00:04,093[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-26 23:00:04,155[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-26 23:00:04,169[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 23:00:04,183[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 23:00:04,183[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 23:00:04,186[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 23:00:04,187[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 23:00:04,188[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 23:00:04,188[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 23:00:04,189[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 23:00:04,190[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 23:00:04,203[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-26 23:00:04,210[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8f324430936b404b8bb18c00[0m
[[36m2024-09-26 23:00:04,211[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:00:04,211[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5339a60f10>[0m
[[36m2024-09-26 23:00:04,252[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 37/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       22.34it/s v_num: 467d     
                                      0:00:00                   val/ei_step:    
                                                                2.779           
                                                                val/ei_term1_st…
                                                                4.171           
                                                                val/ei_term2_st…
                                                                1.387 val/MAE:  
                                                                0.013           
                                                                val/ei_epoch:   
                                                                2.760           
                                                                val/ei_term1_ep…
                                                                4.134           
                                                                val/ei_term2_ep…
                                                                1.387 val/loss: 
                                                                0.014 train/MAE:
                                                                0.013           
                                                                train/loss:     
                                                                0.015           
[[36m2024-09-26 23:13:17,817[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-26 23:13:17,820[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a9ad765be54944ee9a2c467d'. Data corruption may occur if there is active process writing to Run 'a9ad765be54944ee9a2c467d'.[0m
[[36m2024-09-26 23:13:17,834[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a9ad765be54944ee9a2c467d[0m
[[36m2024-09-26 23:13:17,835[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:13:17,836[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f681c052cb0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints/epoch_027.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints/epoch_027.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013333942741155624    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -62.06254577636719     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01453507412225008    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.64it/s 
[[36m2024-09-26 23:13:19,217[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints/epoch_027.ckpt[0m
[[36m2024-09-26 23:13:19,222[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1[0m
[[36m2024-09-26 23:13:19,223[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-26 23:13:19,227[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 23:13:19,458[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 23:13:19,460[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-26 23:13:19,522[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-26 23:13:19,536[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 23:13:19,549[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 23:13:19,549[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 23:13:19,552[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 23:13:19,553[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 23:13:19,554[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 23:13:19,554[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 23:13:19,555[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 23:13:19,557[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 23:13:19,569[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-26 23:13:19,577[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f28713d828124b0b8efa368d[0m
[[36m2024-09-26 23:13:19,578[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:13:19,578[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f6847402020>[0m
[[36m2024-09-26 23:13:19,618[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 26/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:05 •       23.73it/s v_num: 368d     
                                      0:00:00                   val/ei_step:    
                                                                2.375           
                                                                val/ei_term1_st…
                                                                3.337           
                                                                val/ei_term2_st…
                                                                1.414 val/MAE:  
                                                                0.016           
                                                                val/ei_epoch:   
                                                                2.445           
                                                                val/ei_term1_ep…
                                                                3.477           
                                                                val/ei_term2_ep…
                                                                1.414 val/loss: 
                                                                0.018 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-26 23:30:08,558[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-26 23:30:08,562[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'f28713d828124b0b8efa368d'. Data corruption may occur if there is active process writing to Run 'f28713d828124b0b8efa368d'.[0m
[[36m2024-09-26 23:30:08,574[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f28713d828124b0b8efa368d[0m
[[36m2024-09-26 23:30:08,575[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:30:08,576[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f683692ff40>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints/epoch_016.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints/epoch_016.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.015056929551064968    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -58.59724426269531     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.016569554805755615    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:01 • 0:00:00 16.44it/s 
[[36m2024-09-26 23:30:10,069[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints/epoch_016.ckpt[0m
[[36m2024-09-26 23:30:10,073[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2[0m
[[36m2024-09-26 23:30:10,074[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-26 23:30:10,079[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 23:30:10,312[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 23:30:10,314[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-26 23:30:10,376[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-26 23:30:10,391[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 23:30:10,404[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 23:30:10,404[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 23:30:10,407[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 23:30:10,408[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 23:30:10,409[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 23:30:10,409[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 23:30:10,410[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 23:30:10,412[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 23:30:10,427[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-26 23:30:10,440[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c30315a7bbee4dd09474f66d[0m
[[36m2024-09-26 23:30:10,442[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:30:10,442[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f68453c6020>[0m
[[36m2024-09-26 23:30:10,495[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 14/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       21.57it/s v_num: f66d     
                                      0:00:00                   val/ei_step:    
                                                                2.452           
                                                                val/ei_term1_st…
                                                                3.391           
                                                                val/ei_term2_st…
                                                                1.513 val/MAE:  
                                                                0.017           
                                                                val/ei_epoch:   
                                                                2.491           
                                                                val/ei_term1_ep…
                                                                3.470           
                                                                val/ei_term2_ep…
                                                                1.512 val/loss: 
                                                                0.018 train/MAE:
                                                                0.016           
                                                                train/loss:     
                                                                0.018           
[[36m2024-09-26 23:39:26,945[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-26 23:39:26,949[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c30315a7bbee4dd09474f66d'. Data corruption may occur if there is active process writing to Run 'c30315a7bbee4dd09474f66d'.[0m
[[36m2024-09-26 23:39:26,962[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c30315a7bbee4dd09474f66d[0m
[[36m2024-09-26 23:39:26,963[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:39:26,963[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f681c11c5b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints/epoch_004.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints/epoch_004.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.017192380502820015    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -51.89961624145508     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.0205241646617651     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 16.62it/s 
[[36m2024-09-26 23:39:28,444[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints/epoch_004.ckpt[0m
[[36m2024-09-26 23:39:28,448[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3[0m
[[36m2024-09-26 23:39:28,450[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-26 23:39:28,455[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-26 23:39:28,700[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-26 23:39:28,702[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-26 23:39:28,767[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-26 23:39:28,782[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-26 23:39:28,796[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-26 23:39:28,797[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-26 23:39:28,799[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-26 23:39:28,800[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-26 23:39:28,801[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-26 23:39:28,802[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-26 23:39:28,802[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-26 23:39:28,804[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-26 23:39:28,817[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-26 23:39:28,825[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 88bf2fc47019468182a42f7a[0m
[[36m2024-09-26 23:39:28,826[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-26 23:39:28,826[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f684520b520>[0m
[[36m2024-09-26 23:39:28,871[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 38/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       23.29it/s v_num: 2f7a     
                                      0:00:00                   val/ei_step:    
                                                                2.749           
                                                                val/ei_term1_st…
                                                                4.094           
                                                                val/ei_term2_st…
                                                                1.404 val/MAE:  
                                                                0.014           
                                                                val/ei_epoch:   
                                                                2.756           
                                                                val/ei_term1_ep…
                                                                4.109           
                                                                val/ei_term2_ep…
                                                                1.403 val/loss: 
                                                                0.015 train/MAE:
                                                                0.013           
                                                                train/loss:     
                                                                0.015           
[[36m2024-09-27 00:03:54,912[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 00:03:54,915[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '88bf2fc47019468182a42f7a'. Data corruption may occur if there is active process writing to Run '88bf2fc47019468182a42f7a'.[0m
[[36m2024-09-27 00:03:54,929[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 88bf2fc47019468182a42f7a[0m
[[36m2024-09-27 00:03:54,930[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 00:03:54,931[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f684523b760>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints/epoch_028.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints/epoch_028.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012402825988829136    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -63.51747512817383     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01329509075731039    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.56it/s 
[[36m2024-09-27 00:03:56,315[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints/epoch_028.ckpt[0m
[[36m2024-09-27 00:03:56,319[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4[0m
[[36m2024-09-27 00:03:56,320[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 129/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:07 •       19.66it/s v_num: 8c00    
                                       0:00:00                   val/ei_step:   
                                                                 3.384          
                                                                 val/ei_term1_s…
                                                                 5.404          
                                                                 val/ei_term2_s…
                                                                 1.365 val/MAE: 
                                                                 0.011          
                                                                 val/ei_epoch:  
                                                                 3.405          
                                                                 val/ei_term1_e…
                                                                 5.447          
                                                                 val/ei_term2_e…
                                                                 1.364 val/loss:
                                                                 0.011          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.010          
[[36m2024-09-27 01:15:24,844[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 01:15:24,848[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8f324430936b404b8bb18c00'. Data corruption may occur if there is active process writing to Run '8f324430936b404b8bb18c00'.[0m
[[36m2024-09-27 01:15:24,862[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8f324430936b404b8bb18c00[0m
[[36m2024-09-27 01:15:24,863[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 01:15:24,863[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5338b8fb80>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints/epoch_119.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints/epoch_119.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010374676436185837    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -81.89380645751953     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010604639537632465    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.18it/s 
[[36m2024-09-27 01:15:26,247[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1/checkpoints/epoch_119.ckpt[0m
[[36m2024-09-27 01:15:26,251[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/1[0m
[[36m2024-09-27 01:15:26,252[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 01:15:26,256[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 01:15:26,475[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 01:15:26,477[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-27 01:15:26,534[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 01:15:26,548[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 01:15:26,561[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 01:15:26,561[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 01:15:26,564[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 01:15:26,565[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 01:15:26,566[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 01:15:26,566[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 01:15:26,566[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 01:15:26,568[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 01:15:26,580[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 01:15:26,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e171d0863c1f4be7b4a75f8f[0m
[[36m2024-09-27 01:15:26,589[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 01:15:26,589[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f53706f4130>[0m
[[36m2024-09-27 01:15:26,628[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 51/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       20.60it/s v_num: 5f8f     
                                      0:00:00                   val/ei_step:    
                                                                2.859           
                                                                val/ei_term1_st…
                                                                4.313           
                                                                val/ei_term2_st…
                                                                1.405 val/MAE:  
                                                                0.013           
                                                                val/ei_epoch:   
                                                                2.825           
                                                                val/ei_term1_ep…
                                                                4.245           
                                                                val/ei_term2_ep…
                                                                1.406 val/loss: 
                                                                0.013 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.015           
[[36m2024-09-27 02:08:55,810[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 02:08:55,814[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'e171d0863c1f4be7b4a75f8f'. Data corruption may occur if there is active process writing to Run 'e171d0863c1f4be7b4a75f8f'.[0m
[[36m2024-09-27 02:08:55,827[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e171d0863c1f4be7b4a75f8f[0m
[[36m2024-09-27 02:08:55,828[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 02:08:55,829[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f533c573280>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints/epoch_041.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints/epoch_041.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012924989685416222    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -64.17766571044922     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01365646068006754    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.14it/s 
[[36m2024-09-27 02:08:57,212[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2/checkpoints/epoch_041.ckpt[0m
[[36m2024-09-27 02:08:57,216[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/2[0m
[[36m2024-09-27 02:08:57,218[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 02:08:57,222[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 02:08:57,442[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 02:08:57,444[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-27 02:08:57,503[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 02:08:57,516[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 02:08:57,530[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 02:08:57,530[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 02:08:57,532[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 02:08:57,533[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 02:08:57,534[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 02:08:57,535[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 02:08:57,535[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 02:08:57,537[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 02:08:57,548[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 02:08:57,556[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 3b9eddbd98534c9b9bc030a0[0m
[[36m2024-09-27 02:08:57,557[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 02:08:57,558[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5338b56a70>[0m
[[36m2024-09-27 02:08:57,598[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 54/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:07 •       19.82it/s v_num: 30a0     
                                      0:00:00                   val/ei_step:    
                                                                2.717           
                                                                val/ei_term1_st…
                                                                4.063           
                                                                val/ei_term2_st…
                                                                1.371 val/MAE:  
                                                                0.015           
                                                                val/ei_epoch:   
                                                                2.649           
                                                                val/ei_term1_ep…
                                                                3.926           
                                                                val/ei_term2_ep…
                                                                1.371 val/loss: 
                                                                0.016 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.015           
[[36m2024-09-27 03:05:37,220[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 03:05:37,223[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '3b9eddbd98534c9b9bc030a0'. Data corruption may occur if there is active process writing to Run '3b9eddbd98534c9b9bc030a0'.[0m
[[36m2024-09-27 03:05:37,235[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 3b9eddbd98534c9b9bc030a0[0m
[[36m2024-09-27 03:05:37,237[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 03:05:37,237[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f533c62ad40>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints/epoch_044.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints/epoch_044.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012786781415343285    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -66.0204849243164     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.013514039106667042    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.29it/s 
[[36m2024-09-27 03:05:38,613[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3/checkpoints/epoch_044.ckpt[0m
[[36m2024-09-27 03:05:38,617[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/3[0m
[[36m2024-09-27 03:05:38,618[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 03:05:38,623[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 03:05:38,844[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 03:05:38,846[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 9000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-27 03:05:39,078[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 03:05:39,092[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 03:05:39,105[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 03:05:39,105[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 03:05:39,107[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 03:05:39,108[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 03:05:39,109[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 03:05:39,109[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 03:05:39,109[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 03:05:39,111[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 03:05:39,122[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 03:05:39,130[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 75b2770d9a464ba5a48803a7[0m
[[36m2024-09-27 03:05:39,131[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 03:05:39,131[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f533c673eb0>[0m
[[36m2024-09-27 03:05:39,171[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 133/1999 ━━━━━━━━━━━━━━━ 141/141 0:00:06 •       20.84it/s v_num: 03a7    
                                       0:00:00                   val/ei_step:   
                                                                 3.582          
                                                                 val/ei_term1_s…
                                                                 5.776          
                                                                 val/ei_term2_s…
                                                                 1.389 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.573          
                                                                 val/ei_term1_e…
                                                                 5.759          
                                                                 val/ei_term2_e…
                                                                 1.388 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.010          
[[36m2024-09-27 05:23:22,963[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 05:23:22,966[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '75b2770d9a464ba5a48803a7'. Data corruption may occur if there is active process writing to Run '75b2770d9a464ba5a48803a7'.[0m
[[36m2024-09-27 05:23:22,980[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 75b2770d9a464ba5a48803a7[0m
[[36m2024-09-27 05:23:22,981[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 05:23:22,982[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5339a61090>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints/epoch_123.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints/epoch_123.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010195836424827576    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -86.45222473144531     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01036845799535513    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 16/16 0:00:00 • 0:00:00 17.27it/s 
[[36m2024-09-27 05:23:24,381[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4/checkpoints/epoch_123.ckpt[0m
[[36m2024-09-27 05:23:24,385[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-26_22-24-31/4[0m
[[36m2024-09-27 05:23:24,387[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 15:48:39,737[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-27 15:48:39,737[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 15:48:39,766[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-27 15:48:39,766[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 15:48:39,950[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 15:48:39,954[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-27 15:48:39,989[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 15:48:39,993[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-09-27 15:48:40,023[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-09-27 15:48:40,062[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 15:48:41,185[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 15:48:41,235[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 15:48:41,320[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 15:48:41,321[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 15:48:41,325[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 15:48:41,327[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 15:48:41,327[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 15:48:41,328[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 15:48:41,328[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 15:48:41,359[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 15:48:41,359[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 15:48:41,363[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 15:48:41,364[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 15:48:41,365[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 15:48:41,365[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 15:48:41,365[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 15:48:42,264[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-09-27 15:48:42,303[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 15:48:42,354[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[[36m2024-09-27 15:48:42,376[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 5ee44fc6c1f84d87ae93f614[0m
[[36m2024-09-27 15:48:42,378[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 15:48:42,378[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe888d74e20>[0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 15:48:42,394[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 15:48:42,414[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 02fb8dbe495a4434b95432f1[0m
[[36m2024-09-27 15:48:42,415[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 15:48:42,416[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21cb28c580>[0m
[[36m2024-09-27 15:48:42,458[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-09-27 15:48:42,488[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 77/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:05 •       33.67it/s v_num: 32f1     
                                      0:00:00                   val/ei_step:    
                                                                3.396           
                                                                val/ei_term1_st…
                                                                5.381           
                                                                val/ei_term2_st…
                                                                1.412 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.309           
                                                                val/ei_term1_ep…
                                                                5.206           
                                                                val/ei_term2_ep…
                                                                1.411 val/loss: 
                                                                0.011 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-27 16:53:15,428[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 16:53:15,433[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '02fb8dbe495a4434b95432f1'. Data corruption may occur if there is active process writing to Run '02fb8dbe495a4434b95432f1'.[0m
[[36m2024-09-27 16:53:15,444[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 02fb8dbe495a4434b95432f1[0m
[[36m2024-09-27 16:53:15,445[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 16:53:15,445[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21cb28c4f0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0/checkpoints/epoch_067.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0/checkpoints/epoch_067.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010448227636516094    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -77.28856658935547     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01048948708921671    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.78it/s 
[[36m2024-09-27 16:53:17,056[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0/checkpoints/epoch_067.ckpt[0m
[[36m2024-09-27 16:53:17,061[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0[0m
[[36m2024-09-27 16:53:17,062[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 16:53:17,067[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 16:53:17,300[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 16:53:17,302[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-27 16:53:17,366[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 16:53:17,380[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 16:53:17,394[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 16:53:17,395[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 16:53:17,397[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 16:53:17,398[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 16:53:17,399[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 16:53:17,399[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 16:53:17,400[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 16:53:17,402[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 16:53:17,414[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 16:53:17,422[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 427690dac1324cedacc46e2e[0m
[[36m2024-09-27 16:53:17,423[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 16:53:17,423[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21cb28cc40>[0m
[[36m2024-09-27 16:53:17,465[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 19/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.08it/s v_num: 6e2e     
                                      0:00:00                   val/ei_step:    
                                                                2.745           
                                                                val/ei_term1_st…
                                                                4.063           
                                                                val/ei_term2_st…
                                                                1.428 val/MAE:  
                                                                0.014           
                                                                val/ei_epoch:   
                                                                2.654           
                                                                val/ei_term1_ep…
                                                                3.881           
                                                                val/ei_term2_ep…
                                                                1.427 val/loss: 
                                                                0.012 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-27 17:09:01,881[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 17:09:01,884[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '427690dac1324cedacc46e2e'. Data corruption may occur if there is active process writing to Run '427690dac1324cedacc46e2e'.[0m
[[36m2024-09-27 17:09:01,896[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 427690dac1324cedacc46e2e[0m
[[36m2024-09-27 17:09:01,897[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 17:09:01,898[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21da680310>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints/epoch_009.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints/epoch_009.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013553086668252945    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -57.12398910522461     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01231718622148037    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.42it/s 
[[36m2024-09-27 17:09:03,499[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints/epoch_009.ckpt[0m
[[36m2024-09-27 17:09:03,504[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1[0m
[[36m2024-09-27 17:09:03,505[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 17:09:03,509[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 17:09:03,745[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 17:09:03,746[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-27 17:09:03,810[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 17:09:03,825[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 17:09:03,838[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 17:09:03,838[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 17:09:03,841[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 17:09:03,842[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 17:09:03,843[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 17:09:03,844[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 17:09:03,844[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 17:09:03,846[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 17:09:03,858[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 17:09:03,866[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0d083393b8dc4db8828addba[0m
[[36m2024-09-27 17:09:03,867[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 17:09:03,868[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f220e715cf0>[0m
[[36m2024-09-27 17:09:03,910[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 33/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.71it/s v_num: ddba     
                                      0:00:00                   val/ei_step:    
                                                                2.528           
                                                                val/ei_term1_st…
                                                                3.642           
                                                                val/ei_term2_st…
                                                                1.414 val/MAE:  
                                                                0.019           
                                                                val/ei_epoch:   
                                                                2.532           
                                                                val/ei_term1_ep…
                                                                3.650           
                                                                val/ei_term2_ep…
                                                                1.415 val/loss: 
                                                                0.016 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.018           
[[36m2024-09-27 17:36:27,829[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 17:36:27,833[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '0d083393b8dc4db8828addba'. Data corruption may occur if there is active process writing to Run '0d083393b8dc4db8828addba'.[0m
[[36m2024-09-27 17:36:27,846[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0d083393b8dc4db8828addba[0m
[[36m2024-09-27 17:36:27,848[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 17:36:27,848[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21dd85dcf0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints/epoch_023.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints/epoch_023.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014084987342357635    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -64.17852020263672     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010933260433375835    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.32it/s 
[[36m2024-09-27 17:36:29,529[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints/epoch_023.ckpt[0m
[[36m2024-09-27 17:36:29,535[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2[0m
[[36m2024-09-27 17:36:29,536[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 17:36:29,540[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 17:36:29,790[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 17:36:29,792[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-27 17:36:30,070[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 17:36:30,086[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 17:36:30,100[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 17:36:30,101[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 17:36:30,103[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 17:36:30,105[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 17:36:30,105[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 17:36:30,106[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 17:36:30,106[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 17:36:30,108[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 17:36:30,123[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 17:36:30,133[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2cea6f8dcb8442faa68373fd[0m
[[36m2024-09-27 17:36:30,134[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 17:36:30,134[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21a8208a60>[0m
[[36m2024-09-27 17:36:30,179[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 93/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.41it/s v_num: f614     
                                      0:00:00                   val/ei_step:    
                                                                3.538           
                                                                val/ei_term1_st…
                                                                5.695           
                                                                val/ei_term2_st…
                                                                1.381 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.453           
                                                                val/ei_term1_ep…
                                                                5.526           
                                                                val/ei_term2_ep…
                                                                1.379 val/loss: 
                                                                0.010 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-27 17:54:38,951[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 17:54:38,956[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '5ee44fc6c1f84d87ae93f614'. Data corruption may occur if there is active process writing to Run '5ee44fc6c1f84d87ae93f614'.[0m
[[36m2024-09-27 17:54:38,967[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 5ee44fc6c1f84d87ae93f614[0m
[[36m2024-09-27 17:54:38,968[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 17:54:38,968[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe888d0dfc0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0/checkpoints/epoch_083.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0/checkpoints/epoch_083.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010215059854090214    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -82.1435317993164     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010273439809679985    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.46it/s 
[[36m2024-09-27 17:54:40,670[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0/checkpoints/epoch_083.ckpt[0m
[[36m2024-09-27 17:54:40,675[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/0[0m
[[36m2024-09-27 17:54:40,677[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 17:54:40,682[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 17:54:40,932[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 17:54:40,934[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-27 17:54:40,999[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 17:54:41,015[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 17:54:41,030[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 17:54:41,031[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 17:54:41,033[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 17:54:41,035[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 17:54:41,035[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 17:54:41,036[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 17:54:41,036[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 17:54:41,038[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 17:54:41,051[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 17:54:41,059[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for da6bab3a5b974fec80c10775[0m
[[36m2024-09-27 17:54:41,060[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 17:54:41,060[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe897b01d80>[0m
[[36m2024-09-27 17:54:41,105[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 21/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       18.98it/s v_num: 0775     
                                      0:00:00                   val/ei_step:    
                                                                2.610           
                                                                val/ei_term1_st…
                                                                3.842           
                                                                val/ei_term2_st…
                                                                1.378 val/MAE:  
                                                                0.015           
                                                                val/ei_epoch:   
                                                                2.581           
                                                                val/ei_term1_ep…
                                                                3.784           
                                                                val/ei_term2_ep…
                                                                1.377 val/loss: 
                                                                0.013 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-27 18:23:58,311[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 18:23:58,315[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'da6bab3a5b974fec80c10775'. Data corruption may occur if there is active process writing to Run 'da6bab3a5b974fec80c10775'.[0m
[[36m2024-09-27 18:23:58,329[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for da6bab3a5b974fec80c10775[0m
[[36m2024-09-27 18:23:58,331[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 18:23:58,331[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe897b67f40>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints/epoch_011.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints/epoch_011.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014809324406087399    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -58.19205093383789     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.013472187332808971    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.35it/s 
[[36m2024-09-27 18:24:00,107[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1/checkpoints/epoch_011.ckpt[0m
[[36m2024-09-27 18:24:00,112[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/1[0m
[[36m2024-09-27 18:24:00,113[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 18:24:00,117[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 18:24:00,356[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 18:24:00,358[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-27 18:24:00,422[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 18:24:00,438[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 18:24:00,451[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 18:24:00,452[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 18:24:00,454[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 18:24:00,456[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 18:24:00,456[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 18:24:00,457[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 18:24:00,457[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 18:24:00,459[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 18:24:00,472[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 18:24:00,480[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 6a2374690fa84ab78b2aa7e3[0m
[[36m2024-09-27 18:24:00,481[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 18:24:00,481[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe8979e98a0>[0m
[[36m2024-09-27 18:24:00,521[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 76/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:07 •       25.88it/s v_num: 73fd     
                                      0:00:00                   val/ei_step:    
                                                                3.342           
                                                                val/ei_term1_st…
                                                                5.205           
                                                                val/ei_term2_st…
                                                                1.479 val/MAE:  
                                                                0.011           
                                                                val/ei_epoch:   
                                                                3.257           
                                                                val/ei_term1_ep…
                                                                5.035           
                                                                val/ei_term2_ep…
                                                                1.479 val/loss: 
                                                                0.011 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-27 18:40:09,819[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 18:40:09,823[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '2cea6f8dcb8442faa68373fd'. Data corruption may occur if there is active process writing to Run '2cea6f8dcb8442faa68373fd'.[0m
[[36m2024-09-27 18:40:09,835[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2cea6f8dcb8442faa68373fd[0m
[[36m2024-09-27 18:40:09,836[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 18:40:09,836[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21da59fbb0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints/epoch_066.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints/epoch_066.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.0103348633274436     │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -74.81659698486328     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010294917970895767    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.78it/s 
[[36m2024-09-27 18:40:11,434[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints/epoch_066.ckpt[0m
[[36m2024-09-27 18:40:11,438[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3[0m
[[36m2024-09-27 18:40:11,440[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 18:40:11,443[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 18:40:11,674[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 18:40:11,676[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-27 18:40:11,739[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 18:40:11,753[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 18:40:11,766[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 18:40:11,766[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 18:40:11,769[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 18:40:11,771[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 18:40:11,771[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 18:40:11,772[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 18:40:11,772[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 18:40:11,774[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 18:40:11,786[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 18:40:11,794[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 40e8fa15202547349e81aa0a[0m
[[36m2024-09-27 18:40:11,795[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 18:40:11,795[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21cb2244c0>[0m
[[36m2024-09-27 18:40:11,838[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 108/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.22it/s v_num: aa0a    
                                       0:00:00                   val/ei_step:   
                                                                 3.462          
                                                                 val/ei_term1_s…
                                                                 5.525          
                                                                 val/ei_term2_s…
                                                                 1.398 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.389          
                                                                 val/ei_term1_e…
                                                                 5.381          
                                                                 val/ei_term2_e…
                                                                 1.397 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.011          
[[36m2024-09-27 20:11:09,731[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 20:11:09,735[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '40e8fa15202547349e81aa0a'. Data corruption may occur if there is active process writing to Run '40e8fa15202547349e81aa0a'.[0m
[[36m2024-09-27 20:11:09,748[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 40e8fa15202547349e81aa0a[0m
[[36m2024-09-27 20:11:09,749[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 20:11:09,749[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f21da6801f0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints/epoch_098.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints/epoch_098.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010128299705684185    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -79.96919250488281     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01011562068015337    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.57it/s 
[[36m2024-09-27 20:11:11,331[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints/epoch_098.ckpt[0m
[[36m2024-09-27 20:11:11,335[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4[0m
[[36m2024-09-27 20:11:11,337[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 126/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.81it/s v_num: a7e3    
                                       0:00:00                   val/ei_step:   
                                                                 3.587          
                                                                 val/ei_term1_s…
                                                                 5.744          
                                                                 val/ei_term2_s…
                                                                 1.431 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.535          
                                                                 val/ei_term1_e…
                                                                 5.636          
                                                                 val/ei_term2_e…
                                                                 1.435 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.011          
[[36m2024-09-27 21:14:06,811[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 21:14:06,814[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '6a2374690fa84ab78b2aa7e3'. Data corruption may occur if there is active process writing to Run '6a2374690fa84ab78b2aa7e3'.[0m
[[36m2024-09-27 21:14:06,828[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 6a2374690fa84ab78b2aa7e3[0m
[[36m2024-09-27 21:14:06,830[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 21:14:06,830[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe894f89ff0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints/epoch_116.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints/epoch_116.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010223816148936749    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -83.682861328125      │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010303583927452564    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.98it/s 
[[36m2024-09-27 21:14:08,406[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2/checkpoints/epoch_116.ckpt[0m
[[36m2024-09-27 21:14:08,411[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/2[0m
[[36m2024-09-27 21:14:08,412[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 21:14:08,416[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 21:14:08,639[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 21:14:08,640[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-27 21:14:08,699[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 21:14:08,713[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 21:14:08,726[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 21:14:08,727[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 21:14:08,729[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 21:14:08,730[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 21:14:08,731[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 21:14:08,731[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 21:14:08,732[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 21:14:08,733[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 21:14:08,745[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 21:14:08,753[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d48a4fa5b4d847e192a0daa4[0m
[[36m2024-09-27 21:14:08,754[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 21:14:08,754[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe894019c90>[0m
[[36m2024-09-27 21:14:08,795[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 27/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.07it/s v_num: daa4     
                                      0:00:00                   val/ei_step:    
                                                                2.626           
                                                                val/ei_term1_st…
                                                                3.880           
                                                                val/ei_term2_st…
                                                                1.371 val/MAE:  
                                                                0.014           
                                                                val/ei_epoch:   
                                                                2.589           
                                                                val/ei_term1_ep…
                                                                3.809           
                                                                val/ei_term2_ep…
                                                                1.370 val/loss: 
                                                                0.013 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-27 21:50:37,631[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 21:50:37,634[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'd48a4fa5b4d847e192a0daa4'. Data corruption may occur if there is active process writing to Run 'd48a4fa5b4d847e192a0daa4'.[0m
[[36m2024-09-27 21:50:37,649[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d48a4fa5b4d847e192a0daa4[0m
[[36m2024-09-27 21:50:37,650[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 21:50:37,651[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe89ac37250>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints/epoch_017.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints/epoch_017.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013967952691018581    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -57.58207702636719     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.012735455296933651    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.06it/s 
[[36m2024-09-27 21:50:39,238[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3/checkpoints/epoch_017.ckpt[0m
[[36m2024-09-27 21:50:39,243[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/3[0m
[[36m2024-09-27 21:50:39,244[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-27 21:50:39,248[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-27 21:50:39,470[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-27 21:50:39,472[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-27 21:50:39,530[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-27 21:50:39,544[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-27 21:50:39,558[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-27 21:50:39,558[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-27 21:50:39,561[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-27 21:50:39,562[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-27 21:50:39,562[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-27 21:50:39,563[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-27 21:50:39,563[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-27 21:50:39,565[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-27 21:50:39,577[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-27 21:50:39,584[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b7c6d462bb04417ca52ee52c[0m
[[36m2024-09-27 21:50:39,585[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 21:50:39,585[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe88d27e1d0>[0m
[[36m2024-09-27 21:50:39,627[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 90/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.13it/s v_num: e52c     
                                      0:00:00                   val/ei_step:    
                                                                3.502           
                                                                val/ei_term1_st…
                                                                5.627           
                                                                val/ei_term2_st…
                                                                1.377 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.403           
                                                                val/ei_term1_ep…
                                                                5.430           
                                                                val/ei_term2_ep…
                                                                1.376 val/loss: 
                                                                0.011 train/MAE:
                                                                0.011           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-27 23:50:37,376[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-27 23:50:37,379[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'b7c6d462bb04417ca52ee52c'. Data corruption may occur if there is active process writing to Run 'b7c6d462bb04417ca52ee52c'.[0m
[[36m2024-09-27 23:50:37,392[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b7c6d462bb04417ca52ee52c[0m
[[36m2024-09-27 23:50:37,393[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-27 23:50:37,394[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe88d24dcf0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints/epoch_080.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints/epoch_080.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010487239807844162    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -80.6722183227539     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010520292446017265    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.00it/s 
[[36m2024-09-27 23:50:38,978[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4/checkpoints/epoch_080.ckpt[0m
[[36m2024-09-27 23:50:38,982[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-27_15-48-38/4[0m
[[36m2024-09-27 23:50:38,984[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 17:09:48,497[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-28 17:09:48,497[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 17:09:48,499[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-28 17:09:48,499[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 17:09:48,709[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 17:09:48,711[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 17:09:48,714[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-28 17:09:48,715[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
Seed set to 2050
[[36m2024-09-28 17:09:48,784[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 17:09:48,785[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 17:09:49,937[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 17:09:49,954[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 17:09:50,065[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 17:09:50,066[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 17:09:50,067[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 17:09:50,068[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 17:09:50,069[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 17:09:50,070[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 17:09:50,071[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 17:09:50,071[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 17:09:50,072[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 17:09:50,072[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 17:09:50,074[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 17:09:50,074[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 17:09:50,075[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 17:09:50,075[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 17:09:50,959[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
[[36m2024-09-28 17:09:50,961[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 17:09:51,050[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 17:09:51,054[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 17:09:51,082[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for cad4c8385264497d9116150f[0m
[[36m2024-09-28 17:09:51,084[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 9df467809a5149c38f75d990[0m
[[36m2024-09-28 17:09:51,085[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 17:09:51,085[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ac2fd8640>[0m
[[36m2024-09-28 17:09:51,086[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 17:09:51,086[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcda6904f10>[0m
[[36m2024-09-28 17:09:51,170[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-09-28 17:09:51,243[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 77/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.40it/s v_num: 150f     
                                      0:00:00                   val/ei_step:    
                                                                3.396           
                                                                val/ei_term1_st…
                                                                5.381           
                                                                val/ei_term2_st…
                                                                1.412 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.309           
                                                                val/ei_term1_ep…
                                                                5.206           
                                                                val/ei_term2_ep…
                                                                1.411 val/loss: 
                                                                0.011 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-28 18:14:20,462[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 18:14:20,465[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'cad4c8385264497d9116150f'. Data corruption may occur if there is active process writing to Run 'cad4c8385264497d9116150f'.[0m
[[36m2024-09-28 18:14:20,474[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for cad4c8385264497d9116150f[0m
[[36m2024-09-28 18:14:20,474[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 18:14:20,475[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ac2fd8df0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0/checkpoints/epoch_067.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0/checkpoints/epoch_067.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010448227636516094    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -77.28856658935547     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01048948708921671    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.71it/s 
[[36m2024-09-28 18:14:22,173[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0/checkpoints/epoch_067.ckpt[0m
[[36m2024-09-28 18:14:22,175[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0[0m
[[36m2024-09-28 18:14:22,176[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 18:14:22,178[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 18:14:22,409[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 18:14:22,410[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-28 18:14:22,473[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 18:14:22,488[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 18:14:22,502[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 18:14:22,502[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 18:14:22,505[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 18:14:22,506[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 18:14:22,507[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 18:14:22,507[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 18:14:22,507[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 18:14:22,509[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 18:14:22,522[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 18:14:22,531[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a436f1578030499e81fa7895[0m
[[36m2024-09-28 18:14:22,532[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 18:14:22,532[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ad1add3c0>[0m
[[36m2024-09-28 18:14:22,574[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 19/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.89it/s v_num: 7895     
                                      0:00:00                   val/ei_step:    
                                                                2.745           
                                                                val/ei_term1_st…
                                                                4.063           
                                                                val/ei_term2_st…
                                                                1.428 val/MAE:  
                                                                0.014           
                                                                val/ei_epoch:   
                                                                2.654           
                                                                val/ei_term1_ep…
                                                                3.881           
                                                                val/ei_term2_ep…
                                                                1.427 val/loss: 
                                                                0.012 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-28 18:30:30,825[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 18:30:30,829[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a436f1578030499e81fa7895'. Data corruption may occur if there is active process writing to Run 'a436f1578030499e81fa7895'.[0m
[[36m2024-09-28 18:30:30,843[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a436f1578030499e81fa7895[0m
[[36m2024-09-28 18:30:30,844[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 18:30:30,845[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ad1aef970>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints/epoch_009.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints/epoch_009.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013553086668252945    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -57.12398910522461     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01231718622148037    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.76it/s 
[[36m2024-09-28 18:30:32,433[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints/epoch_009.ckpt[0m
[[36m2024-09-28 18:30:32,436[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1[0m
[[36m2024-09-28 18:30:32,437[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 18:30:32,439[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 18:30:32,689[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 18:30:32,691[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-28 18:30:32,754[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 18:30:32,768[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 18:30:32,781[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 18:30:32,782[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 18:30:32,784[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 18:30:32,786[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 18:30:32,786[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 18:30:32,787[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 18:30:32,787[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 18:30:32,789[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 18:30:32,801[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 18:30:32,809[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0f387767106c49ed835429bb[0m
[[36m2024-09-28 18:30:32,810[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 18:30:32,810[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0b059cb670>[0m
[[36m2024-09-28 18:30:32,851[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 33/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.27it/s v_num: 29bb     
                                      0:00:00                   val/ei_step:    
                                                                2.528           
                                                                val/ei_term1_st…
                                                                3.642           
                                                                val/ei_term2_st…
                                                                1.414 val/MAE:  
                                                                0.019           
                                                                val/ei_epoch:   
                                                                2.532           
                                                                val/ei_term1_ep…
                                                                3.650           
                                                                val/ei_term2_ep…
                                                                1.415 val/loss: 
                                                                0.016 train/MAE:
                                                                0.017           
                                                                train/loss:     
                                                                0.018           
[[36m2024-09-28 18:58:25,957[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 18:58:25,960[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '0f387767106c49ed835429bb'. Data corruption may occur if there is active process writing to Run '0f387767106c49ed835429bb'.[0m
[[36m2024-09-28 18:58:25,973[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0f387767106c49ed835429bb[0m
[[36m2024-09-28 18:58:25,974[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 18:58:25,974[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0acef1a170>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints/epoch_023.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints/epoch_023.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014084987342357635    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -64.17852020263672     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010933260433375835    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.65it/s 
[[36m2024-09-28 18:58:27,649[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints/epoch_023.ckpt[0m
[[36m2024-09-28 18:58:27,654[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2[0m
[[36m2024-09-28 18:58:27,655[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 18:58:27,659[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 18:58:27,887[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 18:58:27,889[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-28 18:58:28,150[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 18:58:28,165[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 18:58:28,177[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 18:58:28,178[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 18:58:28,180[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 18:58:28,181[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 18:58:28,182[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 18:58:28,183[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 18:58:28,183[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 18:58:28,185[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 18:58:28,197[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 18:58:28,204[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 47905954f3ee4e979d67b75e[0m
[[36m2024-09-28 18:58:28,205[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 18:58:28,206[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ad1b519c0>[0m
[[36m2024-09-28 18:58:28,245[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 93/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:06 •       27.09it/s v_num: d990     
                                      0:00:00                   val/ei_step:    
                                                                3.538           
                                                                val/ei_term1_st…
                                                                5.695           
                                                                val/ei_term2_st…
                                                                1.381 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.453           
                                                                val/ei_term1_ep…
                                                                5.526           
                                                                val/ei_term2_ep…
                                                                1.379 val/loss: 
                                                                0.010 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-28 19:15:01,997[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 19:15:02,002[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '9df467809a5149c38f75d990'. Data corruption may occur if there is active process writing to Run '9df467809a5149c38f75d990'.[0m
[[36m2024-09-28 19:15:02,014[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 9df467809a5149c38f75d990[0m
[[36m2024-09-28 19:15:02,015[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 19:15:02,015[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcdb8cfb0d0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0/checkpoints/epoch_083.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0/checkpoints/epoch_083.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010215059854090214    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -82.1435317993164     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010273439809679985    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.68it/s 
[[36m2024-09-28 19:15:03,705[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0/checkpoints/epoch_083.ckpt[0m
[[36m2024-09-28 19:15:03,710[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/0[0m
[[36m2024-09-28 19:15:03,711[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 19:15:03,716[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 19:15:03,952[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 19:15:03,954[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-28 19:15:04,018[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 19:15:04,033[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 19:15:04,048[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 19:15:04,048[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 19:15:04,051[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 19:15:04,052[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 19:15:04,053[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 19:15:04,053[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 19:15:04,054[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 19:15:04,056[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 19:15:04,069[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 19:15:04,077[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c85fb6a4d8e24e20a17f41b5[0m
[[36m2024-09-28 19:15:04,078[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 19:15:04,078[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcdb5ab3f70>[0m
[[36m2024-09-28 19:15:04,122[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 21/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:10 •       18.23it/s v_num: 41b5     
                                      0:00:00                   val/ei_step:    
                                                                2.610           
                                                                val/ei_term1_st…
                                                                3.842           
                                                                val/ei_term2_st…
                                                                1.378 val/MAE:  
                                                                0.015           
                                                                val/ei_epoch:   
                                                                2.581           
                                                                val/ei_term1_ep…
                                                                3.784           
                                                                val/ei_term2_ep…
                                                                1.377 val/loss: 
                                                                0.013 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-28 19:44:02,843[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 19:44:02,846[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c85fb6a4d8e24e20a17f41b5'. Data corruption may occur if there is active process writing to Run 'c85fb6a4d8e24e20a17f41b5'.[0m
[[36m2024-09-28 19:44:02,861[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c85fb6a4d8e24e20a17f41b5[0m
[[36m2024-09-28 19:44:02,862[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 19:44:02,862[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcd5c0fc640>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints/epoch_011.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints/epoch_011.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014809324406087399    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -58.19205093383789     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.013472187332808971    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.66it/s 
[[36m2024-09-28 19:44:04,549[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1/checkpoints/epoch_011.ckpt[0m
[[36m2024-09-28 19:44:04,553[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/1[0m
[[36m2024-09-28 19:44:04,555[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 19:44:04,559[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 19:44:04,797[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 19:44:04,799[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-28 19:44:04,863[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 19:44:04,878[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 19:44:04,892[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 19:44:04,893[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 19:44:04,895[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 19:44:04,896[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 19:44:04,897[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 19:44:04,897[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 19:44:04,898[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 19:44:04,900[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 19:44:04,912[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 19:44:04,920[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 9f1699b88bf041e28e66d5ed[0m
[[36m2024-09-28 19:44:04,921[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 19:44:04,922[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcda689f8b0>[0m
[[36m2024-09-28 19:44:04,963[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 76/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.68it/s v_num: b75e     
                                      0:00:00                   val/ei_step:    
                                                                3.342           
                                                                val/ei_term1_st…
                                                                5.205           
                                                                val/ei_term2_st…
                                                                1.479 val/MAE:  
                                                                0.011           
                                                                val/ei_epoch:   
                                                                3.257           
                                                                val/ei_term1_ep…
                                                                5.035           
                                                                val/ei_term2_ep…
                                                                1.479 val/loss: 
                                                                0.011 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-28 20:02:27,429[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 20:02:27,432[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '47905954f3ee4e979d67b75e'. Data corruption may occur if there is active process writing to Run '47905954f3ee4e979d67b75e'.[0m
[[36m2024-09-28 20:02:27,445[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 47905954f3ee4e979d67b75e[0m
[[36m2024-09-28 20:02:27,446[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 20:02:27,446[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0b05a2e3e0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints/epoch_066.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints/epoch_066.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.0103348633274436     │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -74.81659698486328     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010294917970895767    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.95it/s 
[[36m2024-09-28 20:02:29,041[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints/epoch_066.ckpt[0m
[[36m2024-09-28 20:02:29,046[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3[0m
[[36m2024-09-28 20:02:29,047[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 20:02:29,051[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 20:02:29,276[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 20:02:29,278[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-28 20:02:29,338[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 20:02:29,352[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 20:02:29,365[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 20:02:29,365[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 20:02:29,368[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 20:02:29,369[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 20:02:29,370[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 20:02:29,371[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 20:02:29,371[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 20:02:29,373[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 20:02:29,384[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 20:02:29,393[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 5627d2537eed4d79960be4f9[0m
[[36m2024-09-28 20:02:29,394[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 20:02:29,394[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ad1afc3d0>[0m
[[36m2024-09-28 20:02:29,438[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 108/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.48it/s v_num: e4f9    
                                       0:00:00                   val/ei_step:   
                                                                 3.462          
                                                                 val/ei_term1_s…
                                                                 5.525          
                                                                 val/ei_term2_s…
                                                                 1.398 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.389          
                                                                 val/ei_term1_e…
                                                                 5.381          
                                                                 val/ei_term2_e…
                                                                 1.397 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.011          
[[36m2024-09-28 21:33:06,730[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 21:33:06,734[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '5627d2537eed4d79960be4f9'. Data corruption may occur if there is active process writing to Run '5627d2537eed4d79960be4f9'.[0m
[[36m2024-09-28 21:33:06,746[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 5627d2537eed4d79960be4f9[0m
[[36m2024-09-28 21:33:06,747[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 21:33:06,748[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0ad1a337c0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints/epoch_098.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints/epoch_098.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010128299705684185    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -79.96919250488281     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01011562068015337    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.85it/s 
[[36m2024-09-28 21:33:08,327[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints/epoch_098.ckpt[0m
[[36m2024-09-28 21:33:08,331[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4[0m
[[36m2024-09-28 21:33:08,332[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 126/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.85it/s v_num: d5ed    
                                       0:00:00                   val/ei_step:   
                                                                 3.587          
                                                                 val/ei_term1_s…
                                                                 5.744          
                                                                 val/ei_term2_s…
                                                                 1.431 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.535          
                                                                 val/ei_term1_e…
                                                                 5.636          
                                                                 val/ei_term2_e…
                                                                 1.435 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.011          
[[36m2024-09-28 22:33:31,959[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 22:33:31,963[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '9f1699b88bf041e28e66d5ed'. Data corruption may occur if there is active process writing to Run '9f1699b88bf041e28e66d5ed'.[0m
[[36m2024-09-28 22:33:31,977[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 9f1699b88bf041e28e66d5ed[0m
[[36m2024-09-28 22:33:31,978[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 22:33:31,978[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcd700d1ae0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints/epoch_116.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints/epoch_116.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010223816148936749    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -83.682861328125      │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010303583927452564    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.42it/s 
[[36m2024-09-28 22:33:33,564[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2/checkpoints/epoch_116.ckpt[0m
[[36m2024-09-28 22:33:33,569[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/2[0m
[[36m2024-09-28 22:33:33,570[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 22:33:33,574[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 22:33:33,793[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 22:33:33,794[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-28 22:33:33,853[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 22:33:33,867[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 22:33:33,880[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 22:33:33,880[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 22:33:33,883[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 22:33:33,884[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 22:33:33,884[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 22:33:33,885[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 22:33:33,885[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 22:33:33,887[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 22:33:33,898[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 22:33:33,905[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 9a24e7050f7545528bc23a47[0m
[[36m2024-09-28 22:33:33,906[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 22:33:33,906[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcdb5a4b850>[0m
[[36m2024-09-28 22:33:33,953[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 27/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.50it/s v_num: 3a47     
                                      0:00:00                   val/ei_step:    
                                                                2.626           
                                                                val/ei_term1_st…
                                                                3.880           
                                                                val/ei_term2_st…
                                                                1.371 val/MAE:  
                                                                0.014           
                                                                val/ei_epoch:   
                                                                2.589           
                                                                val/ei_term1_ep…
                                                                3.809           
                                                                val/ei_term2_ep…
                                                                1.370 val/loss: 
                                                                0.013 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-28 23:09:55,913[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-28 23:09:55,917[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '9a24e7050f7545528bc23a47'. Data corruption may occur if there is active process writing to Run '9a24e7050f7545528bc23a47'.[0m
[[36m2024-09-28 23:09:55,931[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 9a24e7050f7545528bc23a47[0m
[[36m2024-09-28 23:09:55,933[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 23:09:55,933[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcdb5aa16c0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints/epoch_017.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints/epoch_017.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013967952691018581    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -57.58207702636719     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.012735455296933651    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.38it/s 
[[36m2024-09-28 23:09:57,524[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3/checkpoints/epoch_017.ckpt[0m
[[36m2024-09-28 23:09:57,528[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/3[0m
[[36m2024-09-28 23:09:57,530[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-28 23:09:57,534[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-28 23:09:57,755[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-28 23:09:57,757[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 1200                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-28 23:09:57,815[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-28 23:09:57,829[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-28 23:09:57,842[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-28 23:09:57,843[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-28 23:09:57,845[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-28 23:09:57,846[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-28 23:09:57,846[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-28 23:09:57,847[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-28 23:09:57,847[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-28 23:09:57,849[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-28 23:09:57,860[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-28 23:09:57,868[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for db99c9b0bd8043c1bcbb14e8[0m
[[36m2024-09-28 23:09:57,869[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-28 23:09:57,869[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcd700e6080>[0m
[[36m2024-09-28 23:09:57,911[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 90/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.79it/s v_num: 14e8     
                                      0:00:00                   val/ei_step:    
                                                                3.502           
                                                                val/ei_term1_st…
                                                                5.627           
                                                                val/ei_term2_st…
                                                                1.377 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.403           
                                                                val/ei_term1_ep…
                                                                5.430           
                                                                val/ei_term2_ep…
                                                                1.376 val/loss: 
                                                                0.011 train/MAE:
                                                                0.011           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-29 01:09:43,548[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-29 01:09:43,551[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'db99c9b0bd8043c1bcbb14e8'. Data corruption may occur if there is active process writing to Run 'db99c9b0bd8043c1bcbb14e8'.[0m
[[36m2024-09-29 01:09:43,563[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for db99c9b0bd8043c1bcbb14e8[0m
[[36m2024-09-29 01:09:43,564[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-29 01:09:43,564[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fcdb5a6ee60>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints/epoch_080.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints/epoch_080.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010487239807844162    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -80.6722183227539     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010520292446017265    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.39it/s 
[[36m2024-09-29 01:09:45,137[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4/checkpoints/epoch_080.ckpt[0m
[[36m2024-09-29 01:09:45,142[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-28_17-09-47/4[0m
[[36m2024-09-29 01:09:45,143[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-29 22:13:25,599[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-29 22:13:25,599[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-29 22:13:25,599[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-29 22:13:25,599[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-29 22:13:25,811[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-29 22:13:25,812[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-29 22:13:25,815[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-29 22:13:25,816[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
Seed set to 2050
[[36m2024-09-29 22:13:25,886[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-29 22:13:25,887[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-29 22:13:27,071[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-29 22:13:27,088[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-29 22:13:27,202[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-29 22:13:27,202[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-29 22:13:27,206[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-29 22:13:27,207[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-29 22:13:27,208[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-29 22:13:27,208[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-29 22:13:27,208[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-29 22:13:27,212[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-29 22:13:27,212[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-29 22:13:27,216[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-29 22:13:27,218[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-29 22:13:27,219[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-29 22:13:27,219[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-29 22:13:27,220[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-29 22:13:28,102[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-09-29 22:13:28,116[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-29 22:13:28,192[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-29 22:13:28,202[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-29 22:13:28,222[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 66019fbf20b04ea493065d31[0m
[[36m2024-09-29 22:13:28,223[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-29 22:13:28,224[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f964763d0f0>[0m
[[36m2024-09-29 22:13:28,225[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for cc8ffdef6c5f449a9f097676[0m
[[36m2024-09-29 22:13:28,226[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-29 22:13:28,226[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd86675cd90>[0m
[[36m2024-09-29 22:13:28,296[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2024-09-29 22:13:28,306[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 82/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.11it/s v_num: 7676     
                                      0:00:00                   val/ei_step:    
                                                                3.380           
                                                                val/ei_term1_st…
                                                                5.350           
                                                                val/ei_term2_st…
                                                                1.410 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.350           
                                                                val/ei_term1_ep…
                                                                5.288           
                                                                val/ei_term2_ep…
                                                                1.411 val/loss: 
                                                                0.011 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-29 23:22:16,224[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-29 23:22:16,229[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'cc8ffdef6c5f449a9f097676'. Data corruption may occur if there is active process writing to Run 'cc8ffdef6c5f449a9f097676'.[0m
[[36m2024-09-29 23:22:16,241[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for cc8ffdef6c5f449a9f097676[0m
[[36m2024-09-29 23:22:16,242[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-29 23:22:16,243[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd878b55ae0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0/checkpoints/epoch_072.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0/checkpoints/epoch_072.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01047887559980154    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -78.53643035888672     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010535620152950287    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.89it/s 
[[36m2024-09-29 23:22:17,829[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0/checkpoints/epoch_072.ckpt[0m
[[36m2024-09-29 23:22:17,834[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0[0m
[[36m2024-09-29 23:22:17,835[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-29 23:22:17,839[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-29 23:22:18,072[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-29 23:22:18,074[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-29 23:22:18,136[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-29 23:22:18,152[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-29 23:22:18,166[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-29 23:22:18,166[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-29 23:22:18,168[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-29 23:22:18,170[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-29 23:22:18,170[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-29 23:22:18,171[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-29 23:22:18,171[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-29 23:22:18,173[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-29 23:22:18,185[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-29 23:22:18,194[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b720b2652b504d26aab65800[0m
[[36m2024-09-29 23:22:18,195[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-29 23:22:18,195[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd87594c850>[0m
[[36m2024-09-29 23:22:18,239[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 71/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.31it/s v_num: 5800     
                                      0:00:00                   val/ei_step:    
                                                                3.320           
                                                                val/ei_term1_st…
                                                                5.253           
                                                                val/ei_term2_st…
                                                                1.386 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.302           
                                                                val/ei_term1_ep…
                                                                5.218           
                                                                val/ei_term2_ep…
                                                                1.386 val/loss: 
                                                                0.010 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-30 00:22:29,611[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 00:22:29,614[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'b720b2652b504d26aab65800'. Data corruption may occur if there is active process writing to Run 'b720b2652b504d26aab65800'.[0m
[[36m2024-09-30 00:22:29,627[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b720b2652b504d26aab65800[0m
[[36m2024-09-30 00:22:29,628[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 00:22:29,629[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd864171d20>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints/epoch_061.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints/epoch_061.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010674020275473595    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -77.47683715820312     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010606014169752598    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.46it/s 
[[36m2024-09-30 00:22:31,218[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints/epoch_061.ckpt[0m
[[36m2024-09-30 00:22:31,222[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1[0m
[[36m2024-09-30 00:22:31,224[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 00:22:31,228[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 00:22:31,455[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 00:22:31,457[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-30 00:22:31,520[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 00:22:31,535[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 00:22:31,548[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 00:22:31,548[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 00:22:31,551[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 00:22:31,552[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 00:22:31,552[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 00:22:31,553[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 00:22:31,553[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 00:22:31,555[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 00:22:31,567[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 00:22:31,575[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8e587cdb8c7649e4b957e54a[0m
[[36m2024-09-30 00:22:31,576[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 00:22:31,576[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd8666ff8e0>[0m
[[36m2024-09-30 00:22:31,618[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 12/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.59it/s v_num: e54a     
                                      0:00:00                   val/ei_step:    
                                                                2.730           
                                                                val/ei_term1_st…
                                                                4.017           
                                                                val/ei_term2_st…
                                                                1.442 val/MAE:  
                                                                0.016           
                                                                val/ei_epoch:   
                                                                2.732           
                                                                val/ei_term1_ep…
                                                                4.024           
                                                                val/ei_term2_ep…
                                                                1.440 val/loss: 
                                                                0.012 train/MAE:
                                                                0.021           
                                                                train/loss:     
                                                                0.023           
[[36m2024-09-30 00:33:05,739[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 00:33:05,743[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8e587cdb8c7649e4b957e54a'. Data corruption may occur if there is active process writing to Run '8e587cdb8c7649e4b957e54a'.[0m
[[36m2024-09-30 00:33:05,756[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8e587cdb8c7649e4b957e54a[0m
[[36m2024-09-30 00:33:05,757[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 00:33:05,757[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd8a99c6410>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints/epoch_002.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints/epoch_002.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.02227591723203659    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -59.182701110839844    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.017025712877511978    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.51it/s 
[[36m2024-09-30 00:33:07,352[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints/epoch_002.ckpt[0m
[[36m2024-09-30 00:33:07,355[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2[0m
[[36m2024-09-30 00:33:07,357[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 00:33:07,361[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 00:33:07,592[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 00:33:07,594[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-30 00:33:07,656[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 00:33:07,671[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 00:33:07,683[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 00:33:07,684[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 00:33:07,686[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 00:33:07,688[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 00:33:07,688[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 00:33:07,689[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 00:33:07,689[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 00:33:07,691[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 00:33:07,703[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 00:33:07,711[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a33fd55479fd49eeb5555e71[0m
[[36m2024-09-30 00:33:07,712[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 00:33:07,713[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd8758fd180>[0m
[[36m2024-09-30 00:33:07,754[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 107/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.56it/s v_num: 5d31    
                                       0:00:00                   val/ei_step:   
                                                                 3.514          
                                                                 val/ei_term1_s…
                                                                 5.647          
                                                                 val/ei_term2_s…
                                                                 1.380 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.490          
                                                                 val/ei_term1_e…
                                                                 5.601          
                                                                 val/ei_term2_e…
                                                                 1.379 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.010          
[[36m2024-09-30 00:35:44,158[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 00:35:44,163[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '66019fbf20b04ea493065d31'. Data corruption may occur if there is active process writing to Run '66019fbf20b04ea493065d31'.[0m
[[36m2024-09-30 00:35:44,177[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 66019fbf20b04ea493065d31[0m
[[36m2024-09-30 00:35:44,178[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 00:35:44,179[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f9659cf11b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0/checkpoints/epoch_097.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0/checkpoints/epoch_097.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010441267862915993    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -83.151611328125      │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01050840225070715    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.91it/s 
[[36m2024-09-30 00:35:45,867[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0/checkpoints/epoch_097.ckpt[0m
[[36m2024-09-30 00:35:45,872[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/0[0m
[[36m2024-09-30 00:35:45,874[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 00:35:45,877[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 00:35:46,114[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 00:35:46,116[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-09-30 00:35:46,181[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 00:35:46,196[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 00:35:46,211[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 00:35:46,211[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 00:35:46,214[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 00:35:46,215[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 00:35:46,216[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 00:35:46,216[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 00:35:46,217[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 00:35:46,218[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 00:35:46,231[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 00:35:46,240[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 1ca86a4de2fc452db5546450[0m
[[36m2024-09-30 00:35:46,240[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 00:35:46,241[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f9656b29e40>[0m
[[36m2024-09-30 00:35:46,285[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 21/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.08it/s v_num: 6450     
                                      0:00:00                   val/ei_step:    
                                                                2.578           
                                                                val/ei_term1_st…
                                                                3.779           
                                                                val/ei_term2_st…
                                                                1.378 val/MAE:  
                                                                0.015           
                                                                val/ei_epoch:   
                                                                2.579           
                                                                val/ei_term1_ep…
                                                                3.780           
                                                                val/ei_term2_ep…
                                                                1.377 val/loss: 
                                                                0.013 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-09-30 01:04:34,323[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 01:04:34,326[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '1ca86a4de2fc452db5546450'. Data corruption may occur if there is active process writing to Run '1ca86a4de2fc452db5546450'.[0m
[[36m2024-09-30 01:04:34,341[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 1ca86a4de2fc452db5546450[0m
[[36m2024-09-30 01:04:34,342[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 01:04:34,342[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f963420c310>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints/epoch_011.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints/epoch_011.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014623506926000118    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -58.104881286621094    │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.013355162926018238    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.84it/s 
[[36m2024-09-30 01:04:36,029[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1/checkpoints/epoch_011.ckpt[0m
[[36m2024-09-30 01:04:36,033[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/1[0m
[[36m2024-09-30 01:04:36,034[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 01:04:36,039[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 01:04:36,278[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 01:04:36,280[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-09-30 01:04:36,345[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 01:04:36,361[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 01:04:36,375[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 01:04:36,375[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 01:04:36,378[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 01:04:36,379[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 01:04:36,380[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 01:04:36,380[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 01:04:36,381[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 01:04:36,382[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 01:04:36,395[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 01:04:36,404[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0611c667751f49da832304a5[0m
[[36m2024-09-30 01:04:36,405[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 01:04:36,405[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f96475fee00>[0m
[[36m2024-09-30 01:04:36,444[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 106/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.82it/s v_num: 5e71    
                                       0:00:00                   val/ei_step:   
                                                                 3.285          
                                                                 val/ei_term1_s…
                                                                 5.089          
                                                                 val/ei_term2_s…
                                                                 1.480 val/MAE: 
                                                                 0.011          
                                                                 val/ei_epoch:  
                                                                 3.272          
                                                                 val/ei_term1_e…
                                                                 5.065          
                                                                 val/ei_term2_e…
                                                                 1.479 val/loss:
                                                                 0.011          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.011          
[[36m2024-09-30 02:02:19,788[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 02:02:19,791[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a33fd55479fd49eeb5555e71'. Data corruption may occur if there is active process writing to Run 'a33fd55479fd49eeb5555e71'.[0m
[[36m2024-09-30 02:02:19,802[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a33fd55479fd49eeb5555e71[0m
[[36m2024-09-30 02:02:19,803[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 02:02:19,804[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd8641928f0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints/epoch_096.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints/epoch_096.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01064634881913662    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -75.20655822753906     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010591310448944569    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.88it/s 
[[36m2024-09-30 02:02:21,486[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints/epoch_096.ckpt[0m
[[36m2024-09-30 02:02:21,491[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3[0m
[[36m2024-09-30 02:02:21,492[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 02:02:21,496[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 02:02:21,727[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 02:02:21,729[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-30 02:02:21,792[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 02:02:21,807[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 02:02:21,820[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 02:02:21,820[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 02:02:21,823[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 02:02:21,824[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 02:02:21,825[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 02:02:21,826[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 02:02:21,826[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 02:02:21,828[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 02:02:21,840[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 02:02:21,847[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8410f79822fc41d293626a9c[0m
[[36m2024-09-30 02:02:21,848[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 02:02:21,848[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd878b7a170>[0m
[[36m2024-09-30 02:02:21,891[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 84/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.60it/s v_num: 04a5     
                                      0:00:00                   val/ei_step:    
                                                                3.314           
                                                                val/ei_term1_st…
                                                                5.234           
                                                                val/ei_term2_st…
                                                                1.395 val/MAE:  
                                                                0.011           
                                                                val/ei_epoch:   
                                                                3.314           
                                                                val/ei_term1_ep…
                                                                5.234           
                                                                val/ei_term2_ep…
                                                                1.394 val/loss: 
                                                                0.011 train/MAE:
                                                                0.011           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-30 02:57:03,748[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 02:57:03,752[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '0611c667751f49da832304a5'. Data corruption may occur if there is active process writing to Run '0611c667751f49da832304a5'.[0m
[[36m2024-09-30 02:57:03,764[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0611c667751f49da832304a5[0m
[[36m2024-09-30 02:57:03,765[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 02:57:03,766[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f968ab39750>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints/epoch_074.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints/epoch_074.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.011140622198581696    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -77.77207946777344     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01114578265696764    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 15.91it/s 
[[36m2024-09-30 02:57:05,471[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2/checkpoints/epoch_074.ckpt[0m
[[36m2024-09-30 02:57:05,475[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/2[0m
[[36m2024-09-30 02:57:05,476[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 02:57:05,479[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 02:57:05,728[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 02:57:05,729[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-09-30 02:57:05,793[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 02:57:05,809[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 02:57:05,823[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 02:57:05,824[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 02:57:05,826[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 02:57:05,827[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 02:57:05,828[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 02:57:05,829[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 02:57:05,829[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 02:57:05,831[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 02:57:05,843[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 02:57:05,851[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 224cd0fb1b904f139cd0fad1[0m
[[36m2024-09-30 02:57:05,852[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 02:57:05,852[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f964c281030>[0m
[[36m2024-09-30 02:57:05,894[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 81/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.90it/s v_num: 6a9c     
                                      0:00:00                   val/ei_step:    
                                                                3.391           
                                                                val/ei_term1_st…
                                                                5.386           
                                                                val/ei_term2_st…
                                                                1.397 val/MAE:  
                                                                0.010           
                                                                val/ei_epoch:   
                                                                3.363           
                                                                val/ei_term1_ep…
                                                                5.329           
                                                                val/ei_term2_ep…
                                                                1.397 val/loss: 
                                                                0.010 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.011           
[[36m2024-09-30 03:11:07,407[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 03:11:07,410[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8410f79822fc41d293626a9c'. Data corruption may occur if there is active process writing to Run '8410f79822fc41d293626a9c'.[0m
[[36m2024-09-30 03:11:07,423[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8410f79822fc41d293626a9c[0m
[[36m2024-09-30 03:11:07,424[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 03:11:07,424[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd875883850>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints/epoch_071.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints/epoch_071.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010550756007432938    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -79.163818359375      │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01048164814710617    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 16.88it/s 
[[36m2024-09-30 03:11:09,004[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints/epoch_071.ckpt[0m
[[36m2024-09-30 03:11:09,008[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4[0m
[[36m2024-09-30 03:11:09,009[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 108/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.52it/s v_num: fad1    
                                       0:00:00                   val/ei_step:   
                                                                 3.415          
                                                                 val/ei_term1_s…
                                                                 5.456          
                                                                 val/ei_term2_s…
                                                                 1.375 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.406          
                                                                 val/ei_term1_e…
                                                                 5.437          
                                                                 val/ei_term2_e…
                                                                 1.375 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.011          
[[36m2024-09-30 05:19:25,014[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 05:19:25,017[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '224cd0fb1b904f139cd0fad1'. Data corruption may occur if there is active process writing to Run '224cd0fb1b904f139cd0fad1'.[0m
[[36m2024-09-30 05:19:25,032[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 224cd0fb1b904f139cd0fad1[0m
[[36m2024-09-30 05:19:25,033[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 05:19:25,034[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f9658b7d630>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints/epoch_098.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints/epoch_098.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010235627181828022    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -80.68744659423828     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │    0.01024037878960371    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.59it/s 
[[36m2024-09-30 05:19:26,625[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3/checkpoints/epoch_098.ckpt[0m
[[36m2024-09-30 05:19:26,629[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/3[0m
[[36m2024-09-30 05:19:26,631[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 05:19:26,635[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 05:19:26,858[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 05:19:26,860[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10000                                                               
│         - 20                                                                  
│         - 2000                                                                
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 0                                                                   
│         - 1200                                                                
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                              
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0]_1_0.5_2_0.01_1_0.01_-0.5.npy                                     
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         20, 2000]_1_0.5_2_0.01_1_0.01_-0.5.npy                                
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-09-30 05:19:26,919[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-09-30 05:19:26,933[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-09-30 05:19:26,946[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-09-30 05:19:26,946[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-09-30 05:19:26,948[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-09-30 05:19:26,950[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-09-30 05:19:26,950[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-09-30 05:19:26,951[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-09-30 05:19:26,951[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-09-30 05:19:26,952[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-09-30 05:19:26,964[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-09-30 05:19:26,972[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 29c156048ad941a89cfa5ca8[0m
[[36m2024-09-30 05:19:26,973[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 05:19:26,973[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f964c0395a0>[0m
[[36m2024-09-30 05:19:27,017[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 113/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.24it/s v_num: 5ca8    
                                       0:00:00                   val/ei_step:   
                                                                 3.563          
                                                                 val/ei_term1_s…
                                                                 5.748          
                                                                 val/ei_term2_s…
                                                                 1.379 val/MAE: 
                                                                 0.010          
                                                                 val/ei_epoch:  
                                                                 3.572          
                                                                 val/ei_term1_e…
                                                                 5.764          
                                                                 val/ei_term2_e…
                                                                 1.380 val/loss:
                                                                 0.010          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.010          
[[36m2024-09-30 07:49:01,150[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-09-30 07:49:01,153[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '29c156048ad941a89cfa5ca8'. Data corruption may occur if there is active process writing to Run '29c156048ad941a89cfa5ca8'.[0m
[[36m2024-09-30 07:49:01,167[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 29c156048ad941a89cfa5ca8[0m
[[36m2024-09-30 07:49:01,168[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-09-30 07:49:01,169[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f9658b69840>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints/epoch_103.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints/epoch_103.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010152896866202354    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -85.55164337158203     │
│    test/ei_term2_epoch    │    1.3862946033477783     │
│         test/loss         │   0.010230006650090218    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 17.50it/s 
[[36m2024-09-30 07:49:02,925[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4/checkpoints/epoch_103.ckpt[0m
[[36m2024-09-30 07:49:02,929[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-09-29_22-13-24/4[0m
[[36m2024-09-30 07:49:02,931[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-09-30 17:03:03,833[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-30 17:03:03,833[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:03,840[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-09-30 17:03:03,840[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,044[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,049[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,052[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,056[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,060[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,067[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,270[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,272[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,279[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,281[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,282[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,290[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,492[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,494[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,502[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,503[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,504[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,513[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,714[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,716[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,725[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:04,726[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:04,727[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-09-30 17:03:04,736[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-09-30 17:03:05,037[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:05,039[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
[[36m2024-09-30 17:03:05,050[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-09-30 17:03:05,052[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 134, in main
    extras(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 40, in extras
    rich_utils.print_config_tree(cfg, resolve=True, save_to_file=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/rank_zero.py", line 42, in wrapped_fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/rich_utils.py", line 62, in print_config_tree
    branch_content = OmegaConf.to_yaml(config_group, resolve=resolve)
omegaconf.errors.InterpolationKeyError: Interpolation key 'data.val.beta' not found
    full_key: data.path.val
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 134, in main
    extras(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 40, in extras
    rich_utils.print_config_tree(cfg, resolve=True, save_to_file=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/rank_zero.py", line 42, in wrapped_fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/rich_utils.py", line 62, in print_config_tree
    branch_content = OmegaConf.to_yaml(config_group, resolve=resolve)
omegaconf.errors.InterpolationKeyError: Interpolation key 'data.val.beta' not found
    full_key: data.path.val
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-02 18:35:08,155[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-02 18:35:08,155[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,165[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-02 18:35:08,165[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,371[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:08,375[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:08,382[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:08,386[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:08,387[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,398[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,601[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:08,603[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:08,613[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,615[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:08,617[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:08,627[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,826[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:08,828[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:08,838[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:08,841[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:08,843[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:08,852[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:09,051[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:09,052[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:09,062[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:09,066[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:09,068[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:35:09,077[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:35:09,375[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:09,376[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
[[36m2024-10-02 18:35:09,391[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:35:09,393[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 134, in main
    extras(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 40, in extras
    rich_utils.print_config_tree(cfg, resolve=True, save_to_file=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/rank_zero.py", line 42, in wrapped_fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/rich_utils.py", line 62, in print_config_tree
    branch_content = OmegaConf.to_yaml(config_group, resolve=resolve)
omegaconf.errors.InterpolationKeyError: Interpolation key 'data.val.beta' not found
    full_key: data.path.val
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 134, in main
    extras(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 40, in extras
    rich_utils.print_config_tree(cfg, resolve=True, save_to_file=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/rank_zero.py", line 42, in wrapped_fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/rich_utils.py", line 62, in print_config_tree
    branch_content = OmegaConf.to_yaml(config_group, resolve=resolve)
omegaconf.errors.InterpolationKeyError: Interpolation key 'data.val.beta' not found
    full_key: data.path.val
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-02 18:36:59,374[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-02 18:36:59,374[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:36:59,389[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-02 18:36:59,389[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:36:59,588[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:36:59,592[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:36:59,604[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:36:59,605[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:36:59,609[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:36:59,621[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:36:59,819[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:36:59,821[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:36:59,831[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:36:59,837[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:36:59,839[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:36:59,849[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:00,049[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:00,051[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:37:00,061[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:00,069[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:00,071[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:37:00,081[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:00,278[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:00,280[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:37:00,289[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:00,299[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:00,301[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:37:00,311[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:00,606[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:00,607[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
[[36m2024-10-02 18:37:00,631[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:00,633[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 134, in main
    extras(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 40, in extras
    rich_utils.print_config_tree(cfg, resolve=True, save_to_file=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/rank_zero.py", line 42, in wrapped_fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/rich_utils.py", line 62, in print_config_tree
    branch_content = OmegaConf.to_yaml(config_group, resolve=resolve)
omegaconf.errors.InterpolationKeyError: Interpolation key 'data.val.beta' not found
    full_key: data.path.val
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 134, in main
    extras(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 40, in extras
    rich_utils.print_config_tree(cfg, resolve=True, save_to_file=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/rank_zero.py", line 42, in wrapped_fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/rich_utils.py", line 62, in print_config_tree
    branch_content = OmegaConf.to_yaml(config_group, resolve=resolve)
omegaconf.errors.InterpolationKeyError: Interpolation key 'data.val.beta' not found
    full_key: data.path.val
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-02 18:37:28,468[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-02 18:37:28,469[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:28,473[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-02 18:37:28,473[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:37:28,681[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:28,685[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-02 18:37:28,686[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:37:28,690[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-02 18:37:28,756[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-02 18:37:28,762[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 18:37:29,900[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 18:37:29,918[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 18:37:30,030[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 18:37:30,030[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 18:37:30,033[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 18:37:30,034[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 18:37:30,035[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 18:37:30,035[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 18:37:30,036[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 18:37:30,036[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 18:37:30,037[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 18:37:30,041[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 18:37:30,042[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 18:37:30,043[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 18:37:30,043[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 18:37:30,044[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 18:37:30,940[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
[[36m2024-10-02 18:37:30,946[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 18:37:31,028[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 18:37:31,032[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 18:37:31,052[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 46e8daffdc3b4c0aa108b63a[0m
[[36m2024-10-02 18:37:31,053[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 18:37:31,053[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d55f016c0>[0m
[[36m2024-10-02 18:37:31,055[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c883c69bbd1344269771e64e[0m
[[36m2024-10-02 18:37:31,058[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 18:37:31,058[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f93c2149b10>[0m
[[36m2024-10-02 18:37:31,123[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-10-02 18:37:31,139[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 10/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.55it/s v_num: e64e     
                                      0:00:00                   val/ei_step:    
                                                                2.405           
                                                                val/ei_term1_st…
                                                                3.418           
                                                                val/ei_term2_st…
                                                                1.392 val/MAE:  
                                                                0.022           
                                                                val/ei_epoch:   
                                                                2.232           
                                                                val/ei_term1_ep…
                                                                3.070           
                                                                val/ei_term2_ep…
                                                                1.394 val/loss: 
                                                                0.025 train/MAE:
                                                                0.016           
                                                                train/loss:     
                                                                0.018           
[[36m2024-10-02 18:53:34,412[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 18:53:34,417[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c883c69bbd1344269771e64e'. Data corruption may occur if there is active process writing to Run 'c883c69bbd1344269771e64e'.[0m
[[36m2024-10-02 18:53:34,431[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c883c69bbd1344269771e64e[0m
[[36m2024-10-02 18:53:34,432[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 18:53:34,433[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f93c21db5e0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0/checkpoints/epoch_000-v1.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0/checkpoints/epoch_000-v1.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.034354180097579956    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -52.94525909423828     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.03874198719859123    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.44it/s 
[[36m2024-10-02 18:53:36,208[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0/checkpoints/epoch_000-v1.ckpt[0m
[[36m2024-10-02 18:53:36,212[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0[0m
[[36m2024-10-02 18:53:36,214[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 18:53:36,218[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:53:36,459[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:53:36,461[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-02 18:53:36,527[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 18:53:36,544[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 18:53:36,559[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 18:53:36,559[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 18:53:36,562[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 18:53:36,563[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 18:53:36,563[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 18:53:36,564[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 18:53:36,564[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 18:53:36,566[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 18:53:36,579[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 18:53:36,587[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c97f68d8eb604f999400247b[0m
[[36m2024-10-02 18:53:36,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 18:53:36,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f93a81fec50>[0m
[[36m2024-10-02 18:53:36,631[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 19/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.23it/s v_num: b63a     
                                      0:00:00                   val/ei_step:    
                                                                2.682           
                                                                val/ei_term1_st…
                                                                3.942           
                                                                val/ei_term2_st…
                                                                1.421 val/MAE:  
                                                                0.032           
                                                                val/ei_epoch:   
                                                                2.072           
                                                                val/ei_term1_ep…
                                                                2.724           
                                                                val/ei_term2_ep…
                                                                1.421 val/loss: 
                                                                0.036 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.017           
[[36m2024-10-02 18:55:43,296[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 18:55:43,301[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '46e8daffdc3b4c0aa108b63a'. Data corruption may occur if there is active process writing to Run '46e8daffdc3b4c0aa108b63a'.[0m
[[36m2024-10-02 18:55:43,314[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 46e8daffdc3b4c0aa108b63a[0m
[[36m2024-10-02 18:55:43,315[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 18:55:43,315[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d6854aaa0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0/checkpoints/epoch_009.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0/checkpoints/epoch_009.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.018716998398303986    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -50.82126235961914     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.021146347746253014    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.35it/s 
[[36m2024-10-02 18:55:45,106[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0/checkpoints/epoch_009.ckpt[0m
[[36m2024-10-02 18:55:45,111[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/0[0m
[[36m2024-10-02 18:55:45,112[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 18:55:45,116[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 18:55:45,346[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 18:55:45,348[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-02 18:55:45,412[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 18:55:45,428[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 18:55:45,442[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 18:55:45,442[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 18:55:45,445[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 18:55:45,446[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 18:55:45,447[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 18:55:45,447[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 18:55:45,448[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 18:55:45,450[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 18:55:45,462[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 18:55:45,470[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for af9e08861ce24ef6ab49475b[0m
[[36m2024-10-02 18:55:45,471[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 18:55:45,471[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d65373610>[0m
[[36m2024-10-02 18:55:45,514[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 16/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.65it/s v_num: 475b     
                                      0:00:00                   val/ei_step:    
                                                                2.746           
                                                                val/ei_term1_st…
                                                                4.075           
                                                                val/ei_term2_st…
                                                                1.417 val/MAE:  
                                                                0.022           
                                                                val/ei_epoch:   
                                                                2.275           
                                                                val/ei_term1_ep…
                                                                3.134           
                                                                val/ei_term2_ep…
                                                                1.417 val/loss: 
                                                                0.025 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.016           
[[36m2024-10-02 19:11:09,056[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 19:11:09,059[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'af9e08861ce24ef6ab49475b'. Data corruption may occur if there is active process writing to Run 'af9e08861ce24ef6ab49475b'.[0m
[[36m2024-10-02 19:11:09,072[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for af9e08861ce24ef6ab49475b[0m
[[36m2024-10-02 19:11:09,073[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:11:09,074[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d674a7910>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints/epoch_006.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints/epoch_006.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.017173683270812035    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -51.48766326904297     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.019808296114206314    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.28it/s 
[[36m2024-10-02 19:11:10,869[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints/epoch_006.ckpt[0m
[[36m2024-10-02 19:11:10,873[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1[0m
[[36m2024-10-02 19:11:10,874[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 19:11:10,878[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 19:11:11,111[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 19:11:11,113[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-02 19:11:11,176[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 19:11:11,192[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 19:11:11,205[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 19:11:11,205[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 19:11:11,208[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 19:11:11,209[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 19:11:11,210[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 19:11:11,210[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 19:11:11,211[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 19:11:11,212[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 19:11:11,225[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 19:11:11,233[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ac1bc6dbe6794d93a20d5b48[0m
[[36m2024-10-02 19:11:11,234[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:11:11,234[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d9922ba30>[0m
[[36m2024-10-02 19:11:11,277[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 18/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:10 •       18.55it/s v_num: 247b     
                                      0:00:00                   val/ei_step:    
                                                                2.367           
                                                                val/ei_term1_st…
                                                                3.371           
                                                                val/ei_term2_st…
                                                                1.362 val/MAE:  
                                                                0.023           
                                                                val/ei_epoch:   
                                                                2.313           
                                                                val/ei_term1_ep…
                                                                3.264           
                                                                val/ei_term2_ep…
                                                                1.363 val/loss: 
                                                                0.025 train/MAE:
                                                                0.016           
                                                                train/loss:     
                                                                0.017           
[[36m2024-10-02 19:21:03,413[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 19:21:03,416[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c97f68d8eb604f999400247b'. Data corruption may occur if there is active process writing to Run 'c97f68d8eb604f999400247b'.[0m
[[36m2024-10-02 19:21:03,429[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c97f68d8eb604f999400247b[0m
[[36m2024-10-02 19:21:03,430[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:21:03,430[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f93d15ba320>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints/epoch_008.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints/epoch_008.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.020805273205041885    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -50.986297607421875    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.023191701620817184    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.65it/s 
[[36m2024-10-02 19:21:05,228[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1/checkpoints/epoch_008.ckpt[0m
[[36m2024-10-02 19:21:05,232[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/1[0m
[[36m2024-10-02 19:21:05,233[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 19:21:05,237[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 19:21:05,477[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 19:21:05,479[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-02 19:21:05,544[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 19:21:05,560[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 19:21:05,574[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 19:21:05,574[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 19:21:05,576[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 19:21:05,577[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 19:21:05,578[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 19:21:05,579[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 19:21:05,579[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 19:21:05,581[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 19:21:05,593[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 19:21:05,601[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for bbbd575d6f614ba29efce645[0m
[[36m2024-10-02 19:21:05,602[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:21:05,602[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f94054c3880>[0m
[[36m2024-10-02 19:21:05,644[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 23/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.33it/s v_num: 5b48     
                                      0:00:00                   val/ei_step:    
                                                                2.624           
                                                                val/ei_term1_st…
                                                                3.848           
                                                                val/ei_term2_st…
                                                                1.401 val/MAE:  
                                                                0.020           
                                                                val/ei_epoch:   
                                                                2.330           
                                                                val/ei_term1_ep…
                                                                3.261           
                                                                val/ei_term2_ep…
                                                                1.399 val/loss: 
                                                                0.022 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.016           
[[36m2024-10-02 19:32:50,817[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 19:32:50,820[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ac1bc6dbe6794d93a20d5b48'. Data corruption may occur if there is active process writing to Run 'ac1bc6dbe6794d93a20d5b48'.[0m
[[36m2024-10-02 19:32:50,836[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ac1bc6dbe6794d93a20d5b48[0m
[[36m2024-10-02 19:32:50,837[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:32:50,838[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d3c1bd9c0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints/epoch_013.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints/epoch_013.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01675889454782009    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -54.412445068359375    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.018681392073631287    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.59it/s 
[[36m2024-10-02 19:32:52,633[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints/epoch_013.ckpt[0m
[[36m2024-10-02 19:32:52,637[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2[0m
[[36m2024-10-02 19:32:52,639[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 19:32:52,643[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 19:32:52,878[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 19:32:52,880[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-02 19:32:52,944[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 19:32:52,960[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 19:32:52,973[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 19:32:52,973[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 19:32:52,976[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 19:32:52,977[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 19:32:52,978[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 19:32:52,978[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 19:32:52,978[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 19:32:52,980[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 19:32:52,992[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 19:32:53,001[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b4f57f4fdb0646549499f331[0m
[[36m2024-10-02 19:32:53,002[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:32:53,002[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d3c081f90>[0m
[[36m2024-10-02 19:32:53,044[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 12/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.92it/s v_num: f331     
                                      0:00:00                   val/ei_step:    
                                                                2.620           
                                                                val/ei_term1_st…
                                                                3.785           
                                                                val/ei_term2_st…
                                                                1.455 val/MAE:  
                                                                0.019           
                                                                val/ei_epoch:   
                                                                2.363           
                                                                val/ei_term1_ep…
                                                                3.270           
                                                                val/ei_term2_ep…
                                                                1.456 val/loss: 
                                                                0.021 train/MAE:
                                                                0.015           
                                                                train/loss:     
                                                                0.017           
[[36m2024-10-02 19:44:25,331[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 19:44:25,334[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'b4f57f4fdb0646549499f331'. Data corruption may occur if there is active process writing to Run 'b4f57f4fdb0646549499f331'.[0m
[[36m2024-10-02 19:44:25,347[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b4f57f4fdb0646549499f331[0m
[[36m2024-10-02 19:44:25,348[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:44:25,349[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d652197b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints/epoch_002.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints/epoch_002.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.02196398749947548    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -49.571598052978516    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.02621801197528839    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.37it/s 
[[36m2024-10-02 19:44:27,130[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints/epoch_002.ckpt[0m
[[36m2024-10-02 19:44:27,135[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3[0m
[[36m2024-10-02 19:44:27,136[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 19:44:27,140[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 19:44:27,374[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 19:44:27,375[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-02 19:44:27,438[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 19:44:27,454[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 19:44:27,467[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 19:44:27,467[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 19:44:27,470[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 19:44:27,471[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 19:44:27,472[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 19:44:27,472[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 19:44:27,473[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 19:44:27,475[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 19:44:27,487[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 19:44:27,495[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b0ad8af6a6eb4db8a2156ab8[0m
[[36m2024-10-02 19:44:27,496[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 19:44:27,496[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d65248970>[0m
[[36m2024-10-02 19:44:27,538[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 33/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.46it/s v_num: e645     
                                      0:00:00                   val/ei_step:    
                                                                2.763           
                                                                val/ei_term1_st…
                                                                4.121           
                                                                val/ei_term2_st…
                                                                1.405 val/MAE:  
                                                                0.018           
                                                                val/ei_epoch:   
                                                                2.548           
                                                                val/ei_term1_ep…
                                                                3.693           
                                                                val/ei_term2_ep…
                                                                1.404 val/loss: 
                                                                0.019 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.015           
[[36m2024-10-02 20:10:20,822[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 20:10:20,825[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'bbbd575d6f614ba29efce645'. Data corruption may occur if there is active process writing to Run 'bbbd575d6f614ba29efce645'.[0m
[[36m2024-10-02 20:10:20,839[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for bbbd575d6f614ba29efce645[0m
[[36m2024-10-02 20:10:20,840[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 20:10:20,841[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f9405997fa0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints/epoch_023.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints/epoch_023.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014460384845733643    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -59.76786804199219     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01572476327419281    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.04it/s 
[[36m2024-10-02 20:10:22,617[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2/checkpoints/epoch_023.ckpt[0m
[[36m2024-10-02 20:10:22,621[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/2[0m
[[36m2024-10-02 20:10:22,623[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 20:10:22,626[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 20:10:22,852[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 20:10:22,854[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-02 20:10:22,917[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 20:10:22,933[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 20:10:22,946[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 20:10:22,946[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 20:10:22,949[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 20:10:22,950[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 20:10:22,951[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 20:10:22,951[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 20:10:22,951[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 20:10:22,953[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 20:10:22,965[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 20:10:22,973[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8684631b2d2b46fb8e950ac7[0m
[[36m2024-10-02 20:10:22,974[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 20:10:22,974[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f93d15737c0>[0m
[[36m2024-10-02 20:10:23,017[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 101/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:07 •       23.89it/s v_num: 6ab8    
                                       0:00:00                   val/ei_step:   
                                                                 3.548          
                                                                 val/ei_term1_s…
                                                                 5.711          
                                                                 val/ei_term2_s…
                                                                 1.384 val/MAE: 
                                                                 0.011          
                                                                 val/ei_epoch:  
                                                                 3.508          
                                                                 val/ei_term1_e…
                                                                 5.632          
                                                                 val/ei_term2_e…
                                                                 1.384 val/loss:
                                                                 0.011          
                                                                 train/MAE:     
                                                                 0.010          
                                                                 train/loss:    
                                                                 0.010          
[[36m2024-10-02 21:16:23,241[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 21:16:23,244[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'b0ad8af6a6eb4db8a2156ab8'. Data corruption may occur if there is active process writing to Run 'b0ad8af6a6eb4db8a2156ab8'.[0m
[[36m2024-10-02 21:16:23,258[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b0ad8af6a6eb4db8a2156ab8[0m
[[36m2024-10-02 21:16:23,259[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 21:16:23,259[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f3d631776a0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints/epoch_091.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints/epoch_091.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010821902193129063    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -85.49191284179688     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01106998510658741    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.31it/s 
[[36m2024-10-02 21:16:25,037[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints/epoch_091.ckpt[0m
[[36m2024-10-02 21:16:25,041[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4[0m
[[36m2024-10-02 21:16:25,042[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 50/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.16it/s v_num: 0ac7     
                                      0:00:00                   val/ei_step:    
                                                                2.933           
                                                                val/ei_term1_st…
                                                                4.489           
                                                                val/ei_term2_st…
                                                                1.376 val/MAE:  
                                                                0.013           
                                                                val/ei_epoch:   
                                                                2.915           
                                                                val/ei_term1_ep…
                                                                4.453           
                                                                val/ei_term2_ep…
                                                                1.376 val/loss: 
                                                                0.014 train/MAE:
                                                                0.013           
                                                                train/loss:     
                                                                0.014           
[[36m2024-10-02 21:23:51,596[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 21:23:51,600[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8684631b2d2b46fb8e950ac7'. Data corruption may occur if there is active process writing to Run '8684631b2d2b46fb8e950ac7'.[0m
[[36m2024-10-02 21:23:51,614[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8684631b2d2b46fb8e950ac7[0m
[[36m2024-10-02 21:23:51,615[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 21:23:51,616[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f94055cb5b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints/epoch_040.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints/epoch_040.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012349317781627178    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -68.17796325683594     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013049968518316746    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.15it/s 
[[36m2024-10-02 21:23:53,310[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3/checkpoints/epoch_040.ckpt[0m
[[36m2024-10-02 21:23:53,315[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/3[0m
[[36m2024-10-02 21:23:53,316[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-02 21:23:53,320[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-02 21:23:53,544[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-02 21:23:53,546[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 10                                                          
│       max_epochs: 2000                                                        
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-02 21:23:53,606[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-02 21:23:53,621[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-02 21:23:53,634[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-02 21:23:53,635[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-02 21:23:53,637[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-02 21:23:53,638[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-02 21:23:53,639[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-02 21:23:53,639[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-02 21:23:53,640[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-02 21:23:53,641[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-02 21:23:53,653[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-02 21:23:53,661[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 862899074f484b929aa5259a[0m
[[36m2024-10-02 21:23:53,662[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 21:23:53,662[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f93cf463b50>[0m
[[36m2024-10-02 21:23:53,706[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 46/1999 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.72it/s v_num: 259a     
                                      0:00:00                   val/ei_step:    
                                                                2.894           
                                                                val/ei_term1_st…
                                                                4.395           
                                                                val/ei_term2_st…
                                                                1.393 val/MAE:  
                                                                0.015           
                                                                val/ei_epoch:   
                                                                2.821           
                                                                val/ei_term1_ep…
                                                                4.248           
                                                                val/ei_term2_ep…
                                                                1.394 val/loss: 
                                                                0.016 train/MAE:
                                                                0.014           
                                                                train/loss:     
                                                                0.015           
[[36m2024-10-02 22:30:50,014[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-02 22:30:50,018[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '862899074f484b929aa5259a'. Data corruption may occur if there is active process writing to Run '862899074f484b929aa5259a'.[0m
[[36m2024-10-02 22:30:50,031[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 862899074f484b929aa5259a[0m
[[36m2024-10-02 22:30:50,032[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-02 22:30:50,032[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f94055c93c0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints/epoch_036.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints/epoch_036.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013280621729791164    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -71.56527709960938     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013852298259735107    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.26it/s 
[[36m2024-10-02 22:30:51,716[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4/checkpoints/epoch_036.ckpt[0m
[[36m2024-10-02 22:30:51,720[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-02_18-37-27/4[0m
[[36m2024-10-02 22:30:51,722[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-03 23:23:46,982[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-03 23:23:46,982[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-03 23:23:46,988[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-03 23:23:46,988[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-03 23:23:47,194[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-03 23:23:47,199[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-03 23:23:47,201[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-03 23:23:47,206[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-03 23:23:47,269[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-03 23:23:47,276[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-03 23:23:48,450[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-03 23:23:48,453[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-03 23:23:48,562[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-03 23:23:48,563[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-03 23:23:48,566[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-03 23:23:48,567[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-03 23:23:48,568[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-03 23:23:48,568[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-03 23:23:48,569[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-03 23:23:48,590[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-03 23:23:48,590[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-03 23:23:48,594[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-03 23:23:48,596[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-03 23:23:48,597[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-03 23:23:48,597[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-03 23:23:48,598[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-03 23:23:49,449[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-03 23:23:49,479[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-03 23:23:49,536[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[[36m2024-10-03 23:23:49,562[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a7d2516799c2424d8ad9cec5[0m
[[36m2024-10-03 23:23:49,563[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-03 23:23:49,563[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa7f3fe1bd0>[0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-03 23:23:49,565[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-03 23:23:49,587[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f605b5313d254e6dba17eb76[0m
[[36m2024-10-03 23:23:49,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-03 23:23:49,588[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f53671c5900>[0m
[[36m2024-10-03 23:23:49,639[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-03 23:23:49,675[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=30` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=30` or `min_steps=None` has not been met. Training will continue...
Epoch 29/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.52it/s v_num: eb76      
                                     0:00:00                   val/ei_step:     
                                                               2.669            
                                                               val/ei_term1_ste…
                                                               3.933            
                                                               val/ei_term2_ste…
                                                               1.404 val/MAE:   
                                                               0.015            
                                                               val/ei_epoch:    
                                                               2.643            
                                                               val/ei_term1_epo…
                                                               3.883            
                                                               val/ei_term2_epo…
                                                               1.404 val/loss:  
                                                               0.016 train/MAE: 
                                                               0.014 train/loss:
                                                               0.015            
[[36m2024-10-03 23:50:37,820[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-03 23:50:37,825[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'f605b5313d254e6dba17eb76'. Data corruption may occur if there is active process writing to Run 'f605b5313d254e6dba17eb76'.[0m
[[36m2024-10-03 23:50:37,838[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f605b5313d254e6dba17eb76[0m
[[36m2024-10-03 23:50:37,840[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-03 23:50:37,840[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f53671c62f0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0/checkpoints/epoch_029.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0/checkpoints/epoch_029.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014664185233414173    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -58.862247467041016    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01616748981177807    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.76it/s 
[[36m2024-10-03 23:50:39,534[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0/checkpoints/epoch_029.ckpt[0m
[[36m2024-10-03 23:50:39,539[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0[0m
[[36m2024-10-03 23:50:39,540[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-03 23:50:39,544[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-03 23:50:39,767[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-03 23:50:39,769[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-03 23:50:39,830[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-03 23:50:39,845[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-03 23:50:39,858[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-03 23:50:39,859[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-03 23:50:39,861[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-03 23:50:39,862[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-03 23:50:39,863[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-03 23:50:39,864[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-03 23:50:39,864[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-03 23:50:39,866[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-03 23:50:39,878[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-03 23:50:39,886[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d908f33da8d94c7cb22e2d23[0m
[[36m2024-10-03 23:50:39,887[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-03 23:50:39,887[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f53763d4eb0>[0m
[[36m2024-10-03 23:50:39,929[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=30` or `min_steps=None` has not been met. Training will continue...
Epoch 29/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:10 •       18.50it/s v_num: cec5      
                                     0:00:00                   val/ei_step:     
                                                               2.992            
                                                               val/ei_term1_ste…
                                                               4.594            
                                                               val/ei_term2_ste…
                                                               1.390 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               2.930            
                                                               val/ei_term1_epo…
                                                               4.472            
                                                               val/ei_term2_epo…
                                                               1.388 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-04 00:06:56,294[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 00:06:56,299[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a7d2516799c2424d8ad9cec5'. Data corruption may occur if there is active process writing to Run 'a7d2516799c2424d8ad9cec5'.[0m
[[36m2024-10-04 00:06:56,313[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a7d2516799c2424d8ad9cec5[0m
[[36m2024-10-04 00:06:56,315[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:06:56,315[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa7f3fe2230>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0/checkpoints/epoch_029-v1.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0/checkpoints/epoch_029-v1.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01303885504603386    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -67.8270263671875     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013904710300266743    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.73it/s 
[[36m2024-10-04 00:06:58,115[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0/checkpoints/epoch_029-v1.ckpt[0m
[[36m2024-10-04 00:06:58,120[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/0[0m
[[36m2024-10-04 00:06:58,122[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 00:06:58,126[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 00:06:58,373[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 00:06:58,375[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-04 00:06:58,441[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 00:06:58,457[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 00:06:58,473[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 00:06:58,473[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 00:06:58,475[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 00:06:58,477[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 00:06:58,477[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 00:06:58,478[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 00:06:58,478[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 00:06:58,480[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 00:06:58,493[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 00:06:58,501[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 4b753cf4c7814601a2dbe94e[0m
[[36m2024-10-04 00:06:58,502[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:06:58,502[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa804561d20>[0m
[[36m2024-10-04 00:06:58,546[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 29/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.28it/s v_num: 2d23      
                                     0:00:00                   val/ei_step:     
                                                               3.016            
                                                               val/ei_term1_ste…
                                                               4.619            
                                                               val/ei_term2_ste…
                                                               1.413 val/MAE:   
                                                               0.018            
                                                               val/ei_epoch:    
                                                               2.737            
                                                               val/ei_term1_epo…
                                                               4.061            
                                                               val/ei_term2_epo…
                                                               1.413 val/loss:  
                                                               0.019 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-04 00:17:38,786[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 00:17:38,789[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'd908f33da8d94c7cb22e2d23'. Data corruption may occur if there is active process writing to Run 'd908f33da8d94c7cb22e2d23'.[0m
[[36m2024-10-04 00:17:38,804[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d908f33da8d94c7cb22e2d23[0m
[[36m2024-10-04 00:17:38,805[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:17:38,806[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f53794d1060>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints/epoch_029.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints/epoch_029.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.017923569306731224    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -61.84211349487305     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01881188526749611    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.62it/s 
[[36m2024-10-04 00:17:40,498[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints/epoch_029.ckpt[0m
[[36m2024-10-04 00:17:40,502[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1[0m
[[36m2024-10-04 00:17:40,503[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 00:17:40,507[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 00:17:40,742[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 00:17:40,743[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-04 00:17:40,807[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 00:17:40,823[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 00:17:40,837[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 00:17:40,837[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 00:17:40,840[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 00:17:40,841[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 00:17:40,841[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 00:17:40,842[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 00:17:40,842[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 00:17:40,844[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 00:17:40,856[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 00:17:40,864[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 79a355fe76f448e8b5655889[0m
[[36m2024-10-04 00:17:40,865[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:17:40,866[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f53794e7220>[0m
[[36m2024-10-04 00:17:40,905[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=30` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=30` or `min_steps=None` has not been met. Training will continue...
Epoch 29/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:06 •       30.26it/s v_num: 5889      
                                     0:00:00                   val/ei_step:     
                                                               3.014            
                                                               val/ei_term1_ste…
                                                               4.629            
                                                               val/ei_term2_ste…
                                                               1.399 val/MAE:   
                                                               0.014            
                                                               val/ei_epoch:    
                                                               2.872            
                                                               val/ei_term1_epo…
                                                               4.345            
                                                               val/ei_term2_epo…
                                                               1.398 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-04 00:44:29,068[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 00:44:29,071[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '79a355fe76f448e8b5655889'. Data corruption may occur if there is active process writing to Run '79a355fe76f448e8b5655889'.[0m
[[36m2024-10-04 00:44:29,085[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 79a355fe76f448e8b5655889[0m
[[36m2024-10-04 00:44:29,087[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:44:29,087[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5379563760>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints/epoch_029.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints/epoch_029.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013623847626149654    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -65.99542236328125     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01452163327485323    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.29it/s 
[[36m2024-10-04 00:44:30,770[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints/epoch_029.ckpt[0m
[[36m2024-10-04 00:44:30,774[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2[0m
[[36m2024-10-04 00:44:30,775[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 00:44:30,779[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 00:44:31,015[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 00:44:31,017[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-04 00:44:31,082[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 00:44:31,097[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 00:44:31,110[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 00:44:31,110[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 00:44:31,113[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 00:44:31,114[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 00:44:31,115[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 00:44:31,115[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 00:44:31,116[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 00:44:31,117[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 00:44:31,130[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 00:44:31,139[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8ad8f620110d464ca61277f3[0m
[[36m2024-10-04 00:44:31,140[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:44:31,140[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f52f013b3d0>[0m
[[36m2024-10-04 00:44:31,183[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 29/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.49it/s v_num: e94e      
                                     0:00:00                   val/ei_step:     
                                                               3.055            
                                                               val/ei_term1_ste…
                                                               4.741            
                                                               val/ei_term2_ste…
                                                               1.368 val/MAE:   
                                                               0.019            
                                                               val/ei_epoch:    
                                                               2.806            
                                                               val/ei_term1_epo…
                                                               4.245            
                                                               val/ei_term2_epo…
                                                               1.368 val/loss:  
                                                               0.019 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-04 00:50:14,367[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 00:50:14,370[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '4b753cf4c7814601a2dbe94e'. Data corruption may occur if there is active process writing to Run '4b753cf4c7814601a2dbe94e'.[0m
[[36m2024-10-04 00:50:14,384[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 4b753cf4c7814601a2dbe94e[0m
[[36m2024-10-04 00:50:14,386[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:50:14,386[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa80342b880>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints/epoch_029-v1.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints/epoch_029-v1.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.018504347652196884    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -64.58582305908203     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.019183354452252388    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.41it/s 
[[36m2024-10-04 00:50:16,166[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1/checkpoints/epoch_029-v1.ckpt[0m
[[36m2024-10-04 00:50:16,170[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/1[0m
[[36m2024-10-04 00:50:16,171[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 00:50:16,174[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 00:50:16,411[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 00:50:16,413[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-04 00:50:16,479[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 00:50:16,495[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 00:50:16,509[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 00:50:16,509[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 00:50:16,512[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 00:50:16,513[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 00:50:16,514[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 00:50:16,514[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 00:50:16,515[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 00:50:16,516[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 00:50:16,530[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 00:50:16,537[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for fe987e753cc34dbab41d371a[0m
[[36m2024-10-04 00:50:16,538[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 00:50:16,539[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa8373145e0>[0m
[[36m2024-10-04 00:50:16,580[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=30` or `min_steps=None` has not been met. Training will continue...
Epoch 29/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:07 •       23.64it/s v_num: 77f3      
                                     0:00:00                   val/ei_step:     
                                                               2.861            
                                                               val/ei_term1_ste…
                                                               4.254            
                                                               val/ei_term2_ste…
                                                               1.469 val/MAE:   
                                                               0.015            
                                                               val/ei_epoch:    
                                                               2.667            
                                                               val/ei_term1_epo…
                                                               3.863            
                                                               val/ei_term2_epo…
                                                               1.472 val/loss:  
                                                               0.017 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-04 01:11:23,900[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 01:11:23,903[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8ad8f620110d464ca61277f3'. Data corruption may occur if there is active process writing to Run '8ad8f620110d464ca61277f3'.[0m
[[36m2024-10-04 01:11:23,918[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8ad8f620110d464ca61277f3[0m
[[36m2024-10-04 01:11:23,919[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 01:11:23,919[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f52f014d990>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints/epoch_029.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints/epoch_029.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.015039872378110886    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -58.740840911865234    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.016331717371940613    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.14it/s 
[[36m2024-10-04 01:11:25,929[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints/epoch_029.ckpt[0m
[[36m2024-10-04 01:11:25,931[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3[0m
[[36m2024-10-04 01:11:25,932[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 01:11:25,933[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 01:11:26,173[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 01:11:26,175[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-04 01:11:26,238[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 01:11:26,254[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 01:11:26,267[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 01:11:26,267[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 01:11:26,270[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 01:11:26,271[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 01:11:26,272[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 01:11:26,272[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 01:11:26,273[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 01:11:26,275[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 01:11:26,286[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 01:11:26,294[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2b1049b57c5545cab4b4887d[0m
[[36m2024-10-04 01:11:26,295[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 01:11:26,295[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f537631b5b0>[0m
[[36m2024-10-04 01:11:26,338[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
`Trainer.fit` stopped: `max_epochs=31` reached.
Epoch 30/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.38it/s v_num: 371a      
                                     0:00:00                   val/ei_step:     
                                                               2.614            
                                                               val/ei_term1_ste…
                                                               3.831            
                                                               val/ei_term2_ste…
                                                               1.397 val/MAE:   
                                                               0.016            
                                                               val/ei_epoch:    
                                                               2.556            
                                                               val/ei_term1_epo…
                                                               3.717            
                                                               val/ei_term2_epo…
                                                               1.396 val/loss:  
                                                               0.018 train/MAE: 
                                                               0.014 train/loss:
                                                               0.015            
[[36m2024-10-04 01:35:06,965[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 01:35:06,968[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'fe987e753cc34dbab41d371a'. Data corruption may occur if there is active process writing to Run 'fe987e753cc34dbab41d371a'.[0m
[[36m2024-10-04 01:35:06,982[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for fe987e753cc34dbab41d371a[0m
[[36m2024-10-04 01:35:06,984[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 01:35:06,984[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa806704190>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints/epoch_023.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints/epoch_023.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014350654557347298    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -59.76786804199219     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01567581109702587    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.43it/s 
[[36m2024-10-04 01:35:08,887[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2/checkpoints/epoch_023.ckpt[0m
[[36m2024-10-04 01:35:08,892[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/2[0m
[[36m2024-10-04 01:35:08,894[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 01:35:08,899[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 01:35:09,139[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 01:35:09,141[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-04 01:35:09,206[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 01:35:09,222[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 01:35:09,236[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 01:35:09,237[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 01:35:09,239[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 01:35:09,240[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 01:35:09,241[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 01:35:09,242[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 01:35:09,242[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 01:35:09,244[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 01:35:09,256[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 01:35:09,264[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8a2f4489b509425f9d3f9094[0m
[[36m2024-10-04 01:35:09,265[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 01:35:09,266[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa803358b50>[0m
[[36m2024-10-04 01:35:09,310[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
`Trainer.fit` stopped: `max_epochs=31` reached.
Epoch 30/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:08 •       22.46it/s v_num: 887d      
                                     0:00:00                   val/ei_step:     
                                                               2.712            
                                                               val/ei_term1_ste…
                                                               4.049            
                                                               val/ei_term2_ste…
                                                               1.375 val/MAE:   
                                                               0.016            
                                                               val/ei_epoch:    
                                                               2.654            
                                                               val/ei_term1_epo…
                                                               3.933            
                                                               val/ei_term2_epo…
                                                               1.376 val/loss:  
                                                               0.017 train/MAE: 
                                                               0.014 train/loss:
                                                               0.015            
[[36m2024-10-04 01:39:20,751[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 01:39:20,754[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '2b1049b57c5545cab4b4887d'. Data corruption may occur if there is active process writing to Run '2b1049b57c5545cab4b4887d'.[0m
[[36m2024-10-04 01:39:20,768[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2b1049b57c5545cab4b4887d[0m
[[36m2024-10-04 01:39:20,770[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 01:39:20,770[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f537631b640>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints/epoch_028.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints/epoch_028.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014175865799188614    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -62.53896713256836     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.015486331656575203    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.01it/s 
[[36m2024-10-04 01:39:22,561[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints/epoch_028.ckpt[0m
[[36m2024-10-04 01:39:22,566[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4[0m
[[36m2024-10-04 01:39:22,567[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
`Trainer.fit` stopped: `max_epochs=31` reached.
Epoch 30/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.76it/s v_num: 9094      
                                     0:00:00                   val/ei_step:     
                                                               2.829            
                                                               val/ei_term1_ste…
                                                               4.289            
                                                               val/ei_term2_ste…
                                                               1.369 val/MAE:   
                                                               0.016            
                                                               val/ei_epoch:    
                                                               2.657            
                                                               val/ei_term1_epo…
                                                               3.946            
                                                               val/ei_term2_epo…
                                                               1.369 val/loss:  
                                                               0.017 train/MAE: 
                                                               0.014 train/loss:
                                                               0.015            
[[36m2024-10-04 02:19:37,449[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 02:19:37,453[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8a2f4489b509425f9d3f9094'. Data corruption may occur if there is active process writing to Run '8a2f4489b509425f9d3f9094'.[0m
[[36m2024-10-04 02:19:37,468[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8a2f4489b509425f9d3f9094[0m
[[36m2024-10-04 02:19:37,470[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 02:19:37,470[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa803388d00>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints/epoch_030.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints/epoch_030.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.015740402042865753    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -59.97935104370117     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.017009325325489044    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.10it/s 
[[36m2024-10-04 02:19:39,165[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3/checkpoints/epoch_030.ckpt[0m
[[36m2024-10-04 02:19:39,170[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/3[0m
[[36m2024-10-04 02:19:39,171[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 02:19:39,175[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 02:19:39,398[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 02:19:39,400[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 30                                                          
│       max_epochs: 31                                                          
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-04 02:19:39,636[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 02:19:39,651[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 02:19:39,664[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 02:19:39,664[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 02:19:39,667[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 02:19:39,668[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 02:19:39,669[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 02:19:39,669[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 02:19:39,669[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 02:19:39,671[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 02:19:39,683[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 02:19:39,691[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c212445838444311b49a3aff[0m
[[36m2024-10-04 02:19:39,692[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 02:19:39,692[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa7fa3f48b0>[0m
[[36m2024-10-04 02:19:39,736[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
`Trainer.fit` stopped: `max_epochs=31` reached.
Epoch 30/30 ━━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.11it/s v_num: 3aff      
                                     0:00:00                   val/ei_step:     
                                                               2.951            
                                                               val/ei_term1_ste…
                                                               4.501            
                                                               val/ei_term2_ste…
                                                               1.401 val/MAE:   
                                                               0.016            
                                                               val/ei_epoch:    
                                                               2.882            
                                                               val/ei_term1_epo…
                                                               4.364            
                                                               val/ei_term2_epo…
                                                               1.400 val/loss:  
                                                               0.017 train/MAE: 
                                                               0.014 train/loss:
                                                               0.014            
[[36m2024-10-04 03:04:00,787[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 03:04:00,789[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c212445838444311b49a3aff'. Data corruption may occur if there is active process writing to Run 'c212445838444311b49a3aff'.[0m
[[36m2024-10-04 03:04:00,800[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c212445838444311b49a3aff[0m
[[36m2024-10-04 03:04:00,802[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 03:04:00,802[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fa83736b940>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints/epoch_026.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints/epoch_026.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014878981746733189    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -68.9941635131836     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01553241815418005    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.09it/s 
[[36m2024-10-04 03:04:02,488[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4/checkpoints/epoch_026.ckpt[0m
[[36m2024-10-04 03:04:02,492[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-03_23-23-46/4[0m
[[36m2024-10-04 03:04:02,493[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 20:19:35,197[0m][[35mHYDRA[0m] Launching 3 jobs locally[0m
[[36m2024-10-04 20:19:35,197[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 20:19:35,201[0m][[35mHYDRA[0m] Launching 3 jobs locally[0m
[[36m2024-10-04 20:19:35,201[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 20:19:35,410[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 20:19:35,414[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-04 20:19:35,414[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 20:19:35,419[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-04 20:19:35,485[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-04 20:19:35,490[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 20:19:36,667[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 20:19:36,668[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 20:19:36,783[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 20:19:36,783[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 20:19:36,787[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 20:19:36,788[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 20:19:36,789[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 20:19:36,789[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 20:19:36,790[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 20:19:36,813[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 20:19:36,814[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 20:19:36,819[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 20:19:36,821[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 20:19:36,822[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 20:19:36,822[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 20:19:36,823[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 20:19:37,688[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-04 20:19:37,714[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 20:19:37,773[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[[36m2024-10-04 20:19:37,796[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0bbb580aa97a48768d403699[0m
[[36m2024-10-04 20:19:37,797[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 20:19:37,797[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe84b03d9f0>[0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 20:19:37,805[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 20:19:37,827[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a778903f0e684c7ea4c596e3[0m
[[36m2024-10-04 20:19:37,828[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 20:19:37,828[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7ff2a5f2d6c0>[0m
[[36m2024-10-04 20:19:37,870[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-04 20:19:37,896[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.28it/s v_num: 96e3      
                                     0:00:00                   val/ei_step:     
                                                               3.452            
                                                               val/ei_term1_ste…
                                                               5.516            
                                                               val/ei_term2_ste…
                                                               1.388 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.407            
                                                               val/ei_term1_epo…
                                                               5.426            
                                                               val/ei_term2_epo…
                                                               1.387 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-04 21:48:48,284[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 21:48:48,289[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a778903f0e684c7ea4c596e3'. Data corruption may occur if there is active process writing to Run 'a778903f0e684c7ea4c596e3'.[0m
[[36m2024-10-04 21:48:48,298[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a778903f0e684c7ea4c596e3[0m
[[36m2024-10-04 21:48:48,299[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 21:48:48,299[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7ff2a5f2cf70>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0/checkpoints/epoch_096.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0/checkpoints/epoch_096.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.011460832320153713    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -82.33079528808594     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011713698506355286    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.73it/s 
[[36m2024-10-04 21:48:49,983[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0/checkpoints/epoch_096.ckpt[0m
[[36m2024-10-04 21:48:49,988[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0[0m
[[36m2024-10-04 21:48:49,989[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 21:48:49,994[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 21:48:50,227[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 21:48:50,229[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-04 21:48:50,293[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 21:48:50,309[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 21:48:50,323[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 21:48:50,323[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 21:48:50,326[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 21:48:50,327[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 21:48:50,327[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 21:48:50,328[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 21:48:50,328[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 21:48:50,330[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 21:48:50,343[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 21:48:50,351[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d20cd28b9c0043d3bf2a5afc[0m
[[36m2024-10-04 21:48:50,352[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 21:48:50,352[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7ff2b53b7bb0>[0m
[[36m2024-10-04 21:48:50,394[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:05 •       33.66it/s v_num: 3699      
                                     0:00:00                   val/ei_step:     
                                                               3.541            
                                                               val/ei_term1_ste…
                                                               5.700            
                                                               val/ei_term2_ste…
                                                               1.382 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.486            
                                                               val/ei_term1_epo…
                                                               5.593            
                                                               val/ei_term2_epo…
                                                               1.380 val/loss:  
                                                               0.011 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-04 22:42:43,040[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 22:42:43,045[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '0bbb580aa97a48768d403699'. Data corruption may occur if there is active process writing to Run '0bbb580aa97a48768d403699'.[0m
[[36m2024-10-04 22:42:43,059[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0bbb580aa97a48768d403699[0m
[[36m2024-10-04 22:42:43,060[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 22:42:43,060[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe85d6f4820>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0/checkpoints/epoch_094.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0/checkpoints/epoch_094.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010861330665647984    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -85.59636688232422     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011057461611926556    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 13.42it/s 
[[36m2024-10-04 22:42:45,118[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0/checkpoints/epoch_094.ckpt[0m
[[36m2024-10-04 22:42:45,122[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/0[0m
[[36m2024-10-04 22:42:45,123[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 22:42:45,126[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 22:42:45,364[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 22:42:45,366[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-04 22:42:45,431[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 22:42:45,448[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 22:42:45,462[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 22:42:45,462[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 22:42:45,465[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 22:42:45,466[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 22:42:45,466[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 22:42:45,467[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 22:42:45,467[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 22:42:45,469[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 22:42:45,481[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 22:42:45,489[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a87bc416d21e48b1ae5921a3[0m
[[36m2024-10-04 22:42:45,490[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 22:42:45,490[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe85a44fe50>[0m
[[36m2024-10-04 22:42:45,532[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.25it/s v_num: 5afc      
                                     0:00:00                   val/ei_step:     
                                                               3.371            
                                                               val/ei_term1_ste…
                                                               5.334            
                                                               val/ei_term2_ste…
                                                               1.408 val/MAE:   
                                                               0.017            
                                                               val/ei_epoch:    
                                                               3.040            
                                                               val/ei_term1_epo…
                                                               4.672            
                                                               val/ei_term2_epo…
                                                               1.408 val/loss:  
                                                               0.018 train/MAE: 
                                                               0.010 train/loss:
                                                               0.011            
[[36m2024-10-04 23:18:07,021[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-04 23:18:07,024[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'd20cd28b9c0043d3bf2a5afc'. Data corruption may occur if there is active process writing to Run 'd20cd28b9c0043d3bf2a5afc'.[0m
[[36m2024-10-04 23:18:07,036[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d20cd28b9c0043d3bf2a5afc[0m
[[36m2024-10-04 23:18:07,038[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 23:18:07,038[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7ff2b53a7a00>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints/epoch_090.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints/epoch_090.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.017471350729465485    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -71.19099426269531     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01783629320561886    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.64it/s 
[[36m2024-10-04 23:18:08,715[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints/epoch_090.ckpt[0m
[[36m2024-10-04 23:18:08,720[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1[0m
[[36m2024-10-04 23:18:08,721[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-04 23:18:08,725[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-04 23:18:08,957[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-04 23:18:08,959[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-04 23:18:09,024[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-04 23:18:09,040[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-04 23:18:09,052[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-04 23:18:09,053[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-04 23:18:09,055[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-04 23:18:09,057[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-04 23:18:09,057[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-04 23:18:09,058[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-04 23:18:09,058[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-04 23:18:09,060[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-04 23:18:09,073[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-04 23:18:09,082[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b7d8126ef0f7452b83613910[0m
[[36m2024-10-04 23:18:09,083[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-04 23:18:09,083[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7ff2e955cf70>[0m
[[36m2024-10-04 23:18:09,126[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.53it/s v_num: 3910      
                                     0:00:00                   val/ei_step:     
                                                               3.502            
                                                               val/ei_term1_ste…
                                                               5.602            
                                                               val/ei_term2_ste…
                                                               1.402 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.475            
                                                               val/ei_term1_epo…
                                                               5.546            
                                                               val/ei_term2_epo…
                                                               1.403 val/loss:  
                                                               0.011 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-05 00:47:47,146[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-05 00:47:47,149[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'b7d8126ef0f7452b83613910'. Data corruption may occur if there is active process writing to Run 'b7d8126ef0f7452b83613910'.[0m
[[36m2024-10-05 00:47:47,162[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b7d8126ef0f7452b83613910[0m
[[36m2024-10-05 00:47:47,163[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 00:47:47,164[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7ff2e955ee00>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.011006597429513931    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -84.07579803466797     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011243673041462898    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.66it/s 
[[36m2024-10-05 00:47:48,832[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-05 00:47:48,836[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2[0m
[[36m2024-10-05 00:47:48,838[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.86it/s v_num: 21a3      
                                     0:00:00                   val/ei_step:     
                                                               3.387            
                                                               val/ei_term1_ste…
                                                               5.404            
                                                               val/ei_term2_ste…
                                                               1.371 val/MAE:   
                                                               0.018            
                                                               val/ei_epoch:    
                                                               3.071            
                                                               val/ei_term1_epo…
                                                               4.771            
                                                               val/ei_term2_epo…
                                                               1.372 val/loss:  
                                                               0.019 train/MAE: 
                                                               0.010 train/loss:
                                                               0.011            
[[36m2024-10-05 01:06:12,221[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-05 01:06:12,224[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a87bc416d21e48b1ae5921a3'. Data corruption may occur if there is active process writing to Run 'a87bc416d21e48b1ae5921a3'.[0m
[[36m2024-10-05 01:06:12,238[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a87bc416d21e48b1ae5921a3[0m
[[36m2024-10-05 01:06:12,240[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 01:06:12,240[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe85b3d1db0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints/epoch_076.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints/epoch_076.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.018441950902342796    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -72.718505859375      │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.0186889860779047     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.21it/s 
[[36m2024-10-05 01:06:13,922[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1/checkpoints/epoch_076.ckpt[0m
[[36m2024-10-05 01:06:13,927[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/1[0m
[[36m2024-10-05 01:06:13,928[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-05 01:06:13,933[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-05 01:06:14,164[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-05 01:06:14,165[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-05 01:06:14,226[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-05 01:06:14,241[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-05 01:06:14,254[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-05 01:06:14,255[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-05 01:06:14,257[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-05 01:06:14,258[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-05 01:06:14,259[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-05 01:06:14,259[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-05 01:06:14,260[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-05 01:06:14,262[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-05 01:06:14,273[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-05 01:06:14,281[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ea64605df33a48ed8e4f97ac[0m
[[36m2024-10-05 01:06:14,282[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 01:06:14,283[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe85a509510>[0m
[[36m2024-10-05 01:06:14,322[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       21.03it/s v_num: 97ac      
                                     0:00:00                   val/ei_step:     
                                                               3.523            
                                                               val/ei_term1_ste…
                                                               5.641            
                                                               val/ei_term2_ste…
                                                               1.405 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.424            
                                                               val/ei_term1_epo…
                                                               5.441            
                                                               val/ei_term2_epo…
                                                               1.406 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-05 03:28:39,086[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-05 03:28:39,089[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ea64605df33a48ed8e4f97ac'. Data corruption may occur if there is active process writing to Run 'ea64605df33a48ed8e4f97ac'.[0m
[[36m2024-10-05 03:28:39,103[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ea64605df33a48ed8e4f97ac[0m
[[36m2024-10-05 03:28:39,104[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 03:28:39,105[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe85a4c9360>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints/epoch_097.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints/epoch_097.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01152617484331131    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -82.56090545654297     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011776149272918701    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.26it/s 
[[36m2024-10-05 03:28:40,796[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2/checkpoints/epoch_097.ckpt[0m
[[36m2024-10-05 03:28:40,800[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-04_20-19-34/2[0m
[[36m2024-10-05 03:28:40,802[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-05 22:24:18,440[0m][[35mHYDRA[0m] Launching 2 jobs locally[0m
[[36m2024-10-05 22:24:18,440[0m][[35mHYDRA[0m] 	#0 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-05 22:24:18,442[0m][[35mHYDRA[0m] Launching 2 jobs locally[0m
[[36m2024-10-05 22:24:18,442[0m][[35mHYDRA[0m] 	#0 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-05 22:24:18,653[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-05 22:24:18,654[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-05 22:24:18,658[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-05 22:24:18,659[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
Seed set to 2053
[[36m2024-10-05 22:24:18,729[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-05 22:24:18,729[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-05 22:24:19,863[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-05 22:24:19,867[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-05 22:24:19,977[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-05 22:24:19,977[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-05 22:24:19,980[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-05 22:24:19,981[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-05 22:24:19,982[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-05 22:24:19,983[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-05 22:24:19,983[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-05 22:24:20,001[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-05 22:24:20,001[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-05 22:24:20,005[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-05 22:24:20,007[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-05 22:24:20,007[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-05 22:24:20,008[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-05 22:24:20,009[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-05 22:24:20,884[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-05 22:24:20,904[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[[36m2024-10-05 22:24:20,974[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-05 22:24:20,989[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-05 22:24:21,003[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 20c17a5ce6644bbbab260a2c[0m
[[36m2024-10-05 22:24:21,004[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 22:24:21,004[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd6eb169e10>[0m
[[36m2024-10-05 22:24:21,012[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c94550d211fc4bdf8016dfed[0m
[[36m2024-10-05 22:24:21,013[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 22:24:21,013[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f73d7935bd0>[0m
[[36m2024-10-05 22:24:21,087[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-05 22:24:21,158[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.51it/s v_num: dfed      
                                     0:00:00                   val/ei_step:     
                                                               3.261            
                                                               val/ei_term1_ste…
                                                               5.064            
                                                               val/ei_term2_ste…
                                                               1.457 val/MAE:   
                                                               0.012            
                                                               val/ei_epoch:    
                                                               3.188            
                                                               val/ei_term1_epo…
                                                               4.918            
                                                               val/ei_term2_epo…
                                                               1.458 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-05 23:53:14,132[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-05 23:53:14,137[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c94550d211fc4bdf8016dfed'. Data corruption may occur if there is active process writing to Run 'c94550d211fc4bdf8016dfed'.[0m
[[36m2024-10-05 23:53:14,148[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c94550d211fc4bdf8016dfed[0m
[[36m2024-10-05 23:53:14,149[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 23:53:14,150[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f73e9fd2f50>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.011462966911494732    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -74.60863494873047     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011895643547177315    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.69it/s 
[[36m2024-10-05 23:53:15,825[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-05 23:53:15,830[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0[0m
[[36m2024-10-05 23:53:15,831[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-05 23:53:15,835[0m][[35mHYDRA[0m] 	#1 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-05 23:53:16,065[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-05 23:53:16,067[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-05 23:53:16,131[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-05 23:53:16,146[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-05 23:53:16,160[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-05 23:53:16,161[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-05 23:53:16,163[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-05 23:53:16,164[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-05 23:53:16,165[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-05 23:53:16,166[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-05 23:53:16,166[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-05 23:53:16,168[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-05 23:53:16,180[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-05 23:53:16,189[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ff2e63eb809a4bc880bdd310[0m
[[36m2024-10-05 23:53:16,190[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-05 23:53:16,190[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f73a0145360>[0m
[[36m2024-10-05 23:53:16,234[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       19.40it/s v_num: 0a2c      
                                     0:00:00                   val/ei_step:     
                                                               3.396            
                                                               val/ei_term1_ste…
                                                               5.426            
                                                               val/ei_term2_ste…
                                                               1.366 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.367            
                                                               val/ei_term1_epo…
                                                               5.369            
                                                               val/ei_term2_epo…
                                                               1.365 val/loss:  
                                                               0.011 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-06 00:47:31,832[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-06 00:47:31,837[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '20c17a5ce6644bbbab260a2c'. Data corruption may occur if there is active process writing to Run '20c17a5ce6644bbbab260a2c'.[0m
[[36m2024-10-06 00:47:31,850[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 20c17a5ce6644bbbab260a2c[0m
[[36m2024-10-06 00:47:31,851[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-06 00:47:31,851[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd6eb169ea0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0/checkpoints/epoch_099-v1.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0/checkpoints/epoch_099-v1.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010686926543712616    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -81.39533996582031     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.010950555093586445    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.74it/s 
[[36m2024-10-06 00:47:33,633[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0/checkpoints/epoch_099-v1.ckpt[0m
[[36m2024-10-06 00:47:33,638[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/0[0m
[[36m2024-10-06 00:47:33,639[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-06 00:47:33,643[0m][[35mHYDRA[0m] 	#1 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-06 00:47:33,879[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-06 00:47:33,881[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 7000                                                                
│         - 5000                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-06 00:47:33,946[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-06 00:47:33,962[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-06 00:47:33,978[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-06 00:47:33,978[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-06 00:47:33,981[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-06 00:47:33,982[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-06 00:47:33,982[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-06 00:47:33,983[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-06 00:47:33,983[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-06 00:47:33,985[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-06 00:47:33,998[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-06 00:47:34,006[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 1905d66651e443dcb2559cf7[0m
[[36m2024-10-06 00:47:34,007[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-06 00:47:34,007[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd6fa3139d0>[0m
[[36m2024-10-06 00:47:34,049[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
`Trainer.fit` stopped: `max_epochs=101` reached.
Epoch 100/100 ━━━━━━━━━━━━━━━ 188/188 0:00:08 •       23.40it/s v_num: d310     
                                      0:00:00                   val/ei_step:    
                                                                3.506           
                                                                val/ei_term1_st…
                                                                5.629           
                                                                val/ei_term2_st…
                                                                1.384 val/MAE:  
                                                                0.011           
                                                                val/ei_epoch:   
                                                                3.498           
                                                                val/ei_term1_ep…
                                                                5.612           
                                                                val/ei_term2_ep…
                                                                1.384 val/loss: 
                                                                0.012 train/MAE:
                                                                0.010           
                                                                train/loss:     
                                                                0.010           
[[36m2024-10-06 01:23:25,381[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-06 01:23:25,384[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ff2e63eb809a4bc880bdd310'. Data corruption may occur if there is active process writing to Run 'ff2e63eb809a4bc880bdd310'.[0m
[[36m2024-10-06 01:23:25,393[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ff2e63eb809a4bc880bdd310[0m
[[36m2024-10-06 01:23:25,394[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-06 01:23:25,395[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f73a01c1180>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints/epoch_091.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints/epoch_091.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010692566633224487    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -85.49191284179688     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.010937501676380634    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.74it/s 
[[36m2024-10-06 01:23:27,062[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints/epoch_091.ckpt[0m
[[36m2024-10-06 01:23:27,066[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1[0m
[[36m2024-10-06 01:23:27,067[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━ 188/188 0:00:09 •       20.82it/s v_num: 9cf7      
                                     0:00:00                   val/ei_step:     
                                                               3.507            
                                                               val/ei_term1_ste…
                                                               5.625            
                                                               val/ei_term2_ste…
                                                               1.389 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.548            
                                                               val/ei_term1_epo…
                                                               5.706            
                                                               val/ei_term2_epo…
                                                               1.390 val/loss:  
                                                               0.011 train/MAE: 
                                                               0.010 train/loss:
                                                               0.010            
[[36m2024-10-06 03:10:28,240[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-06 03:10:28,243[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '1905d66651e443dcb2559cf7'. Data corruption may occur if there is active process writing to Run '1905d66651e443dcb2559cf7'.[0m
[[36m2024-10-06 03:10:28,256[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 1905d66651e443dcb2559cf7[0m
[[36m2024-10-06 03:10:28,257[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-06 03:10:28,257[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fd6fa33f100>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.010985951870679855    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -86.42179870605469     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011169244535267353    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.40it/s 
[[36m2024-10-06 03:10:29,946[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-06 03:10:29,951[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-05_22-24-18/1[0m
[[36m2024-10-06 03:10:29,952[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-07 23:25:05,980[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-07 23:25:05,981[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-07 23:25:05,984[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-07 23:25:05,984[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-07 23:25:06,195[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-07 23:25:06,199[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-07 23:25:06,200[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-07 23:25:06,203[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-07 23:25:06,271[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-07 23:25:06,274[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-07 23:25:07,449[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-07 23:25:07,464[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-07 23:25:07,581[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-07 23:25:07,581[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-07 23:25:07,584[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-07 23:25:07,586[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-07 23:25:07,586[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-07 23:25:07,587[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-07 23:25:07,587[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-07 23:25:07,589[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-07 23:25:07,589[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-07 23:25:07,593[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-07 23:25:07,595[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-07 23:25:07,596[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-07 23:25:07,596[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-07 23:25:07,597[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-07 23:25:08,478[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
[[36m2024-10-07 23:25:08,478[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
GPU available: True (cuda), used: True
[[36m2024-10-07 23:25:08,567[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-07 23:25:08,568[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-07 23:25:08,596[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e4ff9c4efb8448308cb78009[0m
[[36m2024-10-07 23:25:08,597[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-07 23:25:08,598[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9011d8a0>[0m
[[36m2024-10-07 23:25:08,601[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8c1f4e152fb043b5a775c109[0m
[[36m2024-10-07 23:25:08,604[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-07 23:25:08,604[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48ae2bdb40>[0m
[[36m2024-10-07 23:25:08,672[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-10-07 23:25:08,687[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        21.18it/s v_num: 8009      
                                    0:00:00                    val/ei_step:     
                                                               3.247            
                                                               val/ei_term1_ste…
                                                               5.101            
                                                               val/ei_term2_ste…
                                                               1.393 val/MAE:   
                                                               0.012            
                                                               val/ei_epoch:    
                                                               3.238            
                                                               val/ei_term1_epo…
                                                               5.083            
                                                               val/ei_term2_epo…
                                                               1.393 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 00:32:29,915[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 00:32:29,918[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'e4ff9c4efb8448308cb78009'. Data corruption may occur if there is active process writing to Run 'e4ff9c4efb8448308cb78009'.[0m
[[36m2024-10-08 00:32:29,927[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e4ff9c4efb8448308cb78009[0m
[[36m2024-10-08 00:32:29,929[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 00:32:29,929[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1fa252e500>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01152725052088499    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -77.03726196289062     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011891549453139305    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.68it/s 
[[36m2024-10-08 00:32:31,729[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-08 00:32:31,733[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0[0m
[[36m2024-10-08 00:32:31,734[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 00:32:31,738[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 00:32:31,970[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 00:32:31,972[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-08 00:32:32,036[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 00:32:32,052[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 00:32:32,066[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 00:32:32,067[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 00:32:32,069[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 00:32:32,071[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 00:32:32,071[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 00:32:32,072[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 00:32:32,072[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 00:32:32,074[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 00:32:32,086[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 00:32:32,095[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0f97a975c18d4dd59d7774d8[0m
[[36m2024-10-08 00:32:32,096[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 00:32:32,096[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9b85ed10>[0m
[[36m2024-10-08 00:32:32,143[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        19.29it/s v_num: c109      
                                    0:00:00                    val/ei_step:     
                                                               3.341            
                                                               val/ei_term1_ste…
                                                               5.296            
                                                               val/ei_term2_ste…
                                                               1.386 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               3.171            
                                                               val/ei_term1_epo…
                                                               4.955            
                                                               val/ei_term2_epo…
                                                               1.387 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 01:24:04,924[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 01:24:04,929[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '8c1f4e152fb043b5a775c109'. Data corruption may occur if there is active process writing to Run '8c1f4e152fb043b5a775c109'.[0m
[[36m2024-10-08 01:24:04,942[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 8c1f4e152fb043b5a775c109[0m
[[36m2024-10-08 01:24:04,943[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 01:24:04,944[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48c08ef490>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0/checkpoints/epoch_097.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0/checkpoints/epoch_097.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013124844059348106    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -75.31430053710938     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013497704640030861    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.70it/s 
[[36m2024-10-08 01:24:06,739[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0/checkpoints/epoch_097.ckpt[0m
[[36m2024-10-08 01:24:06,743[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/0[0m
[[36m2024-10-08 01:24:06,745[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 01:24:06,749[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 01:24:06,986[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 01:24:06,988[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-08 01:24:07,054[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 01:24:07,070[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 01:24:07,085[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 01:24:07,085[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 01:24:07,087[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 01:24:07,089[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 01:24:07,089[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 01:24:07,090[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 01:24:07,090[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 01:24:07,092[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 01:24:07,105[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 01:24:07,113[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 7a58f63451c4419b8dcbb289[0m
[[36m2024-10-08 01:24:07,114[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 01:24:07,115[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f487012bf70>[0m
[[36m2024-10-08 01:24:07,159[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        23.43it/s v_num: 74d8      
                                    0:00:00                    val/ei_step:     
                                                               3.208            
                                                               val/ei_term1_ste…
                                                               4.984            
                                                               val/ei_term2_ste…
                                                               1.432 val/MAE:   
                                                               0.014            
                                                               val/ei_epoch:    
                                                               2.996            
                                                               val/ei_term1_epo…
                                                               4.560            
                                                               val/ei_term2_epo…
                                                               1.431 val/loss:  
                                                               0.015 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 01:39:44,832[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 01:39:44,835[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '0f97a975c18d4dd59d7774d8'. Data corruption may occur if there is active process writing to Run '0f97a975c18d4dd59d7774d8'.[0m
[[36m2024-10-08 01:39:44,852[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 0f97a975c18d4dd59d7774d8[0m
[[36m2024-10-08 01:39:44,854[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 01:39:44,855[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9f375060>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints/epoch_098.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints/epoch_098.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014270094223320484    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -69.39032745361328     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01485211681574583    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.88it/s 
[[36m2024-10-08 01:39:46,539[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints/epoch_098.ckpt[0m
[[36m2024-10-08 01:39:46,544[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1[0m
[[36m2024-10-08 01:39:46,546[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 01:39:46,550[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 01:39:46,793[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 01:39:46,795[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-08 01:39:46,860[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 01:39:46,876[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 01:39:46,889[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 01:39:46,889[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 01:39:46,892[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 01:39:46,893[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 01:39:46,894[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 01:39:46,895[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 01:39:46,895[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 01:39:46,898[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 01:39:46,910[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 01:39:46,919[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 28b871c4b3fe47b38bb39535[0m
[[36m2024-10-08 01:39:46,920[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 01:39:46,920[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9f22fe50>[0m
[[36m2024-10-08 01:39:46,960[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        23.61it/s v_num: 9535      
                                    0:00:00                    val/ei_step:     
                                                               3.355            
                                                               val/ei_term1_ste…
                                                               5.305            
                                                               val/ei_term2_ste…
                                                               1.404 val/MAE:   
                                                               0.012            
                                                               val/ei_epoch:    
                                                               3.272            
                                                               val/ei_term1_epo…
                                                               5.138            
                                                               val/ei_term2_epo…
                                                               1.406 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 02:47:15,701[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 02:47:15,705[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '28b871c4b3fe47b38bb39535'. Data corruption may occur if there is active process writing to Run '28b871c4b3fe47b38bb39535'.[0m
[[36m2024-10-08 02:47:15,717[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 28b871c4b3fe47b38bb39535[0m
[[36m2024-10-08 02:47:15,718[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 02:47:15,719[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9f2454b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012246689759194851    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -77.95425415039062     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.012593463994562626    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.71it/s 
[[36m2024-10-08 02:47:17,404[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-08 02:47:17,408[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2[0m
[[36m2024-10-08 02:47:17,410[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 02:47:17,413[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 02:47:17,645[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 02:47:17,647[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-08 02:47:17,712[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 02:47:17,728[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 02:47:17,740[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 02:47:17,741[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 02:47:17,744[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 02:47:17,745[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 02:47:17,746[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 02:47:17,746[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 02:47:17,746[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 02:47:17,748[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 02:47:17,761[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 02:47:17,769[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ce40a61c033d4dc5b768338d[0m
[[36m2024-10-08 02:47:17,770[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 02:47:17,770[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9f22cb50>[0m
[[36m2024-10-08 02:47:17,813[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        20.44it/s v_num: b289      
                                    0:00:00                    val/ei_step:     
                                                               3.323            
                                                               val/ei_term1_ste…
                                                               5.283            
                                                               val/ei_term2_ste…
                                                               1.363 val/MAE:   
                                                               0.017            
                                                               val/ei_epoch:    
                                                               2.983            
                                                               val/ei_term1_epo…
                                                               4.602            
                                                               val/ei_term2_epo…
                                                               1.364 val/loss:  
                                                               0.018 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 03:23:29,290[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 03:23:29,293[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '7a58f63451c4419b8dcbb289'. Data corruption may occur if there is active process writing to Run '7a58f63451c4419b8dcbb289'.[0m
[[36m2024-10-08 03:23:29,305[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 7a58f63451c4419b8dcbb289[0m
[[36m2024-10-08 03:23:29,307[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 03:23:29,307[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48bd6c4d30>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.017177777364850044    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -70.092529296875      │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.017609968781471252    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.72it/s 
[[36m2024-10-08 03:23:31,210[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-08 03:23:31,215[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/1[0m
[[36m2024-10-08 03:23:31,216[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 03:23:31,220[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 03:23:31,458[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 03:23:31,460[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-08 03:23:31,525[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 03:23:31,542[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 03:23:31,556[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 03:23:31,556[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 03:23:31,558[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 03:23:31,560[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 03:23:31,560[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 03:23:31,561[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 03:23:31,561[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 03:23:31,563[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 03:23:31,575[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 03:23:31,584[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 03e64b5aac204ee7a9fa866c[0m
[[36m2024-10-08 03:23:31,585[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 03:23:31,585[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48f17782e0>[0m
[[36m2024-10-08 03:23:31,629[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        23.40it/s v_num: 338d      
                                    0:00:00                    val/ei_step:     
                                                               3.160            
                                                               val/ei_term1_ste…
                                                               4.863            
                                                               val/ei_term2_ste…
                                                               1.458 val/MAE:   
                                                               0.015            
                                                               val/ei_epoch:    
                                                               2.912            
                                                               val/ei_term1_epo…
                                                               4.365            
                                                               val/ei_term2_epo…
                                                               1.460 val/loss:  
                                                               0.015 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 03:54:21,637[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 03:54:21,640[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ce40a61c033d4dc5b768338d'. Data corruption may occur if there is active process writing to Run 'ce40a61c033d4dc5b768338d'.[0m
[[36m2024-10-08 03:54:21,653[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ce40a61c033d4dc5b768338d[0m
[[36m2024-10-08 03:54:21,655[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 03:54:21,655[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9b855a80>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints/epoch_096.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints/epoch_096.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.014022232964634895    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -66.94453430175781     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.014713005162775517    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.11it/s 
[[36m2024-10-08 03:54:23,676[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints/epoch_096.ckpt[0m
[[36m2024-10-08 03:54:23,680[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3[0m
[[36m2024-10-08 03:54:23,681[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 03:54:23,684[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 03:54:23,916[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 03:54:23,918[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-08 03:54:23,981[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 03:54:23,996[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 03:54:24,009[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 03:54:24,010[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 03:54:24,012[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 03:54:24,013[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 03:54:24,014[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 03:54:24,014[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 03:54:24,015[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 03:54:24,016[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 03:54:24,028[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 03:54:24,036[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b2bb92c9e6044c09bcf4908d[0m
[[36m2024-10-08 03:54:24,037[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 03:54:24,037[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1f9f1e9ed0>[0m
[[36m2024-10-08 03:54:24,081[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        22.50it/s v_num: 908d      
                                    0:00:00                    val/ei_step:     
                                                               3.391            
                                                               val/ei_term1_ste…
                                                               5.402            
                                                               val/ei_term2_ste…
                                                               1.380 val/MAE:   
                                                               0.011            
                                                               val/ei_epoch:    
                                                               3.366            
                                                               val/ei_term1_epo…
                                                               5.352            
                                                               val/ei_term2_epo…
                                                               1.381 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 05:01:51,049[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 05:01:51,052[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'b2bb92c9e6044c09bcf4908d'. Data corruption may occur if there is active process writing to Run 'b2bb92c9e6044c09bcf4908d'.[0m
[[36m2024-10-08 05:01:51,066[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b2bb92c9e6044c09bcf4908d[0m
[[36m2024-10-08 05:01:51,068[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 05:01:51,068[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f1fd3319630>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.011338718235492706    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -81.12464904785156     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01161336712539196    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.68it/s 
[[36m2024-10-08 05:01:52,744[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-08 05:01:52,748[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4[0m
[[36m2024-10-08 05:01:52,749[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        20.34it/s v_num: 866c      
                                    0:00:00                    val/ei_step:     
                                                               3.285            
                                                               val/ei_term1_ste…
                                                               5.175            
                                                               val/ei_term2_ste…
                                                               1.395 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               3.183            
                                                               val/ei_term1_epo…
                                                               4.971            
                                                               val/ei_term2_epo…
                                                               1.395 val/loss:  
                                                               0.013 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 05:22:32,686[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 05:22:32,689[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '03e64b5aac204ee7a9fa866c'. Data corruption may occur if there is active process writing to Run '03e64b5aac204ee7a9fa866c'.[0m
[[36m2024-10-08 05:22:32,702[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 03e64b5aac204ee7a9fa866c[0m
[[36m2024-10-08 05:22:32,703[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 05:22:32,703[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48f174a290>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints/epoch_097.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints/epoch_097.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012808925472199917    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -75.5461196899414     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.0132292490452528     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.39it/s 
[[36m2024-10-08 05:22:34,397[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2/checkpoints/epoch_097.ckpt[0m
[[36m2024-10-08 05:22:34,401[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/2[0m
[[36m2024-10-08 05:22:34,403[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 05:22:34,407[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 05:22:34,630[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 05:22:34,632[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-08 05:22:34,691[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 05:22:34,706[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 05:22:34,719[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 05:22:34,719[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 05:22:34,722[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 05:22:34,723[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 05:22:34,723[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 05:22:34,724[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 05:22:34,724[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 05:22:34,726[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 05:22:34,737[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 05:22:34,745[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 5f89f5374874488b977191f7[0m
[[36m2024-10-08 05:22:34,746[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 05:22:34,746[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48bd6a5750>[0m
[[36m2024-10-08 05:22:34,790[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        21.18it/s v_num: 91f7      
                                    0:00:00                    val/ei_step:     
                                                               3.303            
                                                               val/ei_term1_ste…
                                                               5.235            
                                                               val/ei_term2_ste…
                                                               1.372 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               3.098            
                                                               val/ei_term1_epo…
                                                               4.826            
                                                               val/ei_term2_epo…
                                                               1.371 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 07:22:26,515[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 07:22:26,519[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '5f89f5374874488b977191f7'. Data corruption may occur if there is active process writing to Run '5f89f5374874488b977191f7'.[0m
[[36m2024-10-08 07:22:26,531[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 5f89f5374874488b977191f7[0m
[[36m2024-10-08 07:22:26,533[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 07:22:26,533[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48bd6a7f10>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013455238193273544    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -73.3514633178711     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.01388623844832182    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.71it/s 
[[36m2024-10-08 07:22:28,469[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-08 07:22:28,472[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/3[0m
[[36m2024-10-08 07:22:28,473[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 07:22:28,476[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 07:22:28,699[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 07:22:28,701[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 10                                                                  
│         - 3500                                                                
│         - 2500                                                                
│         - 10                                                                  
│         - 10                                                                  
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                    
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         3500, 2500, 10, 10]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-08 07:22:28,761[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 07:22:28,776[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 07:22:28,790[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 07:22:28,790[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 07:22:28,792[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 07:22:28,793[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 07:22:28,794[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 07:22:28,794[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 07:22:28,795[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 07:22:28,796[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 07:22:28,807[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 07:22:28,816[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2734b89855644b71bc2006f1[0m
[[36m2024-10-08 07:22:28,817[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 07:22:28,817[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48f177ab90>[0m
[[36m2024-10-08 07:22:28,857[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 95/95 0:00:04 •        21.33it/s v_num: 06f1      
                                    0:00:00                    val/ei_step:     
                                                               3.410            
                                                               val/ei_term1_ste…
                                                               5.425            
                                                               val/ei_term2_ste…
                                                               1.394 val/MAE:   
                                                               0.012            
                                                               val/ei_epoch:    
                                                               3.342            
                                                               val/ei_term1_epo…
                                                               5.290            
                                                               val/ei_term2_epo…
                                                               1.394 val/loss:  
                                                               0.012 train/MAE: 
                                                               0.011 train/loss:
                                                               0.011            
[[36m2024-10-08 09:21:29,742[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-08 09:21:29,745[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '2734b89855644b71bc2006f1'. Data corruption may occur if there is active process writing to Run '2734b89855644b71bc2006f1'.[0m
[[36m2024-10-08 09:21:29,757[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2734b89855644b71bc2006f1[0m
[[36m2024-10-08 09:21:29,758[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 09:21:29,758[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f48f177abf0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints/epoch_098.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints/epoch_098.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01152999047189951    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -82.0987548828125     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.011817610822618008    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.46it/s 
[[36m2024-10-08 09:21:31,451[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4/checkpoints/epoch_098.ckpt[0m
[[36m2024-10-08 09:21:31,456[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-07_23-25-05/4[0m
[[36m2024-10-08 09:21:31,457[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-08 21:32:04,561[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-08 21:32:04,562[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:32:04,573[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-08 21:32:04,574[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:32:04,774[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:32:04,779[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-08 21:32:04,787[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:32:04,791[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-08 21:32:04,849[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-08 21:32:04,862[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-08 21:32:05,995[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 21:32:06,032[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-08 21:32:06,134[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 21:32:06,135[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 21:32:06,139[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 21:32:06,140[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 21:32:06,141[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 21:32:06,142[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 21:32:06,142[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 21:32:06,146[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-08 21:32:06,147[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-08 21:32:06,150[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-08 21:32:06,151[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-08 21:32:06,152[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-08 21:32:06,153[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-08 21:32:06,153[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-08 21:32:07,036[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-08 21:32:07,047[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 21:32:07,116[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-08 21:32:07,129[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-08 21:32:07,139[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 141ef68e859b41ceb8ba7a5e[0m
[[36m2024-10-08 21:32:07,140[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 21:32:07,140[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fab6c0357e0>[0m
[[36m2024-10-08 21:32:07,154[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 247e971d24524fdca1c14e73[0m
[[36m2024-10-08 21:32:07,157[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-08 21:32:07,158[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fc736dada80>[0m
[[36m2024-10-08 21:32:07,212[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-10-08 21:32:07,241[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 24.35it/s v_num: 7a5e      
                                                               val/ei_step:     
                                                               1.204            
                                                               val/ei_term1_ste…
                                                               0.859            
                                                               val/ei_term2_ste…
                                                               1.549 val/MAE:   
                                                               0.224            
                                                               val/ei_epoch:    
                                                               1.271            
                                                               val/ei_term1_epo…
                                                               0.995            
                                                               val/ei_term2_epo…
                                                               1.547 val/loss:  
                                                               0.240 train/MAE: 
                                                               0.312 train/loss:
                                                               0.340            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:28 • 0:00:05 0.64it/s                   
[[36m2024-10-08 21:33:14,579[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:33:14,586[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/0[0m
[[36m2024-10-08 21:33:14,589[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:33:14,815[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:33:14,817[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-08 21:33:14,883[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:33:14,885[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/1[0m
[[36m2024-10-08 21:33:14,886[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:33:15,106[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:33:15,108[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-08 21:33:15,375[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:33:15,376[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/2[0m
[[36m2024-10-08 21:33:15,377[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:33:15,600[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:33:15,602[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-08 21:33:15,667[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:33:15,668[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/3[0m
[[36m2024-10-08 21:33:15,669[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:33:15,891[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:33:15,893[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-08 21:33:15,957[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:33:15,958[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 20.81it/s v_num: 4e73      
                                                               val/ei_step:     
                                                               1.324            
                                                               val/ei_term1_ste…
                                                               1.260            
                                                               val/ei_term2_ste…
                                                               1.388 val/MAE:   
                                                               0.228            
                                                               val/ei_epoch:    
                                                               1.222            
                                                               val/ei_term1_epo…
                                                               1.053            
                                                               val/ei_term2_epo…
                                                               1.391 val/loss:  
                                                               0.249 train/MAE: 
                                                               0.317 train/loss:
                                                               0.343            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:54 • 0:00:10 0.33it/s                   
[[36m2024-10-08 21:34:15,455[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 31, in f
    s = self.s[i](z_) * (1 - self.mask[i])
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/activation.py", line 774, in forward
    return F.leaky_relu(input, self.negative_slope, self.inplace)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/functional.py", line 1648, in leaky_relu
    result = torch._C._nn.leaky_relu(input, negative_slope)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:34:15,462[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/0[0m
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-08 21:34:15,466[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:34:15,681[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:34:15,682[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-08 21:34:15,744[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:34:15,746[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/1[0m
[[36m2024-10-08 21:34:15,747[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:34:15,956[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:34:15,958[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-08 21:34:16,019[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:34:16,020[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/2[0m
[[36m2024-10-08 21:34:16,021[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:34:16,427[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:34:16,429[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-08 21:34:16,489[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:34:16,490[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/3[0m
[[36m2024-10-08 21:34:16,491[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-08 21:34:16,701[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-08 21:34:16,703[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-08 21:34:16,765[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-08 21:34:16,766[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-08_21-32-03/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 31, in f
    s = self.s[i](z_) * (1 - self.mask[i])
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/activation.py", line 774, in forward
    return F.leaky_relu(input, self.negative_slope, self.inplace)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/functional.py", line 1648, in leaky_relu
    result = torch._C._nn.leaky_relu(input, negative_slope)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-09 23:21:55,590[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:21:55,591[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:21:55,594[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:21:55,594[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:21:55,807[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:21:55,809[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:21:55,812[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-09 23:21:55,814[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:21:55,886[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-09 23:21:55,889[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:21:57,027[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:21:57,062[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:21:57,169[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:21:57,170[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:21:57,174[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:21:57,176[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:21:57,176[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:21:57,177[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:21:57,177[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:21:57,179[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:21:57,179[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:21:57,183[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:21:57,184[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:21:57,185[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:21:57,185[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:21:57,185[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:21:58,080[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
[[36m2024-10-09 23:21:58,083[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
GPU available: True (cuda), used: True
[[36m2024-10-09 23:21:58,167[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:21:58,168[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-09 23:21:58,196[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b508d6d6b1174083b8f391cb[0m
[[36m2024-10-09 23:21:58,197[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for bc5237a523a4438fa1a40fe4[0m
[[36m2024-10-09 23:21:58,198[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:21:58,198[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f8d541b1840>[0m
[[36m2024-10-09 23:21:58,198[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:21:58,199[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fc51cee5c00>[0m
[[36m2024-10-09 23:21:58,272[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-09 23:21:58,341[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 24.76it/s v_num: 91cb      
                                                               val/ei_step:     
                                                               1.204            
                                                               val/ei_term1_ste…
                                                               0.859            
                                                               val/ei_term2_ste…
                                                               1.549 val/MAE:   
                                                               0.224            
                                                               val/ei_epoch:    
                                                               1.271            
                                                               val/ei_term1_epo…
                                                               0.995            
                                                               val/ei_term2_epo…
                                                               1.547 val/loss:  
                                                               0.240 train/MAE: 
                                                               0.312 train/loss:
                                                               0.340            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:28 • 0:00:05 0.63it/s                   
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-09 23:23:05,786[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 54, in <lambda>
    self.func = lambda x: (self.dynamics(x) + x)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/activation.py", line 774, in forward
    return F.leaky_relu(input, self.negative_slope, self.inplace)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/functional.py", line 1648, in leaky_relu
    result = torch._C._nn.leaky_relu(input, negative_slope)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:23:05,793[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/0[0m
[[36m2024-10-09 23:23:05,796[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:23:06,029[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:23:06,031[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:23:06,097[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:23:06,099[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/1[0m
[[36m2024-10-09 23:23:06,100[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:23:06,325[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:23:06,327[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:23:06,604[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:23:06,606[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/2[0m
[[36m2024-10-09 23:23:06,607[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:23:06,834[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:23:06,836[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:23:06,902[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:23:06,903[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/3[0m
[[36m2024-10-09 23:23:06,905[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:23:07,134[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:23:07,136[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:23:07,201[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:23:07,202[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 54, in <lambda>
    self.func = lambda x: (self.dynamics(x) + x)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/activation.py", line 774, in forward
    return F.leaky_relu(input, self.negative_slope, self.inplace)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/functional.py", line 1648, in leaky_relu
    result = torch._C._nn.leaky_relu(input, negative_slope)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 23.40it/s v_num: 0fe4      
                                                               val/ei_step:     
                                                               1.324            
                                                               val/ei_term1_ste…
                                                               1.260            
                                                               val/ei_term2_ste…
                                                               1.388 val/MAE:   
                                                               0.228            
                                                               val/ei_epoch:    
                                                               1.222            
                                                               val/ei_term1_epo…
                                                               1.053            
                                                               val/ei_term2_epo…
                                                               1.391 val/loss:  
                                                               0.249 train/MAE: 
                                                               0.317 train/loss:
                                                               0.343            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:53 • 0:00:09 0.34it/s                   
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-09 23:24:06,270[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 33, in f
    z = (1 - self.mask[i]) * (z - t) * torch.exp(-s) + z_
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:24:06,278[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/0[0m
[[36m2024-10-09 23:24:06,282[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:24:06,498[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:24:06,500[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:24:06,563[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:24:06,564[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/1[0m
[[36m2024-10-09 23:24:06,565[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:24:06,775[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:24:06,777[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:24:06,838[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:24:06,839[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/2[0m
[[36m2024-10-09 23:24:06,841[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:24:07,249[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:24:07,251[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:24:07,313[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:24:07,314[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/3[0m
[[36m2024-10-09 23:24:07,315[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:24:07,528[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:24:07,530[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:24:07,591[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:24:07,592[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-21-54/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 33, in f
    z = (1 - self.mask[i]) * (z - t) * torch.exp(-s) + z_
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-09 23:24:55,154[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:24:55,154[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:24:55,158[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:24:55,158[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:24:55,366[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:24:55,370[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-09 23:24:55,371[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:24:55,375[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:24:55,440[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-09 23:24:55,446[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:24:56,624[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:24:56,628[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:24:56,737[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:24:56,738[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:24:56,741[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:24:56,742[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:24:56,743[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:24:56,743[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:24:56,744[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:24:56,767[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:24:56,768[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:24:56,772[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:24:56,774[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:24:56,775[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:24:56,776[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:24:56,776[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:24:57,632[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-09 23:24:57,666[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:24:57,720[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[[36m2024-10-09 23:24:57,743[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b8ed467b69a7492ea04ef61e[0m
[[36m2024-10-09 23:24:57,744[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:24:57,744[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f81e895d8a0>[0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:24:57,752[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-09 23:24:57,772[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for b2c9eeb7e9804f9b9e5db2b2[0m
[[36m2024-10-09 23:24:57,773[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:24:57,774[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fe728b89ba0>[0m
[[36m2024-10-09 23:24:57,811[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-09 23:24:57,842[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 24.52it/s v_num: f61e      
                                                               val/ei_step:     
                                                               1.204            
                                                               val/ei_term1_ste…
                                                               0.859            
                                                               val/ei_term2_ste…
                                                               1.549 val/MAE:   
                                                               0.224            
                                                               val/ei_epoch:    
                                                               1.271            
                                                               val/ei_term1_epo…
                                                               0.995            
                                                               val/ei_term2_epo…
                                                               1.547 val/loss:  
                                                               0.240 train/MAE: 
                                                               0.312 train/loss:
                                                               0.340            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:27 • 0:00:05 0.65it/s                   
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-09 23:26:04,475[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 104, in cal_EI_1
    jac_in = L * (2 * torch.rand(num_samples, input_size, dtype=h_t.dtype, device=h_t.device) - 1)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:26:04,482[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/0[0m
[[36m2024-10-09 23:26:04,486[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:26:04,722[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:26:04,725[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:26:04,796[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:26:04,798[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/1[0m
[[36m2024-10-09 23:26:04,799[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:26:05,031[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:26:05,033[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:26:05,329[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:26:05,331[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/2[0m
[[36m2024-10-09 23:26:05,332[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:26:05,584[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:26:05,585[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:26:05,650[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:26:05,651[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/3[0m
[[36m2024-10-09 23:26:05,652[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:26:05,877[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:26:05,879[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:26:05,944[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:26:05,945[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 104, in cal_EI_1
    jac_in = L * (2 * torch.rand(num_samples, input_size, dtype=h_t.dtype, device=h_t.device) - 1)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-09 23:26:50,724[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:26:50,724[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:26:50,724[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:26:50,724[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:26:50,948[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:26:50,949[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:26:50,953[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-09 23:26:50,954[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
Seed set to 2050
[[36m2024-10-09 23:26:51,030[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:26:51,030[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:26:52,215[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:26:52,239[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:26:52,356[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:26:52,356[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:26:52,357[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:26:52,357[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:26:52,360[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:26:52,360[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:26:52,361[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:26:52,362[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:26:52,362[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:26:52,362[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:26:52,363[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:26:52,363[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:26:52,363[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:26:52,363[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:26:53,309[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
[[36m2024-10-09 23:26:53,309[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:26:53,384[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:26:53,396[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-09 23:26:53,406[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 2f29dcffbf4b4502bb7c0929[0m
[[36m2024-10-09 23:26:53,407[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:26:53,407[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fce91cdd840>[0m
[[36m2024-10-09 23:26:53,419[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for afcf6f7ccb504657bba77d8e[0m
[[36m2024-10-09 23:26:53,421[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:26:53,421[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f5c8a4ddc60>[0m
[[36m2024-10-09 23:26:53,471[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-09 23:26:53,501[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 22.17it/s v_num: b2b2      
                                                               val/ei_step:     
                                                               1.324            
                                                               val/ei_term1_ste…
                                                               1.260            
                                                               val/ei_term2_ste…
                                                               1.388 val/MAE:   
                                                               0.228            
                                                               val/ei_epoch:    
                                                               1.222            
                                                               val/ei_term1_epo…
                                                               1.053            
                                                               val/ei_term2_epo…
                                                               1.391 val/loss:  
                                                               0.249 train/MAE: 
                                                               0.317 train/loss:
                                                               0.343            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:56 • 0:00:10 0.31it/s                   
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-09 23:27:09,240[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 31, in f
    s = self.s[i](z_) * (1 - self.mask[i])
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 116, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:27:09,247[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/0[0m
[[36m2024-10-09 23:27:09,250[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:27:09,487[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:27:09,489[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:27:09,558[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:27:09,560[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/1[0m
[[36m2024-10-09 23:27:09,561[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:27:09,795[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:27:09,797[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:27:09,865[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:27:09,866[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/2[0m
[[36m2024-10-09 23:27:09,867[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:27:10,324[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:27:10,326[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:27:10,394[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:27:10,395[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/3[0m
[[36m2024-10-09 23:27:10,396[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:27:10,637[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:27:10,639[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:27:10,706[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:27:10,707[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-24-54/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 31, in f
    s = self.s[i](z_) * (1 - self.mask[i])
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 116, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-09 23:27:51,475[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:27:51,475[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:27:51,495[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:27:51,495[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:27:51,709[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:27:51,714[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-09 23:27:51,729[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:27:51,734[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:27:51,791[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:27:51,811[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:27:53,051[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:27:53,081[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:27:53,199[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:27:53,199[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:27:53,203[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:27:53,203[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:27:53,203[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:27:53,204[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:27:53,205[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:27:53,206[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:27:53,206[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:27:53,206[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:27:53,207[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:27:53,208[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:27:53,209[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:27:53,209[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:27:54,176[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
[[36m2024-10-09 23:27:54,183[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:27:54,264[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:27:54,271[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-09 23:27:54,289[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c9bc84efdd50483db499b980[0m
[[36m2024-10-09 23:27:54,290[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:27:54,290[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f8e282a1c30>[0m
[[36m2024-10-09 23:27:54,294[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 4430ed01e4404b78ba4321d9[0m
[[36m2024-10-09 23:27:54,295[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:27:54,295[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fad25cd98d0>[0m
[[36m2024-10-09 23:27:54,366[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-10-09 23:27:54,428[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 24.43it/s v_num: 0929      
                                                               val/ei_step:     
                                                               1.204            
                                                               val/ei_term1_ste…
                                                               0.859            
                                                               val/ei_term2_ste…
                                                               1.549 val/MAE:   
                                                               0.224            
                                                               val/ei_epoch:    
                                                               1.271            
                                                               val/ei_term1_epo…
                                                               0.995            
                                                               val/ei_term2_epo…
                                                               1.547 val/loss:  
                                                               0.240 train/MAE: 
                                                               0.312 train/loss:
                                                               0.340            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:32 • 0:00:05 0.65it/s                   
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
[[36m2024-10-09 23:28:03,904[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
[[36m2024-10-09 23:28:03,910[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/0[0m
[[36m2024-10-09 23:28:03,914[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
[[36m2024-10-09 23:28:04,379[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:28:04,381[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:28:04,452[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:28:04,454[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/1[0m
[[36m2024-10-09 23:28:04,455[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:28:04,686[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:28:04,688[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:28:04,965[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:28:04,966[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/2[0m
[[36m2024-10-09 23:28:04,967[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:28:05,200[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:28:05,202[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:28:05,271[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:28:05,272[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/3[0m
[[36m2024-10-09 23:28:05,273[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:28:05,505[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:28:05,507[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:28:05,575[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:28:05,576[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:01 • 0:00:00 19.56it/s v_num: 7d8e      
                                                               val/ei_step:     
                                                               1.324            
                                                               val/ei_term1_ste…
                                                               1.260            
                                                               val/ei_term2_ste…
                                                               1.388 val/MAE:   
                                                               0.228            
                                                               val/ei_epoch:    
                                                               1.222            
                                                               val/ei_term1_epo…
                                                               1.053            
                                                               val/ei_term2_epo…
                                                               1.391 val/loss:  
                                                               0.249 train/MAE: 
                                                               0.317 train/loss:
                                                               0.343            
Validation  ━━━━━━━━━━━━━╸   18/21 0:01:00 • 0:00:10 0.32it/s                   
[[36m2024-10-09 23:29:13,476[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: CUBLAS_STATUS_INTERNAL_ERROR when calling `cublasGemmEx( handle, opa, opb, m, n, k, &falpha, a, CUDA_R_16F, lda, b, CUDA_R_16F, ldb, &fbeta, c, CUDA_R_16F, ldc, CUDA_R_32F, CUBLAS_GEMM_DEFAULT_TENSOR_OP)`

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:29:13,483[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/0[0m
[[36m2024-10-09 23:29:13,487[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:29:13,724[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:29:13,726[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:29:13,795[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:29:13,797[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/1[0m
[[36m2024-10-09 23:29:13,798[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:29:14,030[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:29:14,032[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:29:14,315[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:29:14,316[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/2[0m
[[36m2024-10-09 23:29:14,317[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:29:14,549[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:29:14,551[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:29:14,619[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:29:14,620[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/3[0m
[[36m2024-10-09 23:29:14,622[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:29:14,855[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:29:14,857[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 7000                                                                
│         - 5000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         7000, 5000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:29:14,925[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:29:14,926[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-26-49/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: CUBLAS_STATUS_INTERNAL_ERROR when calling `cublasGemmEx( handle, opa, opb, m, n, k, &falpha, a, CUDA_R_16F, lda, b, CUDA_R_16F, ldb, &fbeta, c, CUDA_R_16F, ldc, CUDA_R_32F, CUBLAS_GEMM_DEFAULT_TENSOR_OP)`

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: unspecified launch failure
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-09 23:32:47,994[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:32:47,994[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:32:47,996[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:32:47,996[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:32:48,210[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:32:48,212[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:32:48,214[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-09 23:32:48,217[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:32:48,292[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
Seed set to 2050
[[36m2024-10-09 23:32:48,296[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:32:49,517[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:32:49,530[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:32:49,640[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:32:49,640[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:32:49,643[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:32:49,644[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:32:49,645[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:32:49,646[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:32:49,646[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:32:49,653[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:32:49,654[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:32:49,658[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:32:49,659[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:32:49,660[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:32:49,660[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:32:49,661[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:32:50,542[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-09 23:32:50,553[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:32:50,630[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:32:50,640[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-09 23:32:50,653[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 4edfd709bbda49c9942a7b91[0m
[[36m2024-10-09 23:32:50,655[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:32:50,655[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f54d11cd7e0>[0m
[[36m2024-10-09 23:32:50,662[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 3025074ef374469a9888ee97[0m
[[36m2024-10-09 23:32:50,663[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:32:50,664[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fb3756adbd0>[0m
[[36m2024-10-09 23:32:50,733[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[[36m2024-10-09 23:32:50,808[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (19) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 23.97it/s v_num: 7b91      
                                                               val/ei_step:     
                                                               1.204            
                                                               val/ei_term1_ste…
                                                               0.859            
                                                               val/ei_term2_ste…
                                                               1.549 val/MAE:   
                                                               0.224            
                                                               val/ei_epoch:    
                                                               1.271            
                                                               val/ei_term1_epo…
                                                               0.995            
                                                               val/ei_term2_epo…
                                                               1.547 val/loss:  
                                                               0.240 train/MAE: 
                                                               0.312 train/loss:
                                                               0.340            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:27 • 0:00:05 0.65it/s                   
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-09 23:33:57,720[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:33:57,726[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/0[0m
[[36m2024-10-09 23:33:57,729[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:33:57,956[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:33:57,958[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:33:58,026[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:33:58,028[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/1[0m
[[36m2024-10-09 23:33:58,029[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:33:58,258[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:33:58,259[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:33:58,533[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:33:58,534[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/2[0m
[[36m2024-10-09 23:33:58,535[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:33:58,758[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:33:58,759[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:33:58,825[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:33:58,827[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/3[0m
[[36m2024-10-09 23:33:58,828[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:33:59,054[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:33:59,056[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:33:59,123[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:33:59,124[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_nisp.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 121, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 786, in jacobian
    vj = _autograd_grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 192, in _autograd_grad
    return torch.autograd.grad(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 411, in grad
    result = Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Epoch 1/100 ━━━━━━━━━━━━━━━━ 19/19 0:00:00 • 0:00:00 22.45it/s v_num: ee97      
                                                               val/ei_step:     
                                                               1.324            
                                                               val/ei_term1_ste…
                                                               1.260            
                                                               val/ei_term2_ste…
                                                               1.388 val/MAE:   
                                                               0.228            
                                                               val/ei_epoch:    
                                                               1.222            
                                                               val/ei_term1_epo…
                                                               1.053            
                                                               val/ei_term2_epo…
                                                               1.391 val/loss:  
                                                               0.249 train/MAE: 
                                                               0.317 train/loss:
                                                               0.343            
Validation  ━━━━━━━━━━━━━╸   18/21 0:00:55 • 0:00:10 0.32it/s                   
/opt/conda/conda-bld/pytorch_1711403380909/work/aten/src/ATen/native/cuda/IndexKernel.cu:92: operator(): block: [0,0,0], thread: [63,0,0] Assertion `-sizes[i] <= index && index < sizes[i] && "index out of bounds"` failed.
[[36m2024-10-09 23:34:59,386[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 31, in f
    s = self.s[i](z_) * (1 - self.mask[i])
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/activation.py", line 774, in forward
    return F.leaky_relu(input, self.negative_slope, self.inplace)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/functional.py", line 1648, in leaky_relu
    result = torch._C._nn.leaky_relu(input, negative_slope)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:34:59,394[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/0[0m
[[36m2024-10-09 23:34:59,398[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:34:59,615[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:34:59,617[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-09 23:34:59,680[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:34:59,681[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/1[0m
[[36m2024-10-09 23:34:59,682[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:34:59,895[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:34:59,896[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-09 23:35:00,155[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:35:00,156[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/2[0m
[[36m2024-10-09 23:35:00,157[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:35:00,378[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:35:00,380[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-09 23:35:00,442[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:35:00,443[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/3[0m
[[36m2024-10-09 23:35:00,444[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:35:00,653[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:35:00,655[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 700                                                                 
│         - 500                                                                 
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         700, 500, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                          
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-09 23:35:00,715[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 72, in train
    L.seed_everything(cfg.seed, workers=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/seed.py", line 58, in seed_everything
    torch.manual_seed(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 489, in _fn
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 17, in inner
    return fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/random.py", line 40, in manual_seed
    torch.cuda.manual_seed_all(seed)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 126, in manual_seed_all
    _lazy_call(cb, seed_all=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/__init__.py", line 232, in _lazy_call
    callable()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/cuda/random.py", line 124, in cb
    default_generator.manual_seed(seed)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[[36m2024-10-09 23:35:00,716[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-32-47/4[0m
Error executing job with overrides: ['seed=2050', 'experiment=ymz_nis/ood_rnis.yaml', 'trainer=gpu', 'logger=aim']
Traceback (most recent call last):
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 580, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 987, in _run
    results = self._run_stage()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1033, in _run_stage
    self.fit_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/utilities.py", line 182, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 177, in validation_step
    loss, preds, targets, ei_items = self.model_step(batch)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 327, in model_step
    y_hat, ei_items = self.forward(x, y)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/sir_module.py", line 103, in forward
    return self.net(x, y)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 205, in forward
    count, avg_log_jacobian = self.cal_EI_1(h_t, num_samples, L)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 105, in cal_EI_1
    jacobian_matrix = jacobian(self.func, jac_in)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/autograd/functional.py", line 674, in jacobian
    outputs = func(*inputs)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 177, in <lambda>
    self.func = lambda x: (self.dynamics.f(x)[0])
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/models/components/nis_net.py", line 31, in f
    s = self.s[i](z_) * (1 - self.mask[i])
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/modules/activation.py", line 774, in forward
    return F.leaky_relu(input, self.negative_slope, self.inplace)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/torch/nn/functional.py", line 1648, in leaky_relu
    result = torch._C._nn.leaky_relu(input, negative_slope)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 137, in main
    metric_dict, _ = train(cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 78, in wrap
    raise ex
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/utils/utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "/home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/src/train.py", line 104, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 544, in fit
    call._call_and_handle_interrupt(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1010, in _teardown
    self.strategy.teardown()
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 533, in teardown
    _optimizers_to_device(self.optimizers, torch.device("cpu"))
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 28, in _optimizers_to_device
    _optimizer_to_device(opt, device)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/optimizer.py", line 34, in _optimizer_to_device
    optimizer.state[p] = apply_to_collection(v, Tensor, move_data_to_device, device, allow_frozen=True)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 52, in apply_to_collection
    return _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 104, in _apply_to_collection_slow
    v = _apply_to_collection_slow(
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 96, in _apply_to_collection_slow
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 103, in move_data_to_device
    return apply_to_collection(batch, dtype=_TransferableDataType, function=batch_to)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning_utilities/core/apply_func.py", line 64, in apply_to_collection
    return function(data, *args, **kwargs)
  File "/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/utilities/apply_func.py", line 97, in batch_to
    data_output = data.to(device, **kwargs)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[[36m2024-10-09 23:37:42,444[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:37:42,444[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:37:42,470[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-09 23:37:42,470[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-09 23:37:42,656[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:37:42,660[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-09 23:37:42,689[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-09 23:37:42,694[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:37:42,735[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-09 23:37:42,766[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-09 23:37:43,907[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:37:43,959[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-09 23:37:44,045[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:37:44,045[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:37:44,050[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:37:44,051[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:37:44,052[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:37:44,052[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:37:44,053[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:37:44,072[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-09 23:37:44,072[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-09 23:37:44,075[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-09 23:37:44,077[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-09 23:37:44,077[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-09 23:37:44,078[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-09 23:37:44,078[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-09 23:37:44,957[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-09 23:37:44,983[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:37:45,039[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[[36m2024-10-09 23:37:45,060[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ee83e74117dc4bdd9275e1d3[0m
[[36m2024-10-09 23:37:45,061[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:37:45,062[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99a55e5780>[0m
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-09 23:37:45,075[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-09 23:37:45,097[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 13f2e0d3aef347a8b4436d6b[0m
[[36m2024-10-09 23:37:45,098[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-09 23:37:45,098[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0df1661c00>[0m
[[36m2024-10-09 23:37:45,136[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-10-09 23:37:45,167[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        21.61it/s v_num: e1d3      
                                    0:00:00                    val/ei_step:     
                                                               2.908            
                                                               val/ei_term1_ste…
                                                               4.381            
                                                               val/ei_term2_ste…
                                                               1.435 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               2.832            
                                                               val/ei_term1_epo…
                                                               4.227            
                                                               val/ei_term2_epo…
                                                               1.437 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 00:36:10,466[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 00:36:10,471[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ee83e74117dc4bdd9275e1d3'. Data corruption may occur if there is active process writing to Run 'ee83e74117dc4bdd9275e1d3'.[0m
[[36m2024-10-10 00:36:10,484[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ee83e74117dc4bdd9275e1d3[0m
[[36m2024-10-10 00:36:10,485[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 00:36:10,486[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99b7c2eef0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013167213648557663    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -64.13391876220703     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.014145290479063988    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.57it/s 
[[36m2024-10-10 00:36:12,177[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-10 00:36:12,182[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0[0m
[[36m2024-10-10 00:36:12,183[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 00:36:12,188[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 00:36:12,418[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 00:36:12,420[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-10 00:36:12,484[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 00:36:12,500[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 00:36:12,513[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 00:36:12,514[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 00:36:12,516[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 00:36:12,517[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 00:36:12,518[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 00:36:12,518[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 00:36:12,519[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 00:36:12,521[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 00:36:12,533[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 00:36:12,541[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for dcf7c058deaa496484655f4a[0m
[[36m2024-10-10 00:36:12,543[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 00:36:12,543[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99b4a01e70>[0m
[[36m2024-10-10 00:36:12,586[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:02 •        18.96it/s v_num: 6d6b      
                                    0:00:00                    val/ei_step:     
                                                               2.995            
                                                               val/ei_term1_ste…
                                                               4.608            
                                                               val/ei_term2_ste…
                                                               1.382 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               3.024            
                                                               val/ei_term1_epo…
                                                               4.667            
                                                               val/ei_term2_epo…
                                                               1.381 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-10 01:29:13,646[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 01:29:13,651[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '13f2e0d3aef347a8b4436d6b'. Data corruption may occur if there is active process writing to Run '13f2e0d3aef347a8b4436d6b'.[0m
[[36m2024-10-10 01:29:13,662[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 13f2e0d3aef347a8b4436d6b[0m
[[36m2024-10-10 01:29:13,664[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 01:29:13,664[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0df1662290>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0/checkpoints/epoch_097.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0/checkpoints/epoch_097.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012468880973756313    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -72.42622375488281     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013030639849603176    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.73it/s 
[[36m2024-10-10 01:29:15,452[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0/checkpoints/epoch_097.ckpt[0m
[[36m2024-10-10 01:29:15,457[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/0[0m
[[36m2024-10-10 01:29:15,459[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 01:29:15,463[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 01:29:15,884[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 01:29:15,887[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-10 01:29:15,951[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 01:29:15,968[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 01:29:15,983[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 01:29:15,983[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 01:29:15,986[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 01:29:15,987[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 01:29:15,987[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 01:29:15,988[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 01:29:15,988[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 01:29:15,990[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 01:29:16,002[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 01:29:16,011[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ae07ce59c1ff431a9a836e0d[0m
[[36m2024-10-10 01:29:16,012[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 01:29:16,012[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0dd017b460>[0m
[[36m2024-10-10 01:29:16,055[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
`Trainer.fit` stopped: `max_epochs=101` reached.
Epoch 100/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •       23.51it/s v_num: 5f4a      
                                     0:00:00                   val/ei_step:     
                                                               2.967            
                                                               val/ei_term1_ste…
                                                               4.485            
                                                               val/ei_term2_ste…
                                                               1.450 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               2.939            
                                                               val/ei_term1_epo…
                                                               4.427            
                                                               val/ei_term2_epo…
                                                               1.451 val/loss:  
                                                               0.013 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-10 01:35:04,459[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 01:35:04,462[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'dcf7c058deaa496484655f4a'. Data corruption may occur if there is active process writing to Run 'dcf7c058deaa496484655f4a'.[0m
[[36m2024-10-10 01:35:04,476[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for dcf7c058deaa496484655f4a[0m
[[36m2024-10-10 01:35:04,478[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 01:35:04,478[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f999c0db610>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints/epoch_100.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints/epoch_100.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012529530562460423    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -67.11687469482422     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013440077193081379    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.53it/s 
[[36m2024-10-10 01:35:06,155[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints/epoch_100.ckpt[0m
[[36m2024-10-10 01:35:06,159[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1[0m
[[36m2024-10-10 01:35:06,160[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 01:35:06,165[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 01:35:06,400[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 01:35:06,402[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-10 01:35:06,466[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 01:35:06,482[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 01:35:06,495[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 01:35:06,496[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 01:35:06,498[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 01:35:06,500[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 01:35:06,500[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 01:35:06,501[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 01:35:06,501[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 01:35:06,503[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 01:35:06,515[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 01:35:06,523[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for df8c16359e774c78b14b8bd6[0m
[[36m2024-10-10 01:35:06,524[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 01:35:06,525[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99b7c2f070>[0m
[[36m2024-10-10 01:35:06,573[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        22.05it/s v_num: 8bd6      
                                    0:00:00                    val/ei_step:     
                                                               2.935            
                                                               val/ei_term1_ste…
                                                               4.416            
                                                               val/ei_term2_ste…
                                                               1.453 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               2.956            
                                                               val/ei_term1_epo…
                                                               4.458            
                                                               val/ei_term2_epo…
                                                               1.454 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-10 02:33:33,149[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 02:33:33,151[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'df8c16359e774c78b14b8bd6'. Data corruption may occur if there is active process writing to Run 'df8c16359e774c78b14b8bd6'.[0m
[[36m2024-10-10 02:33:33,165[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for df8c16359e774c78b14b8bd6[0m
[[36m2024-10-10 02:33:33,167[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 02:33:33,167[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99e8a72d70>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints/epoch_091.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints/epoch_091.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013212102465331554    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -68.05209350585938     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013989927247166634    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.62it/s 
[[36m2024-10-10 02:33:34,848[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints/epoch_091.ckpt[0m
[[36m2024-10-10 02:33:34,852[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2[0m
[[36m2024-10-10 02:33:34,854[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 02:33:34,858[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 02:33:35,091[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 02:33:35,093[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-10 02:33:35,157[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 02:33:35,173[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 02:33:35,186[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 02:33:35,186[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 02:33:35,189[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 02:33:35,190[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 02:33:35,190[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 02:33:35,191[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 02:33:35,191[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 02:33:35,193[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 02:33:35,205[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 02:33:35,213[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 74a4ce46517b405bbc4de7e1[0m
[[36m2024-10-10 02:33:35,214[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 02:33:35,214[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99b4995db0>[0m
[[36m2024-10-10 02:33:35,255[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
`Trainer.fit` stopped: `max_epochs=101` reached.
Epoch 100/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •       22.57it/s v_num: 6e0d      
                                     0:00:00                   val/ei_step:     
                                                               2.948            
                                                               val/ei_term1_ste…
                                                               4.528            
                                                               val/ei_term2_ste…
                                                               1.367 val/MAE:   
                                                               0.014            
                                                               val/ei_epoch:    
                                                               2.837            
                                                               val/ei_term1_epo…
                                                               4.306            
                                                               val/ei_term2_epo…
                                                               1.367 val/loss:  
                                                               0.015 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 03:22:29,663[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 03:22:29,667[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ae07ce59c1ff431a9a836e0d'. Data corruption may occur if there is active process writing to Run 'ae07ce59c1ff431a9a836e0d'.[0m
[[36m2024-10-10 03:22:29,678[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ae07ce59c1ff431a9a836e0d[0m
[[36m2024-10-10 03:22:29,680[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 03:22:29,680[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0df1628430>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013714874163269997    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -65.40653228759766     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.014725127257406712    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 15.68it/s 
[[36m2024-10-10 03:22:31,475[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-10 03:22:31,479[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/1[0m
[[36m2024-10-10 03:22:31,481[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 03:22:31,485[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 03:22:31,725[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 03:22:31,727[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-10 03:22:31,793[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 03:22:31,809[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 03:22:31,823[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 03:22:31,824[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 03:22:31,826[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 03:22:31,827[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 03:22:31,828[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 03:22:31,828[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 03:22:31,829[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 03:22:31,831[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 03:22:31,843[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 03:22:31,851[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 895de96d079049c7befb70dd[0m
[[36m2024-10-10 03:22:31,852[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 03:22:31,853[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0e02c126e0>[0m
[[36m2024-10-10 03:22:31,895[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        23.04it/s v_num: e7e1      
                                    0:00:00                    val/ei_step:     
                                                               2.915            
                                                               val/ei_term1_ste…
                                                               4.333            
                                                               val/ei_term2_ste…
                                                               1.497 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               2.790            
                                                               val/ei_term1_epo…
                                                               4.089            
                                                               val/ei_term2_epo…
                                                               1.492 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.011 train/loss:
                                                               0.012            
[[36m2024-10-10 03:31:41,370[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 03:31:41,373[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '74a4ce46517b405bbc4de7e1'. Data corruption may occur if there is active process writing to Run '74a4ce46517b405bbc4de7e1'.[0m
[[36m2024-10-10 03:31:41,389[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 74a4ce46517b405bbc4de7e1[0m
[[36m2024-10-10 03:31:41,392[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 03:31:41,392[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99b4945930>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints/epoch_095.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints/epoch_095.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.01335287094116211    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -62.217777252197266    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.014558681286871433    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.12it/s 
[[36m2024-10-10 03:31:43,315[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints/epoch_095.ckpt[0m
[[36m2024-10-10 03:31:43,319[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3[0m
[[36m2024-10-10 03:31:43,320[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 03:31:43,322[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 03:31:43,557[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 03:31:43,559[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-10 03:31:43,622[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 03:31:43,638[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 03:31:43,651[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 03:31:43,651[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 03:31:43,653[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 03:31:43,655[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 03:31:43,655[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 03:31:43,656[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 03:31:43,656[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 03:31:43,658[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 03:31:43,669[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 03:31:43,677[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f4c9b59be2774244a438e9aa[0m
[[36m2024-10-10 03:31:43,678[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 03:31:43,679[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99b49f1c30>[0m
[[36m2024-10-10 03:31:43,722[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        22.41it/s v_num: e9aa      
                                    0:00:00                    val/ei_step:     
                                                               2.957            
                                                               val/ei_term1_ste…
                                                               4.531            
                                                               val/ei_term2_ste…
                                                               1.383 val/MAE:   
                                                               0.012            
                                                               val/ei_epoch:    
                                                               2.943            
                                                               val/ei_term1_epo…
                                                               4.503            
                                                               val/ei_term2_epo…
                                                               1.383 val/loss:  
                                                               0.013 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 04:30:01,705[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 04:30:01,708[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'f4c9b59be2774244a438e9aa'. Data corruption may occur if there is active process writing to Run 'f4c9b59be2774244a438e9aa'.[0m
[[36m2024-10-10 04:30:01,722[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for f4c9b59be2774244a438e9aa[0m
[[36m2024-10-10 04:30:01,724[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 04:30:01,724[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f99a55bc280>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints/epoch_098.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints/epoch_098.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.012302448973059654    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -68.84468078613281     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013198534958064556    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.62it/s 
[[36m2024-10-10 04:30:03,399[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints/epoch_098.ckpt[0m
[[36m2024-10-10 04:30:03,404[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4[0m
[[36m2024-10-10 04:30:03,405[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        21.41it/s v_num: 70dd      
                                    0:00:00                    val/ei_step:     
                                                               3.083            
                                                               val/ei_term1_ste…
                                                               4.775            
                                                               val/ei_term2_ste…
                                                               1.391 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               3.032            
                                                               val/ei_term1_epo…
                                                               4.673            
                                                               val/ei_term2_epo…
                                                               1.391 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-10 05:14:39,577[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 05:14:39,581[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '895de96d079049c7befb70dd'. Data corruption may occur if there is active process writing to Run '895de96d079049c7befb70dd'.[0m
[[36m2024-10-10 05:14:39,595[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 895de96d079049c7befb70dd[0m
[[36m2024-10-10 05:14:39,597[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 05:14:39,597[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0e02b6c220>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints/epoch_093.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints/epoch_093.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013408344238996506    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -70.93885803222656     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.014075784012675285    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.29it/s 
[[36m2024-10-10 05:14:41,308[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2/checkpoints/epoch_093.ckpt[0m
[[36m2024-10-10 05:14:41,312[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/2[0m
[[36m2024-10-10 05:14:41,313[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 05:14:41,318[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 05:14:41,542[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 05:14:41,544[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-10 05:14:41,604[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 05:14:41,619[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 05:14:41,632[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 05:14:41,632[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 05:14:41,635[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 05:14:41,636[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 05:14:41,636[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 05:14:41,637[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 05:14:41,637[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 05:14:41,639[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 05:14:41,650[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 05:14:41,660[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 855902f29a8441d68975f64f[0m
[[36m2024-10-10 05:14:41,662[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 05:14:41,662[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0e02c132b0>[0m
[[36m2024-10-10 05:14:41,712[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        21.09it/s v_num: f64f      
                                    0:00:00                    val/ei_step:     
                                                               2.898            
                                                               val/ei_term1_ste…
                                                               4.439            
                                                               val/ei_term2_ste…
                                                               1.357 val/MAE:   
                                                               0.014            
                                                               val/ei_epoch:    
                                                               2.776            
                                                               val/ei_term1_epo…
                                                               4.193            
                                                               val/ei_term2_epo…
                                                               1.358 val/loss:  
                                                               0.015 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 07:05:56,803[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 07:05:56,806[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '855902f29a8441d68975f64f'. Data corruption may occur if there is active process writing to Run '855902f29a8441d68975f64f'.[0m
[[36m2024-10-10 07:05:56,819[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 855902f29a8441d68975f64f[0m
[[36m2024-10-10 07:05:56,820[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 07:05:56,821[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0df16623e0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints/epoch_099.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints/epoch_099.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013902763836085796    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -63.67322540283203     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.015020270831882954    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.37it/s 
[[36m2024-10-10 07:05:58,516[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3/checkpoints/epoch_099.ckpt[0m
[[36m2024-10-10 07:05:58,521[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/3[0m
[[36m2024-10-10 07:05:58,522[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 07:05:58,526[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 07:05:58,752[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 07:05:58,753[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 5                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 5                                                                   
│         - 5                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 5, 5]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-10 07:05:58,813[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 07:05:58,828[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 07:05:58,841[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 07:05:58,841[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 07:05:58,844[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 07:05:58,845[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 07:05:58,845[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 07:05:58,846[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 07:05:58,846[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 07:05:58,848[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 07:05:58,859[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 07:05:58,867[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e9a5d676ec60480cbb080747[0m
[[36m2024-10-10 07:05:58,868[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 07:05:58,868[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0e00a1ab00>[0m
[[36m2024-10-10 07:05:58,922[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        21.17it/s v_num: 0747      
                                    0:00:00                    val/ei_step:     
                                                               3.102            
                                                               val/ei_term1_ste…
                                                               4.811            
                                                               val/ei_term2_ste…
                                                               1.393 val/MAE:   
                                                               0.013            
                                                               val/ei_epoch:    
                                                               2.955            
                                                               val/ei_term1_epo…
                                                               4.515            
                                                               val/ei_term2_epo…
                                                               1.394 val/loss:  
                                                               0.014 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 08:57:54,608[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 08:57:54,612[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'e9a5d676ec60480cbb080747'. Data corruption may occur if there is active process writing to Run 'e9a5d676ec60480cbb080747'.[0m
[[36m2024-10-10 08:57:54,624[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e9a5d676ec60480cbb080747[0m
[[36m2024-10-10 08:57:54,625[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 08:57:54,625[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f0e34b59fc0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints/epoch_094.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints/epoch_094.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.013173541985452175    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -69.72591400146484     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.013729111291468143    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.33it/s 
[[36m2024-10-10 08:57:56,312[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4/checkpoints/epoch_094.ckpt[0m
[[36m2024-10-10 08:57:56,316[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-09_23-37-41/4[0m
[[36m2024-10-10 08:57:56,317[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 19:06:32,328[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-10 19:06:32,329[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 19:06:32,352[0m][[35mHYDRA[0m] Launching 5 jobs locally[0m
[[36m2024-10-10 19:06:32,352[0m][[35mHYDRA[0m] 	#0 : seed=2050 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 19:06:32,555[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 19:06:32,559[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
[[36m2024-10-10 19:06:32,580[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 19:06:32,584[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-10 19:06:32,636[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2050                                                                    
Seed set to 2050
[[36m2024-10-10 19:06:32,670[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 19:06:33,847[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 19:06:33,917[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 19:06:33,989[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 19:06:33,990[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 19:06:33,994[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 19:06:33,995[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 19:06:33,996[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 19:06:33,996[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 19:06:33,996[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 19:06:34,033[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 19:06:34,034[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 19:06:34,038[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 19:06:34,040[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 19:06:34,041[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 19:06:34,042[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 19:06:34,042[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 19:06:34,938[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
[[36m2024-10-10 19:06:34,986[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 19:06:35,024[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 19:06:35,049[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ab36982621fe4587b9cd963b[0m
[[36m2024-10-10 19:06:35,051[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 19:06:35,051[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbf35035bd0>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 19:06:35,071[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 19:06:35,092[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 53c5f75a41854a40a01e4cef[0m
[[36m2024-10-10 19:06:35,093[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 19:06:35,093[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00a05d97e0>[0m
[[36m2024-10-10 19:06:35,126[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[[36m2024-10-10 19:06:35,162[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        19.48it/s v_num: 4cef      
                                    0:00:00                    val/ei_step:     
                                                               2.010            
                                                               val/ei_term1_ste…
                                                               2.560            
                                                               val/ei_term2_ste…
                                                               1.460 val/MAE:   
                                                               0.022            
                                                               val/ei_epoch:    
                                                               2.421            
                                                               val/ei_term1_epo…
                                                               3.381            
                                                               val/ei_term2_epo…
                                                               1.462 val/loss:  
                                                               0.025 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-10 20:04:09,273[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 20:04:09,276[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '53c5f75a41854a40a01e4cef'. Data corruption may occur if there is active process writing to Run '53c5f75a41854a40a01e4cef'.[0m
[[36m2024-10-10 20:04:09,290[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 53c5f75a41854a40a01e4cef[0m
[[36m2024-10-10 20:04:09,292[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 20:04:09,292[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00a0683f40>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0/checkpoints/epoch_067.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0/checkpoints/epoch_067.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.021703947335481644    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -50.85226058959961     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.024531034752726555    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.97it/s 
[[36m2024-10-10 20:04:10,982[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0/checkpoints/epoch_067.ckpt[0m
[[36m2024-10-10 20:04:10,986[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0[0m
[[36m2024-10-10 20:04:10,988[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 20:04:10,992[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 20:04:11,224[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 20:04:11,226[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-10 20:04:11,290[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 20:04:11,306[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 20:04:11,320[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 20:04:11,320[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 20:04:11,323[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 20:04:11,324[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 20:04:11,324[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 20:04:11,325[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 20:04:11,325[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 20:04:11,327[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 20:04:11,340[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 20:04:11,348[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d1c6f23800c4423aa9fd752b[0m
[[36m2024-10-10 20:04:11,349[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 20:04:11,350[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00afa24e80>[0m
[[36m2024-10-10 20:04:11,393[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        32.57it/s v_num: 963b      
                                    0:00:00                    val/ei_step:     
                                                               1.922            
                                                               val/ei_term1_ste…
                                                               2.464            
                                                               val/ei_term2_ste…
                                                               1.380 val/MAE:   
                                                               0.022            
                                                               val/ei_epoch:    
                                                               2.621            
                                                               val/ei_term1_epo…
                                                               3.861            
                                                               val/ei_term2_epo…
                                                               1.380 val/loss:  
                                                               0.026 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 20:58:11,691[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 20:58:11,696[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'ab36982621fe4587b9cd963b'. Data corruption may occur if there is active process writing to Run 'ab36982621fe4587b9cd963b'.[0m
[[36m2024-10-10 20:58:11,708[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for ab36982621fe4587b9cd963b[0m
[[36m2024-10-10 20:58:11,709[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 20:58:11,709[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbf47663b50>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0/checkpoints/epoch_069.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0/checkpoints/epoch_069.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.022157935425639153    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -57.900962829589844    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.026068707928061485    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.36it/s 
[[36m2024-10-10 20:58:13,603[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0/checkpoints/epoch_069.ckpt[0m
[[36m2024-10-10 20:58:13,608[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/0[0m
[[36m2024-10-10 20:58:13,609[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 20:58:13,613[0m][[35mHYDRA[0m] 	#1 : seed=2051 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 20:58:14,032[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 20:58:14,034[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2051                                                                    
Seed set to 2051
[[36m2024-10-10 20:58:14,100[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 20:58:14,116[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 20:58:14,131[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 20:58:14,131[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 20:58:14,134[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 20:58:14,135[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 20:58:14,135[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 20:58:14,136[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 20:58:14,136[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 20:58:14,138[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 20:58:14,151[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 20:58:14,158[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c7248b0332b042d58a49b2d9[0m
[[36m2024-10-10 20:58:14,159[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 20:58:14,159[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbebc19e140>[0m
[[36m2024-10-10 20:58:14,203[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        22.99it/s v_num: 752b      
                                    0:00:00                    val/ei_step:     
                                                               2.697            
                                                               val/ei_term1_ste…
                                                               3.940            
                                                               val/ei_term2_ste…
                                                               1.453 val/MAE:   
                                                               0.028            
                                                               val/ei_epoch:    
                                                               2.175            
                                                               val/ei_term1_epo…
                                                               2.898            
                                                               val/ei_term2_epo…
                                                               1.451 val/loss:  
                                                               0.030 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-10 21:01:42,600[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 21:01:42,604[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'd1c6f23800c4423aa9fd752b'. Data corruption may occur if there is active process writing to Run 'd1c6f23800c4423aa9fd752b'.[0m
[[36m2024-10-10 21:01:42,619[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for d1c6f23800c4423aa9fd752b[0m
[[36m2024-10-10 21:01:42,621[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 21:01:42,621[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00afa254b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints/epoch_008.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints/epoch_008.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.029782285913825035    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -46.761478424072266    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.03362131491303444    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.26it/s 
[[36m2024-10-10 21:01:44,523[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints/epoch_008.ckpt[0m
[[36m2024-10-10 21:01:44,526[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1[0m
[[36m2024-10-10 21:01:44,528[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 21:01:44,530[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 21:01:44,766[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 21:01:44,768[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-10 21:01:44,831[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 21:01:44,847[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 21:01:44,860[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 21:01:44,860[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 21:01:44,863[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 21:01:44,864[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 21:01:44,865[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 21:01:44,865[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 21:01:44,866[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 21:01:44,867[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 21:01:44,879[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 21:01:44,887[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 3e9b7f00856d4b12a4543de6[0m
[[36m2024-10-10 21:01:44,888[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 21:01:44,888[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00af9352d0>[0m
[[36m2024-10-10 21:01:44,928[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        22.63it/s v_num: 3de6      
                                    0:00:00                    val/ei_step:     
                                                               1.844            
                                                               val/ei_term1_ste…
                                                               2.240            
                                                               val/ei_term2_ste…
                                                               1.447 val/MAE:   
                                                               0.028            
                                                               val/ei_epoch:    
                                                               2.348            
                                                               val/ei_term1_epo…
                                                               3.249            
                                                               val/ei_term2_epo…
                                                               1.447 val/loss:  
                                                               0.032 train/MAE: 
                                                               0.013 train/loss:
                                                               0.014            
[[36m2024-10-10 21:59:44,188[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 21:59:44,191[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '3e9b7f00856d4b12a4543de6'. Data corruption may occur if there is active process writing to Run '3e9b7f00856d4b12a4543de6'.[0m
[[36m2024-10-10 21:59:44,204[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 3e9b7f00856d4b12a4543de6[0m
[[36m2024-10-10 21:59:44,205[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 21:59:44,206[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00679d9180>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints/epoch_022.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints/epoch_022.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.029123233631253242    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -49.901424407958984    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.0326957143843174     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.79it/s 
[[36m2024-10-10 21:59:45,901[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints/epoch_022.ckpt[0m
[[36m2024-10-10 21:59:45,905[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2[0m
[[36m2024-10-10 21:59:45,906[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 21:59:45,910[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 21:59:46,143[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 21:59:46,145[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-10 21:59:46,210[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 21:59:46,226[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 21:59:46,239[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 21:59:46,239[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 21:59:46,242[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 21:59:46,243[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 21:59:46,244[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 21:59:46,244[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 21:59:46,245[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 21:59:46,246[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 21:59:46,259[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 21:59:46,268[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a52d15c5fa5e4dfaaa2cf2f9[0m
[[36m2024-10-10 21:59:46,269[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 21:59:46,269[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00678900a0>[0m
[[36m2024-10-10 21:59:46,312[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:02 •        18.79it/s v_num: b2d9      
                                    0:00:00                    val/ei_step:     
                                                               2.843            
                                                               val/ei_term1_ste…
                                                               4.318            
                                                               val/ei_term2_ste…
                                                               1.368 val/MAE:   
                                                               0.027            
                                                               val/ei_epoch:    
                                                               2.337            
                                                               val/ei_term1_epo…
                                                               3.306            
                                                               val/ei_term2_epo…
                                                               1.368 val/loss:  
                                                               0.028 train/MAE: 
                                                               0.012 train/loss:
                                                               0.012            
[[36m2024-10-10 22:49:03,201[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 22:49:03,204[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c7248b0332b042d58a49b2d9'. Data corruption may occur if there is active process writing to Run 'c7248b0332b042d58a49b2d9'.[0m
[[36m2024-10-10 22:49:03,218[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c7248b0332b042d58a49b2d9[0m
[[36m2024-10-10 22:49:03,220[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 22:49:03,220[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbebc123730>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints/epoch_084.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints/epoch_084.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.02686518430709839    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -50.71644973754883     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.028247512876987457    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.00it/s 
[[36m2024-10-10 22:49:05,008[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1/checkpoints/epoch_084.ckpt[0m
[[36m2024-10-10 22:49:05,013[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/1[0m
[[36m2024-10-10 22:49:05,014[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 22:49:05,018[0m][[35mHYDRA[0m] 	#2 : seed=2052 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 22:49:05,258[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 22:49:05,259[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2052                                                                    
Seed set to 2052
[[36m2024-10-10 22:49:05,325[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 22:49:05,341[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 22:49:05,355[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 22:49:05,356[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 22:49:05,358[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 22:49:05,359[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 22:49:05,360[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 22:49:05,361[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 22:49:05,361[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 22:49:05,363[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 22:49:05,376[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 22:49:05,384[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c448bf6841f944bfb055337d[0m
[[36m2024-10-10 22:49:05,385[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 22:49:05,385[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbebc1bb250>[0m
[[36m2024-10-10 22:49:05,428[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        23.80it/s v_num: f2f9      
                                    0:00:00                    val/ei_step:     
                                                               2.579            
                                                               val/ei_term1_ste…
                                                               3.676            
                                                               val/ei_term2_ste…
                                                               1.482 val/MAE:   
                                                               0.023            
                                                               val/ei_epoch:    
                                                               2.270            
                                                               val/ei_term1_epo…
                                                               3.062            
                                                               val/ei_term2_epo…
                                                               1.478 val/loss:  
                                                               0.026 train/MAE: 
                                                               0.013 train/loss:
                                                               0.014            
[[36m2024-10-10 22:57:32,284[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 22:57:32,287[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'a52d15c5fa5e4dfaaa2cf2f9'. Data corruption may occur if there is active process writing to Run 'a52d15c5fa5e4dfaaa2cf2f9'.[0m
[[36m2024-10-10 22:57:32,301[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for a52d15c5fa5e4dfaaa2cf2f9[0m
[[36m2024-10-10 22:57:32,303[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 22:57:32,303[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00679e2230>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints/epoch_045.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints/epoch_045.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.02293216995894909    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -46.851295471191406    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.025428881868720055    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.76it/s 
[[36m2024-10-10 22:57:33,990[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints/epoch_045.ckpt[0m
[[36m2024-10-10 22:57:33,994[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3[0m
[[36m2024-10-10 22:57:33,995[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-10 22:57:34,000[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_nisp.yaml trainer=gpu logger=aim[0m
[[36m2024-10-10 22:57:34,234[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-10 22:57:34,236[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.NISPNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_nisp_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-10 22:57:34,300[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-10 22:57:34,316[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-10 22:57:34,329[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-10 22:57:34,329[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-10 22:57:34,332[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-10 22:57:34,333[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-10 22:57:34,334[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-10 22:57:34,334[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-10 22:57:34,334[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-10 22:57:34,336[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-10 22:57:34,348[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-10 22:57:34,356[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 00d44b2244684f21afb6cdfa[0m
[[36m2024-10-10 22:57:34,357[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 22:57:34,358[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00af9adea0>[0m
[[36m2024-10-10 22:57:34,402[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ NISPNet          │ 37.4 K │
│ 1  │ net.dynamics       │ Sequential       │  4.5 K │
│ 2  │ net.dynamics.0     │ Linear           │    192 │
│ 3  │ net.dynamics.1     │ LeakyReLU        │      0 │
│ 4  │ net.dynamics.2     │ Linear           │  4.2 K │
│ 5  │ net.dynamics.3     │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.4     │ Linear           │    130 │
│ 7  │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 8  │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 9  │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 10 │ net.flow.t.0.0     │ Linear           │    320 │
│ 11 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 12 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 13 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 14 │ net.flow.t.0.4     │ Linear           │    260 │
│ 15 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 16 │ net.flow.t.1.0     │ Linear           │    320 │
│ 17 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 18 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 19 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 20 │ net.flow.t.1.4     │ Linear           │    260 │
│ 21 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 22 │ net.flow.t.2.0     │ Linear           │    320 │
│ 23 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 24 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 25 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 26 │ net.flow.t.2.4     │ Linear           │    260 │
│ 27 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 28 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 29 │ net.flow.s.0.0     │ Linear           │    320 │
│ 30 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 31 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 32 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 33 │ net.flow.s.0.4     │ Linear           │    260 │
│ 34 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 35 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 36 │ net.flow.s.1.0     │ Linear           │    320 │
│ 37 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 38 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 39 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 40 │ net.flow.s.1.4     │ Linear           │    260 │
│ 41 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 42 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 43 │ net.flow.s.2.0     │ Linear           │    320 │
│ 44 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 45 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 46 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 47 │ net.flow.s.2.4     │ Linear           │    260 │
│ 48 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 49 │ net.inv_dynamics   │ Sequential       │  4.5 K │
│ 50 │ net.inv_dynamics.0 │ Linear           │    192 │
│ 51 │ net.inv_dynamics.1 │ LeakyReLU        │      0 │
│ 52 │ net.inv_dynamics.2 │ Linear           │  4.2 K │
│ 53 │ net.inv_dynamics.3 │ LeakyReLU        │      0 │
│ 54 │ net.inv_dynamics.4 │ Linear           │    130 │
│ 55 │ criterion          │ L1Loss           │      0 │
│ 56 │ train_metrics      │ MetricCollection │      0 │
│ 57 │ train_metrics.MAE  │ MAE              │      0 │
│ 58 │ val_metrics        │ MetricCollection │      0 │
│ 59 │ val_metrics.MAE    │ MAE              │      0 │
│ 60 │ test_metrics       │ MetricCollection │      0 │
│ 61 │ test_metrics.MAE   │ MAE              │      0 │
│ 62 │ train_ei           │ EI               │      0 │
│ 63 │ val_ei             │ EI               │      0 │
│ 64 │ test_ei            │ EI               │      0 │
│ 65 │ train_loss         │ MeanMetric       │      0 │
│ 66 │ val_loss           │ MeanMetric       │      0 │
│ 67 │ test_loss          │ MeanMetric       │      0 │
│ 68 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 37.4 K                                                        
Non-trainable params: 24                                                        
Total params: 37.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
`Trainer.fit` stopped: `max_epochs=101` reached.
Epoch 100/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •       23.32it/s v_num: cdfa      
                                     0:00:00                   val/ei_step:     
                                                               1.970            
                                                               val/ei_term1_ste…
                                                               2.525            
                                                               val/ei_term2_ste…
                                                               1.415 val/MAE:   
                                                               0.021            
                                                               val/ei_epoch:    
                                                               2.915            
                                                               val/ei_term1_epo…
                                                               4.412            
                                                               val/ei_term2_epo…
                                                               1.417 val/loss:  
                                                               0.024 train/MAE: 
                                                               0.013 train/loss:
                                                               0.013            
[[36m2024-10-10 23:56:09,218[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-10 23:56:09,222[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '00d44b2244684f21afb6cdfa'. Data corruption may occur if there is active process writing to Run '00d44b2244684f21afb6cdfa'.[0m
[[36m2024-10-10 23:56:09,237[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 00d44b2244684f21afb6cdfa[0m
[[36m2024-10-10 23:56:09,239[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-10 23:56:09,239[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7f00af9ad8a0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints/epoch_100.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints/epoch_100.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.02099255472421646    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │     -65.8669662475586     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.02443152666091919    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 16.74it/s 
[[36m2024-10-10 23:56:10,922[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints/epoch_100.ckpt[0m
[[36m2024-10-10 23:56:10,927[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4[0m
[[36m2024-10-10 23:56:10,928[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        22.63it/s v_num: 337d      
                                    0:00:00                    val/ei_step:     
                                                               2.070            
                                                               val/ei_term1_ste…
                                                               2.756            
                                                               val/ei_term2_ste…
                                                               1.385 val/MAE:   
                                                               0.023            
                                                               val/ei_epoch:    
                                                               2.602            
                                                               val/ei_term1_epo…
                                                               3.819            
                                                               val/ei_term2_epo…
                                                               1.385 val/loss:  
                                                               0.026 train/MAE: 
                                                               0.013 train/loss:
                                                               0.014            
[[36m2024-10-11 00:40:49,675[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-11 00:40:49,679[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'c448bf6841f944bfb055337d'. Data corruption may occur if there is active process writing to Run 'c448bf6841f944bfb055337d'.[0m
[[36m2024-10-11 00:40:49,691[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for c448bf6841f944bfb055337d[0m
[[36m2024-10-11 00:40:49,692[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-11 00:40:49,693[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbf4775b5b0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints/epoch_057.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints/epoch_057.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.022441957145929337    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -57.43452453613281     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.025281796231865883    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.66it/s 
[[36m2024-10-11 00:40:51,280[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2/checkpoints/epoch_057.ckpt[0m
[[36m2024-10-11 00:40:51,284[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/2[0m
[[36m2024-10-11 00:40:51,286[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-11 00:40:51,290[0m][[35mHYDRA[0m] 	#3 : seed=2053 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-11 00:40:51,513[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-11 00:40:51,515[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2053                                                                    
Seed set to 2053
[[36m2024-10-11 00:40:51,575[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-11 00:40:51,590[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-11 00:40:51,603[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-11 00:40:51,603[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-11 00:40:51,605[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-11 00:40:51,606[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-11 00:40:51,607[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-11 00:40:51,608[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-11 00:40:51,608[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-11 00:40:51,610[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-11 00:40:51,622[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-11 00:40:51,631[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e67619db01524e15922149de[0m
[[36m2024-10-11 00:40:51,632[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-11 00:40:51,632[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbebc2ea6b0>[0m
[[36m2024-10-11 00:40:51,690[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        21.68it/s v_num: 49de      
                                    0:00:00                    val/ei_step:     
                                                               2.605            
                                                               val/ei_term1_ste…
                                                               3.850            
                                                               val/ei_term2_ste…
                                                               1.360 val/MAE:   
                                                               0.024            
                                                               val/ei_epoch:    
                                                               2.333            
                                                               val/ei_term1_epo…
                                                               3.305            
                                                               val/ei_term2_epo…
                                                               1.361 val/loss:  
                                                               0.026 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-11 02:32:01,853[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-11 02:32:01,856[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run 'e67619db01524e15922149de'. Data corruption may occur if there is active process writing to Run 'e67619db01524e15922149de'.[0m
[[36m2024-10-11 02:32:01,871[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for e67619db01524e15922149de[0m
[[36m2024-10-11 02:32:01,872[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-11 02:32:01,872[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbf35036170>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints/epoch_089.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints/epoch_089.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │    0.02409544214606285    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -50.404701232910156    │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │   0.026113910600543022    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 14.91it/s 
[[36m2024-10-11 02:32:03,706[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3/checkpoints/epoch_089.ckpt[0m
[[36m2024-10-11 02:32:03,709[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/3[0m
[[36m2024-10-11 02:32:03,710[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
[[36m2024-10-11 02:32:03,713[0m][[35mHYDRA[0m] 	#4 : seed=2054 experiment=ymz_nis/ood_rnis.yaml trainer=gpu logger=aim[0m
[[36m2024-10-11 02:32:03,934[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2024-10-11 02:32:03,935[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
├── data
│   └── _target_: src.data.sir_datamodule.SIRDataModule                         
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       batch_size: 64                                                          
│       num_workers: 10                                                         
│       pin_memory: true                                                        
│       train:                                                                  
│         size_list:                                                            
│         - 0                                                                   
│         - 1400                                                                
│         - 1000                                                                
│         - 0                                                                   
│         - 0                                                                   
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       val:                                                                    
│         size_list:                                                            
│         - 900                                                                 
│         - 0                                                                   
│         - 0                                                                   
│         - 300                                                                 
│         - 100                                                                 
│         beta: 1                                                               
│         gamma: 0.5                                                            
│         steps: 2                                                              
│         dt: 0.01                                                              
│         interval: 1                                                           
│         sigma: 0.01                                                           
│         rho: -0.5                                                             
│       path:                                                                   
│         train: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/da
│           1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                      
│         val: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/data
│           0, 0, 300, 100]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── model
│   └── _target_: src.models.sir_module.NISpLitModule                           
│       optimizer:                                                              
│         _target_: torch.optim.Adam                                            
│         _partial_: true                                                       
│         lr: 0.002                                                             
│         weight_decay: 0.0                                                     
│       scheduler:                                                              
│         _target_: torch.optim.lr_scheduler.ReduceLROnPlateau                  
│         _partial_: true                                                       
│         mode: min                                                             
│         factor: 0.1                                                           
│         patience: 10                                                          
│       net:                                                                    
│         _target_: src.models.components.nis_net.RNISNet                       
│         input_size: 4                                                         
│         latent_size: 2                                                        
│         output_size: 4                                                        
│         hidden_units: 64                                                      
│         hidden_units_dyn: 64                                                  
│         is_normalized: true                                                   
│       compile: false                                                          
│       trainset_fp: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeeze
│         1400, 1000, 0, 0]_1_0.5_2_0.01_1_0.01_-0.5.npy                        
│                                                                               
├── callbacks
│   └── model_checkpoint:                                                       
│         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
│         dirpath: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/
│         filename: epoch_{epoch:03d}                                           
│         monitor: val/ei                                                       
│         verbose: false                                                        
│         save_last: false                                                      
│         save_top_k: 1                                                         
│         mode: max                                                             
│         auto_insert_metric_name: false                                        
│         save_weights_only: false                                              
│         every_n_train_steps: null                                             
│         train_time_interval: null                                             
│         every_n_epochs: null                                                  
│         save_on_train_epoch_end: null                                         
│       early_stopping:                                                         
│         _target_: lightning.pytorch.callbacks.EarlyStopping                   
│         monitor: val/ei                                                       
│         min_delta: 0.0                                                        
│         patience: 10                                                          
│         verbose: false                                                        
│         mode: max                                                             
│         strict: true                                                          
│         check_finite: true                                                    
│         stopping_threshold: null                                              
│         divergence_threshold: null                                            
│         check_on_train_epoch_end: null                                        
│       model_summary:                                                          
│         _target_: lightning.pytorch.callbacks.RichModelSummary                
│         max_depth: -1                                                         
│       rich_progress_bar:                                                      
│         _target_: lightning.pytorch.callbacks.RichProgressBar                 
│                                                                               
├── logger
│   └── aim:                                                                    
│         _target_: aim.pytorch_lightning.AimLogger                             
│         repo: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer    
│         experiment: sir_rnis_ood                                              
│         train_metric_prefix: train/                                           
│         val_metric_prefix: val/                                               
│         test_metric_prefix: test/                                             
│         system_tracking_interval: 10                                          
│         log_system_params: true                                               
│         capture_terminal_logs: false                                          
│       wandb:                                                                  
│         tags:                                                                 
│         - sir                                                                 
│         - ymz_net                                                             
│         - seed_sweep                                                          
│         group: sir                                                            
│                                                                               
├── trainer
│   └── _target_: lightning.pytorch.trainer.Trainer                             
│       default_root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Sq
│       min_epochs: 100                                                         
│       max_epochs: 101                                                         
│       accelerator: gpu                                                        
│       devices: 1                                                              
│       check_val_every_n_epoch: 1                                              
│       deterministic: false                                                    
│       gradient_clip_val: 0.5                                                  
│       precision: 16                                                           
│                                                                               
├── paths
│   └── root_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│       data_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/d
│       log_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/lo
│       output_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer
│       work_dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer  
│                                                                               
├── extras
│   └── ignore_warnings: false                                                  
│       enforce_tags: true                                                      
│       print_config: true                                                      
│                                                                               
├── task_name
│   └── train                                                                   
├── tags
│   └── ['sir', 'ymz_net', 'seed_sweep']                                        
├── train
│   └── True                                                                    
├── test
│   └── True                                                                    
├── ckpt_path
│   └── None                                                                    
└── seed
    └── 2054                                                                    
Seed set to 2054
[[36m2024-10-11 02:32:03,995[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.sir_datamodule.SIRDataModule>[0m
[[36m2024-10-11 02:32:04,010[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.sir_module.NISpLitModule>[0m
[[36m2024-10-11 02:32:04,023[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2024-10-11 02:32:04,023[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2024-10-11 02:32:04,025[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2024-10-11 02:32:04,026[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2024-10-11 02:32:04,027[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2024-10-11 02:32:04,027[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2024-10-11 02:32:04,028[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating logger <aim.pytorch_lightning.AimLogger>[0m
[[36m2024-10-11 02:32:04,029[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/fabric/connector.py:563: `precision=16` is supported for historical reasons but its usage is discouraged. Please set your precision to 16-mixed instead!
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[[36m2024-10-11 02:32:04,040[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Logging hyperparameters![0m
[[36m2024-10-11 02:32:04,049[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 144ff03451084faa9e7f3e75[0m
[[36m2024-10-11 02:32:04,050[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-11 02:32:04,050[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbf444e07c0>[0m
[[36m2024-10-11 02:32:04,093[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:653: Checkpoint directory /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
┏━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃    ┃ Name               ┃ Type             ┃ Params ┃
┡━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0  │ net                │ RNISNet          │ 46.4 K │
│ 1  │ net.dynamics       │ InvertibleNN     │ 17.9 K │
│ 2  │ net.dynamics.t     │ ModuleList       │  9.0 K │
│ 3  │ net.dynamics.t.0   │ Sequential       │  4.5 K │
│ 4  │ net.dynamics.t.0.0 │ Linear           │    192 │
│ 5  │ net.dynamics.t.0.1 │ LeakyReLU        │      0 │
│ 6  │ net.dynamics.t.0.2 │ Linear           │  4.2 K │
│ 7  │ net.dynamics.t.0.3 │ LeakyReLU        │      0 │
│ 8  │ net.dynamics.t.0.4 │ Linear           │    130 │
│ 9  │ net.dynamics.t.1   │ Sequential       │  4.5 K │
│ 10 │ net.dynamics.t.1.0 │ Linear           │    192 │
│ 11 │ net.dynamics.t.1.1 │ LeakyReLU        │      0 │
│ 12 │ net.dynamics.t.1.2 │ Linear           │  4.2 K │
│ 13 │ net.dynamics.t.1.3 │ LeakyReLU        │      0 │
│ 14 │ net.dynamics.t.1.4 │ Linear           │    130 │
│ 15 │ net.dynamics.s     │ ModuleList       │  9.0 K │
│ 16 │ net.dynamics.s.0   │ Sequential       │  4.5 K │
│ 17 │ net.dynamics.s.0.0 │ Linear           │    192 │
│ 18 │ net.dynamics.s.0.1 │ LeakyReLU        │      0 │
│ 19 │ net.dynamics.s.0.2 │ Linear           │  4.2 K │
│ 20 │ net.dynamics.s.0.3 │ LeakyReLU        │      0 │
│ 21 │ net.dynamics.s.0.4 │ Linear           │    130 │
│ 22 │ net.dynamics.s.0.5 │ Tanh             │      0 │
│ 23 │ net.dynamics.s.1   │ Sequential       │  4.5 K │
│ 24 │ net.dynamics.s.1.0 │ Linear           │    192 │
│ 25 │ net.dynamics.s.1.1 │ LeakyReLU        │      0 │
│ 26 │ net.dynamics.s.1.2 │ Linear           │  4.2 K │
│ 27 │ net.dynamics.s.1.3 │ LeakyReLU        │      0 │
│ 28 │ net.dynamics.s.1.4 │ Linear           │    130 │
│ 29 │ net.dynamics.s.1.5 │ Tanh             │      0 │
│ 30 │ net.flow           │ InvertibleNN     │ 28.5 K │
│ 31 │ net.flow.t         │ ModuleList       │ 14.2 K │
│ 32 │ net.flow.t.0       │ Sequential       │  4.7 K │
│ 33 │ net.flow.t.0.0     │ Linear           │    320 │
│ 34 │ net.flow.t.0.1     │ LeakyReLU        │      0 │
│ 35 │ net.flow.t.0.2     │ Linear           │  4.2 K │
│ 36 │ net.flow.t.0.3     │ LeakyReLU        │      0 │
│ 37 │ net.flow.t.0.4     │ Linear           │    260 │
│ 38 │ net.flow.t.1       │ Sequential       │  4.7 K │
│ 39 │ net.flow.t.1.0     │ Linear           │    320 │
│ 40 │ net.flow.t.1.1     │ LeakyReLU        │      0 │
│ 41 │ net.flow.t.1.2     │ Linear           │  4.2 K │
│ 42 │ net.flow.t.1.3     │ LeakyReLU        │      0 │
│ 43 │ net.flow.t.1.4     │ Linear           │    260 │
│ 44 │ net.flow.t.2       │ Sequential       │  4.7 K │
│ 45 │ net.flow.t.2.0     │ Linear           │    320 │
│ 46 │ net.flow.t.2.1     │ LeakyReLU        │      0 │
│ 47 │ net.flow.t.2.2     │ Linear           │  4.2 K │
│ 48 │ net.flow.t.2.3     │ LeakyReLU        │      0 │
│ 49 │ net.flow.t.2.4     │ Linear           │    260 │
│ 50 │ net.flow.s         │ ModuleList       │ 14.2 K │
│ 51 │ net.flow.s.0       │ Sequential       │  4.7 K │
│ 52 │ net.flow.s.0.0     │ Linear           │    320 │
│ 53 │ net.flow.s.0.1     │ LeakyReLU        │      0 │
│ 54 │ net.flow.s.0.2     │ Linear           │  4.2 K │
│ 55 │ net.flow.s.0.3     │ LeakyReLU        │      0 │
│ 56 │ net.flow.s.0.4     │ Linear           │    260 │
│ 57 │ net.flow.s.0.5     │ Tanh             │      0 │
│ 58 │ net.flow.s.1       │ Sequential       │  4.7 K │
│ 59 │ net.flow.s.1.0     │ Linear           │    320 │
│ 60 │ net.flow.s.1.1     │ LeakyReLU        │      0 │
│ 61 │ net.flow.s.1.2     │ Linear           │  4.2 K │
│ 62 │ net.flow.s.1.3     │ LeakyReLU        │      0 │
│ 63 │ net.flow.s.1.4     │ Linear           │    260 │
│ 64 │ net.flow.s.1.5     │ Tanh             │      0 │
│ 65 │ net.flow.s.2       │ Sequential       │  4.7 K │
│ 66 │ net.flow.s.2.0     │ Linear           │    320 │
│ 67 │ net.flow.s.2.1     │ LeakyReLU        │      0 │
│ 68 │ net.flow.s.2.2     │ Linear           │  4.2 K │
│ 69 │ net.flow.s.2.3     │ LeakyReLU        │      0 │
│ 70 │ net.flow.s.2.4     │ Linear           │    260 │
│ 71 │ net.flow.s.2.5     │ Tanh             │      0 │
│ 72 │ criterion          │ L1Loss           │      0 │
│ 73 │ train_metrics      │ MetricCollection │      0 │
│ 74 │ train_metrics.MAE  │ MAE              │      0 │
│ 75 │ val_metrics        │ MetricCollection │      0 │
│ 76 │ val_metrics.MAE    │ MAE              │      0 │
│ 77 │ test_metrics       │ MetricCollection │      0 │
│ 78 │ test_metrics.MAE   │ MAE              │      0 │
│ 79 │ train_ei           │ EI               │      0 │
│ 80 │ val_ei             │ EI               │      0 │
│ 81 │ test_ei            │ EI               │      0 │
│ 82 │ train_loss         │ MeanMetric       │      0 │
│ 83 │ val_loss           │ MeanMetric       │      0 │
│ 84 │ test_loss          │ MeanMetric       │      0 │
│ 85 │ val_mae_best       │ MinMetric        │      0 │
└────┴────────────────────┴──────────────────┴────────┘
Trainable params: 46.4 K                                                        
Non-trainable params: 32                                                        
Total params: 46.4 K                                                            
Total estimated model params size (MB): 0                                       
/home/yuanbing/anaconda3/envs/ymz_torch2/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py:298: The number of training batches (38) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.
Trainer was signaled to stop but the required `min_epochs=100` or `min_steps=None` has not been met. Training will continue...
Epoch 99/100 ━━━━━━━━━━━━━━━━ 38/38 0:00:01 •        22.06it/s v_num: 3e75      
                                    0:00:00                    val/ei_step:     
                                                               1.730            
                                                               val/ei_term1_ste…
                                                               2.065            
                                                               val/ei_term2_ste…
                                                               1.395 val/MAE:   
                                                               0.028            
                                                               val/ei_epoch:    
                                                               2.432            
                                                               val/ei_term1_epo…
                                                               3.467            
                                                               val/ei_term2_epo…
                                                               1.396 val/loss:  
                                                               0.034 train/MAE: 
                                                               0.012 train/loss:
                                                               0.013            
[[36m2024-10-11 04:22:47,207[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2024-10-11 04:22:47,210[0m][[34maim.sdk.lock_manager[0m][[33mWARNING[0m] - Force-releasing locks for Run '144ff03451084faa9e7f3e75'. Data corruption may occur if there is active process writing to Run '144ff03451084faa9e7f3e75'.[0m
[[36m2024-10-11 04:22:47,223[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - creating RunStatusReporter for 144ff03451084faa9e7f3e75[0m
[[36m2024-10-11 04:22:47,224[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting from: {}[0m
[[36m2024-10-11 04:22:47,225[0m][[34maim.sdk.reporter[0m][[32mINFO[0m] - starting writer thread for <aim.sdk.reporter.RunStatusReporter object at 0x7fbf444d75e0>[0m
Restoring states from the checkpoint path at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints/epoch_059.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints/epoch_059.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│         test/MAE          │   0.028247149661183357    │
│       test/ei_epoch       │            0.0            │
│    test/ei_term1_epoch    │    -52.03565979003906     │
│    test/ei_term2_epoch    │    1.3862947225570679     │
│         test/loss         │    0.03326062113046646    │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21/21 0:00:01 • 0:00:00 17.71it/s 
[[36m2024-10-11 04:22:48,909[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4/checkpoints/epoch_059.ckpt[0m
[[36m2024-10-11 04:22:48,913[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /home/yuanbing/data/test/ymz_nis/Neural_Information_Squeezer/logs/train/multiruns/2024-10-10_19-06-31/4[0m
[[36m2024-10-11 04:22:48,915[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Metric name is None! Skipping metric value retrieval...[0m
Could not override 'lambdas'.
To append to your config use +lambdas=0.5
Key 'lambdas' is not in struct
    full_key: lambdas
    object_type=dict

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
